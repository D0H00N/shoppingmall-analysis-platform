<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ë·° ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body { 
            font-family: Arial, sans-serif; 
            background-color: #f4f4f4; 
            text-align: center; 
            justify-content: center; 
            margin: 0; /* ê¸°ë³¸ ì—¬ë°± ì œê±° */
            overflow-y: scroll;
            overflow-x: hidden; /* ğŸ”¹ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        content {
            justify-content: center; 
        }
        .header {
            background-color: #6200ea;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .search-container {
            display: flex;
            justify-content: flex-start;
            margin: 20px;
            border-radius: 12px;
            margin: 8px auto;
            max-width: 1300px; /* ğŸ‘‰ ì¹´ë“œ í¬ê¸° ê· í˜• ì¡°ì • */
            position: relative;
        }
        .search-container input {
            width: 400px;
            padding: 10px;
            font-size: 16px;
            border-radius: 20px;
            border: 1px solid #ccc;
            text-align: center;
        }
        .search-container button {
            padding: 10px 20px;
            font-size: 16px;
            margin-left: 10px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        .container {
            /* text-align: center; */
            margin-bottom: 10px; /* âœ… ê°„ê²© ì¤„ì´ê¸° */
        }
        .box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .full-width {
            grid-column: span 2;
        }
/*/////////////////////////////////////////////////////////////////////////////            
        ///////////* ë¸Œëœë“œ,ì œí’ˆ ìˆœìœ„//////////////*/
        /* ì¹´ë“œ ì „ì²´ ìŠ¤íƒ€ì¼ */
        .ranking-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin: 8px auto;
            max-width: 1300px; 
            position: relative;
        }
        /* âœ… ë¸Œëœë“œ,ì œí’ˆ ìˆœìœ„ ë ˆì´ì•„ì›ƒ */
        .ranking-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);            
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2ê°œì”© ë°°ì¹˜ */
            grid-template-rows: 1fr; /* 2í–‰ ë°°ì¹˜ */
            gap: 10px; /* ê°„ê²© ìµœì†Œí™” */
            max-width: 1300px;
            margin: auto;
        }

        /* âœ… ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í¬ê¸° ìµœì í™” */
        .ranking-container {
            background: white;
            padding: 0px; /* ê¸°ì¡´ 15pxì—ì„œ ì¤„ì„ */
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            min-height: 450px !important;  /* ëª¨ë“  ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ë™ì¼í•œ ë†’ì´ */
            display: flex;
            flex-direction: column;
            justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
            align-items: center;
            width: 100%; /* ë„ˆë¹„ ë™ì¼í•˜ê²Œ ì„¤ì • */
        }

        
        /* âœ… ê°œë³„ ì°¨íŠ¸ ë‚´ë¶€ ì œëª© */
        .ranking-container h4 {
            margin-bottom: 0px !important; /* ê¸°ì¡´ 10px â†’ 3px */
            font-size: 16px;
            text-align: center;
        }
        /*///////////// ë¸Œëœë“œ,ì œí’ˆ ìˆœìœ„//////////////*/
        .sales-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin: 8px auto;
            max-width: 1300px; 
            position: relative;
            transition: transform 0.2s ease-in-out;
        }
        .sales-card:hover {
            transform: translateY(-3px);
        }
        .sales-box {
            display: flex; /* Flexboxë¡œ ë³€ê²½ */
            justify-content: space-between; /* ì°¨íŠ¸ë“¤ì„ ì¤‘ì•™ ì •ë ¬ */
            gap: 15px; /* ì°¨íŠ¸ ê°„ ê°„ê²© */
            flex-wrap: wrap; /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ ì°¨íŠ¸ê°€ ì¤„ë°”ê¿ˆë  ìˆ˜ ìˆë„ë¡ ì„¤ì • */
            background: white;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        /* âœ… ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í¬ê¸° ìµœì í™” */
        .sales-container {
            flex: calc(33.33% - 20px); /* ê° ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì˜ í¬ê¸° ê³„ì‚° */
            min-width: 280px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
            text-align: center;
            background: white;
            padding: 12px;
            min-height: 250px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
            max-height: 380px;
            border-radius: 10px;
            box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.1); 
        }
        
        /* âœ… ê°œë³„ ì°¨íŠ¸ ë‚´ë¶€ ì œëª© */
        .sales-container h4 {
            margin-bottom: 0px !important; /* ê¸°ì¡´ 10px â†’ 3px */
            font-size: 16px;
            text-align: center;
        }
        /* âœ… ë‚ ì§œ í•„í„°ëŠ” ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ê³ ì • */
        /* âœ… ë‚ ì§œ í•„í„°ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì™„ì „íˆ ì •ë ¬ */
        .date-filter {
            position: absolute;
            right: 20px;  /* ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ê³ ì • */
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .date-filter input {
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .date-filter button {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .date-filter button:hover {
            background: #45a049;

        }
        /*//////////// íŒë§¤ëŸ‰ ë¶„ì„ ë³´ê¸°//////////*/
        .hidden {
            display: none; /* ì½˜í…ì¸ ë¥¼ í™”ë©´ì—ì„œ ìˆ¨ê¹€ */
        }
        .sales-button {
            position: absolute;
            left: 20px;
        }
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #toggleAnalysisButton {
            padding: 8px 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            left: 20px;
        }

        #toggleAnalysisButton:hover {
            background-color: #0056b3; /* í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
        }

/*////////////////////////////////////////////////////////*/
        /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .review-btn {
            padding: 8px 0;
            font-size: 14px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 6px;
            width: 120px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;           /* âœ… ë„˜ì¹˜ëŠ” í…ìŠ¤íŠ¸ ì˜ë¼ëƒ„ */
            text-overflow: ellipsis;    /* âœ… ë§ì¤„ì„í‘œë¡œ ì²˜ë¦¬ */
            }

        button.review-btn.guideline-btn {
        white-space: nowrap;      /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
        padding: 10px 18px;       /* ë²„íŠ¼ ì—¬ë°± */
        font-size: 14px;
        width: 180px;             /* âœ… ë„‰ë„‰í•˜ê²Œ ë„ˆë¹„ í™•ë³´ */
        max-width: 100%;          /* ë°˜ì‘í˜• ëŒ€ì‘ */
        text-align: center;
        }
        .review-btn:hover {
            background: linear-gradient(135deg, #0056b3, #003d80);
        }
        /* âœ… ë°˜ì‘í˜• ìµœì í™” */
        @media screen and (max-width: 600px) {
            .review-card {
                flex-direction: column;
                text-align: center;
            }
            .review-image {
                margin-right: 0;
                margin-bottom: 10px;
            }
            .review-content {
                align-items: center;
            }
            .review-btn {
                align-self: center; /* âœ… ì‘ì€ í™”ë©´ì—ì„œëŠ” ì¤‘ì•™ ì •ë ¬ */
            }
        }
        .price {
            font-size: 16px;
            font-weight: bold;
            color: #d9534f;
        }
        /* ì œëª© ìŠ¤íƒ€ì¼ */
        .chart-card h3 {
            display: flex;
            text-align: center;
            justify-content: center;
            gap: 20px;
        }

 
        .sales-chart {
            width: 100% !important;
            height: 350px !important; /* ê¸°ì¡´ 320px â†’ 400pxë¡œ ì¦ê°€ */
            padding: 0px !important;
        }


/*/////////////////////////////////////////////////////////////////////////////        
        /* âœ… ê°ì„± ë¶„ì„ ì„¹ì…˜ì˜ ê°„ê²© ì¦ê°€ */
        .chart-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* ê°ì„± ë¶„ì„ & ë¸Œëœë“œ ë¶„ì„ */
        
        .analysis-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
        }
       /*//////// ì œí’ˆ ê²€ìƒ‰ ì„¹ì…˜ ///////*/
       .product-search-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin: 8px auto;
            max-width: 1300px; 
            position: relative;
        }
        .search-title {
            font-size: 20px;
            font-weight: bold;
            text-align: left;
            margin-bottom: 10px;
            margin-left: 10px;
        }
        .product-search-box {
            display: flex;
            justify-content: space-between; /* ì–‘ìª½ ë ì •ë ¬ */
            align-items: flex-start; /* ì„¸ë¡œ ì •ë ¬ ì„¤ì • */
        }
        @media only screen and (max-width: 600px) {
        .product-search-box {
            flex-direction: column; /* ì„¸ë¡œ ë°°ì¹˜ë¡œ ë³€ê²½ */
        }}

        .filter-box {
            position: fixed;
            text-align: center;
            width: 150px;
            background: white;
            padding-bottom: 20px;
            clear: both;      
            z-index: 100;
            top: 500px;   
            /*margin-right: 200px; */
            left: 8px;                 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);  /* ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
            border-radius: 8px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
        }
        /* í™”ë©´ í¬ê¸°ê°€ ì‘ì•„ì¡Œì„ ë•Œ ì ìš©í•  ìŠ¤íƒ€ì¼ */
        @media screen and (max-width: 1900px) {
        .filter-box {
            position: static; /* ê³ ì • ìœ„ì¹˜ í•´ì œ */
            order: 0; /* flex ìˆœì„œ ì¡°ì • */
            /*margin: 20px 0; /* ì—¬ë°± ì¶”ê°€ */
            width: 25%;
            height: 100%;
            border-top: 1px solid #eee;
            padding-top: 20px; 
            max-height: 430px; /* ìŠ¤í¬ë¡¤ ì˜ì—­ í¬ê¸° ì œí•œ */
            /*order: 9999; flex ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ë§ˆì§€ë§‰ì— ë°°ì¹˜ */
            box-sizing: border-box;
        }}
        @media screen and (max-width: 600px) {
        .filter-box {
            position: static; /* ê³ ì • ìœ„ì¹˜ í•´ì œ */
            order: 0; /* flex ìˆœì„œ ì¡°ì • */
            margin: 20px 0; /* ì—¬ë°± ì¶”ê°€ */
            width: 100%;
            border-top: 1px solid #eee;
            padding-top: 20px; 
            /*order: 9999; flex ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ë§ˆì§€ë§‰ì— ë°°ì¹˜ */
            box-sizing: border-box;
        }}
        .search-button {
            width: 100px; 
            height: 40px; 
            text-align: center;
            padding: 0;
            font-size: 16px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        .product-list h2 {
            position: relative;
            top: 0;
            z-index: 10;
        }
        .product-list {
            width: 100%;
            position: sticky;
            order: 1; /* flex ìˆœì„œ ì¡°ì • */
            background-color: white;
            padding: 15px;
            max-height: 430px; /* ìŠ¤í¬ë¡¤ ì˜ì—­ í¬ê¸° ì œí•œ */
            border-radius: 10px;
            overflow-y: auto; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ í™œì„±í™” */
            box-sizing: border-box;
        }
        @media screen and (max-width: 1900px) {
        .product-list {
        width: 75%;
        position: sticky;
        order: 1; /* flex ìˆœì„œ ì¡°ì • */
        background-color: white;
        padding: 15px;
        border-radius: 10px;
        overflow-y: auto; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ í™œì„±í™” */
        box-sizing: border-box;
        }}  
        @media screen and (max-width: 600px) {
        .product-list {
        width: 100%;
        order: 1; /* flex ìˆœì„œ ì¡°ì • */
        background-color: white;
        padding: 15px;
        border-radius: 10px;
        overflow-y: auto; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ í™œì„±í™” */
        box-sizing: border-box;
        }}  
        .filter-button {
            width: 100%;
            margin-bottom: 10px;
            padding: 12px;
            font-size: 14px;
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: left;
            font-weight: bold;
            cursor: pointer;
            position: relative;

        }
        .filter-button span.filter-selected {
            font-size: 12px;
            color: gray;
            position: absolute;
            bottom: 50%;
            right: 2px; /* ì—¬ë°± ì¡°ì • */
            transform: translateY(50%);
            text-align: right;
        }
        .filter-selected {
            font-size: 12px;
            color: gray;
            position: absolute;
            bottom: 1px;
            left: 10px;
        }
        .filter-options {
            display: none;
            position: absolute;
            width: 100%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        
        }
        @media screen and (max-width: 1900px) {
        .filter-options {
            display: none;
            position: absolute;
            width: 25%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }}
        @media screen and (max-width: 600px) {
        .filter-options {
            display: none;
            position: absolute;
            width: 95%;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }}
        

        /* í•„í„° ì˜µì…˜ ê°•ì¡° */
        .filter-options label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        } 
        /* í•œ ë²ˆì— í•˜ë‚˜ì˜ ì˜µì…˜ë§Œ ì—´ë¦¬ë„ë¡ ì„¤ì • */
        .filter-box.active .filter-options {
            display: block;
        }
        /* "ì œí’ˆ ì°¾ê¸°" ì œëª© ì™¼ìª½ ì •ë ¬ */
        .product-list h2 {
            text-align: left;
            margin-left: 20px;
        }    
        /* ì œí’ˆ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .product-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #fafafae8; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
        border-radius: 5px;
        padding: 5px;
        margin-bottom: 5px;
        width: 95%;
        margin: 5px auto;
        margin-left: 0;
        gap: 8px;
        }
        .product-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid #ddd;
        }     
        .product-info-text {
            font-size: 14px;  /* âœ… ê¸°ë³¸ í…ìŠ¤íŠ¸ í¬ê¸° */
            line-height: 0.8;
            font-weight: normal;
        }
        /* ì œí’ˆ ì •ë³´ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .product-info {
            text-align: left;
            font-size: 14px;
            flex-grow: 1;
            margin-left: 15px;
            line-height: 1.2;
        }
        .product-info-text strong {
            font-size: 13px;  /* âœ… ì œëª©(ì¹´í…Œê³ ë¦¬, ì„±ë³„ ë“±) í¬ê¸° ì‘ê²Œ */
            font-weight: normal;  /* âœ… ê¸°ë³¸ ê¸€ì”¨ì²´ ìœ ì§€ */
            color: #555;  /* âœ… ì—°í•œ íšŒìƒ‰ìœ¼ë¡œ ì¡°ì • */
        }
        .product-info-text span {
            font-size: 16px;  /* âœ… ì‹¤ì œ ê°’(êµ¬ë‘, ê³µìš© ë“±) ë” í¬ê²Œ */
            font-weight: bold;
            color: #222;  /* âœ… ê°•ì¡° íš¨ê³¼ */
        }
        #product-name {
            font-size: 17.5px;  /* âœ… ë” í¬ê²Œ */
            font-weight: bold;
            color: rgb(49, 165, 14);
        }
        #product-info {
            flex-grow: 0;  /* âœ… ìë™ í™•ì¥ ë°©ì§€ */
            width: 580px;  /* âœ… ë„ˆë¹„ ê³ ì • */
            text-align: left;
            margin-right: auto; /* ğŸ”¥ ì™¼ìª½ ì •ë ¬ë˜ë„ë¡ ë³€ê²½ */
        }
/*//////////////////////////////////////////////////////////////////////////*/


        /* âœ… "ì´ìƒ ê°ì§€ ë¦¬ë·° ëª©ë¡" ì„¹ì…˜ì„ ì¢€ ë” ìœ„ë¡œ */
        .anomaly-section {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.1);
        }

        .review-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
        }

        
        /* ë¦¬ë·° ì¹´ë“œ */
        .review-card {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 12px;
            transition: transform 0.2s ease-in-out;
            gap: 15px; /* âœ… ìš”ì†Œ ê°„ê²© ê· ì¼ */
        }


        /* âœ… ë§ˆìš°ìŠ¤ë¥¼ ê°–ë‹¤ëŒˆ ë•Œ íˆ´íŒ í‘œì‹œ */
        .review-card:hover .product-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .review-card:hover {
            transform: translateY(-3px);
        }
        .product-tooltip {
            position: absolute;
            bottom: 100%; /* âœ… ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ìœ„ìª½ìœ¼ë¡œ ì´ë™ */
            left: 50%;
            transform: translateX(-50%); /* âœ… ê°€ìš´ë° ì •ë ¬ */
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 5px;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        /* âœ… ì´ë¯¸ì§€ í¬ê¸° ë° ì •ë ¬ */
        .review-image {
            width: 80px; /* âœ… ë™ì¼í•œ í¬ê¸°ë¡œ ì¡°ì • */
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
            flex-shrink: 0; /* âœ… ì´ë¯¸ì§€ í¬ê¸° ìœ ì§€ */
        }

        /* âœ… ë¦¬ë·° ë‚´ìš© ìŠ¤íƒ€ì¼ */
        .review-content {
            display: flex;
            flex-direction: column;
            justify-content: center; /* âœ… ì¤‘ì•™ ì •ë ¬ */
            gap: 5px;
            font-size: 14px;
            flex-grow: 1;
            text-align: left;
        }

        .review-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            text-decoration: none;
        }
        .review-info {
            font-size: 14px;
            color: #666;
        }
        .review-text {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }

        .review-meta {
            font-size: 13px;
            color: gray;
        }
        .chart-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* âœ… ì¤‘ì•™ ì •ë ¬ */
            align-items: center;
            gap: 20px;
        }

        .chart-section h2 {
            text-align: center; /* âœ… ì œëª©ì„ ì¤‘ì•™ ì •ë ¬ */
            margin-bottom: 20px;
            font-size: 22px;
            width: 100%; /* âœ… ì „ì²´ ë„ˆë¹„ í™•ë³´ */
        }
        .chart-box {
            flex: 1 1 33%; /* âœ… í•œ ì¤„ì— 3ê°œ ë°°ì¹˜ */
            min-width: 320px; /* âœ… ìµœì†Œ í¬ê¸° ì„¤ì • */
            max-width: 450px; /* âœ… ìµœëŒ€ í¬ê¸° ì„¤ì • */
            height: 400px; /* âœ… ë™ì¼í•œ ë†’ì´ ìœ ì§€ */
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* âœ… ì°¨íŠ¸ ë‚´ë¶€ í…ìŠ¤íŠ¸ ë„˜ì¹¨ ë°©ì§€ */
        }

        .bar-chart-box {
            flex: 1;
            min-width: 330px; /* âœ… ë°” ì°¨íŠ¸ëŠ” ì¡°ê¸ˆ ë” ë„“ê²Œ ì„¤ì • */
            max-width: 420px;
            height: 280px; /* âœ… ë†’ì´ ì¡°ì • */
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .toggle-btn {
            padding: 12px 20px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .toggle-btn:hover {
            background: #0056b3;
        }
        /* âœ… ì•Œë¦¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        /* âœ… ì•Œë¦¼ ì»¨í…Œì´ë„ˆë¥¼ í™”ë©´ ìš°ì¸¡ ìƒë‹¨ì— ê³ ì • */
        #notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 320px; /* ì•Œë¦¼ í¬ê¸° */
    max-width: 90vw;
    max-height: 400px; /* ìµœëŒ€ ë†’ì´ ì„¤ì • (ìŠ¤í¬ë¡¤ í—ˆìš©) */
    overflow-y: auto;
    display: flex;
    flex-direction: column-reverse;
    gap: 10px;
    z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
}
.mainPage-content {
    width: calc(100% - 17px);
}
/* âœ… ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
.notification-popup {
    background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
    color: white;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.3);
    font-size: 14px;
    position: relative;
    width: 300px;
    max-width: 90vw;
    opacity: 0;
    transition: opacity 0.3s ease-in-out, transform 0.2s ease-in-out;
    transform: scale(0.95);
    border-left: 5px solid #ff4d4d;
    pointer-events: auto;
}



/* âœ… ì œëª© ìŠ¤íƒ€ì¼ */
.notification-popup .title {
    font-size: 16px;
    font-weight: bold;
    color: #ff4d4d;
    display: flex;
    align-items: center;
    gap: 5px;
    text-align: center;
}

/* âœ… ê°ì§€ ìœ í˜• ê°•ì¡° */
.anomaly-type {
    font-size: 14px;
    font-weight: bold;
    color: #ffd700; /* ë…¸ë€ìƒ‰ ê°•ì¡° */
    display: block;
    margin: 5px 0;
}

/* âœ… ê°€ê²© ì •ë³´ ìŠ¤íƒ€ì¼ */
.notification-popup .price-info {
    font-size: 14px;
    color: #ddd;
    display: flex;
    align-items: center;
    gap: 5px;
}

/* âœ… ë¦¬ë·° ìŠ¤íƒ€ì¼ */
.notification-popup .review {
    font-size: 14px;
    font-style: italic;
    color: #eee;
    border-left: 3px solid #ff4d4d;
    padding-left: 10px;
    margin: 10px 0;
}

/* âœ… ì¹´í…Œê³ ë¦¬ & í‰ì  ìŠ¤íƒ€ì¼ */
.notification-popup .meta-info {
    font-size: 13px;
    color: #bbb;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* âœ… ì‘ì„±ì¼ ìŠ¤íƒ€ì¼ */
.notification-popup .date {
    font-size: 12px;
    color: #aaa;
    text-align: right;
    margin-top: 5px;
}

/* âœ… ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.notification-popup .close-btn {
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    color: #ff4d4d;
    transition: color 0.2s ease-in-out;
}

.notification-popup .close-btn:hover {
    color: #d9534f;
}

/* âœ… ì• ë‹ˆë©”ì´ì…˜ */
.notification-popup.show {
    opacity: 1;
    transform: translateY(0);
}
        .chart-group {
            display: flex;
            justify-content: center; /* âœ… ì¤‘ì•™ ì •ë ¬ */
            flex-wrap: wrap; /* âœ… ìë™ ì¤„ë°”ê¿ˆ */
            gap: 20px; /* âœ… ì°¨íŠ¸ ê°„ê²© ì¦ê°€ */
            width: 100%;
            max-width: 1400px; /* âœ… ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
            margin: 0 auto; /* âœ… ì™¼ìª½/ì˜¤ë¥¸ìª½ ìë™ ì—¬ë°± ì¶”ê°€ */
        }
        h2 {
            width: 100%; /* ë„ˆë¹„ ì „ì²´ ì°¨ì§€ */
            text-align: center; /* ì¤‘ì•™ ì •ë ¬ */
            /*margin: 30px 0 15px 0; /* ìœ„ì•„ë˜ ì—¬ë°± ì¶”ê°€ */
            font-size: 22px; /* ê¸€ì”¨ í¬ê¸° ì¡°ì • */
            font-weight: bold; /* ê¸€ì”¨ ë‘ê»˜ ì¡°ì • */
        }
        /* ëª¨ë‹¬ ì°½ ë””ìì¸ */
        #reviewModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 480px;
            max-width: 90%;
            max-height: 75%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }
        /* âœ… ëª¨ë‹¬ í—¤ë” ìŠ¤íƒ€ì¼ */
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .modal-header h3 {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        #modalTitle {
            font-size: 18px;
            font-weight: bold;
        }

        /* âœ… ì˜¤ë¥¸ìª½ ìƒí’ˆ ì¶”ì²œ ì„¹ì…˜ */
        .recommendation-section {
            flex: 2; /* âœ… ì°¨íŠ¸ë³´ë‹¤ ì¢ê²Œ ì„¤ì • */
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        /* âœ… ë¦¬ë·° ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .review-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        /* âœ… ë¦¬ë·° ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .review-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #444;
        }
        
        .sentiment-negative {
            color: red;
            font-weight: bold;
        }

        .sentiment-neutral {
            color: orange;
            font-weight: bold;
        }

        .sentiment-positive {
            color: green;
            font-weight: bold;
        }

        /* ë¸Œëœë“œ ë¶„ì„ í‰ê°€ ì„¹ì…˜ (ê²€ìƒ‰ì°½ í¬í•¨) */
        .brand-analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
            gap: 20px;
            flex-wrap: wrap; /* âœ… ë°˜ì‘í˜• ëŒ€ì‘ */
        }

        .brand-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.15);
            padding: 15px;  /* âœ… ì—¬ë°± ì¤„ì´ê¸° */
            margin: 8px auto;
            max-width: 1300px; /* âœ… ê¸°ì¡´ ì„¤ì • ìœ ì§€ */
            position: relative;
            transition: transform 0.2s ease-in-out;
        }
        .brand-card:hover {
            transform: translateY(-3px);
        }
        .analysis-section {
            flex: 1;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        /* ë¶ˆí•„ìš”í•œ ë°°ê²½ ë° ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì œê±° */
        .analysis-section .box {
            background: transparent !important; /* âœ… ë°°ê²½ ì™„ì „ íˆ¬ëª… */
            padding: 0 !important; /* âœ… ë‚´ë¶€ ì—¬ë°± ì œê±° */
            margin: 0 !important; /* âœ… ì™¸ë¶€ ì—¬ë°± ì œê±° */
            border: none !important; /* âœ… í…Œë‘ë¦¬ ì œê±° */
            box-shadow: none !important; /* âœ… ê·¸ë¦¼ì ì œê±° */
            display: inline; /* âœ… ë°•ìŠ¤ê°€ ê¸€ì”¨ í¬ê¸°ì— ë§ë„ë¡ ì„¤ì • */
            font-size: 24px; /* âœ… ê¸€ì”¨ í¬ê¸° ì¡°ì • */
            font-weight: bold; /* âœ… êµµì€ ê¸€ì”¨ ìœ ì§€ */
            line-height: 1; /* âœ… ì¤„ ê°„ê²© ìµœì†Œí™” */
        }
        
        /* ê·¸ë˜í”„ ì»¨í…Œì´ë„ˆ */
        .graph-container {
            display: flex;
            justify-content: space-between; /* ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ ì •ë ¬ */
            align-items: stretch; /* âœ… ëª¨ë“  ë°•ìŠ¤ ë†’ì´ë¥¼ ë™ì¼í•˜ê²Œ ì¡°ì • */
            gap: 20px;
            margin-top: 20px;
        }
        .graph-container h3{
            font-size:16px;
        }
        /* ì™¼ìª½ì— ìœ„ì¹˜í•œ í† í”½ë³„ ë§Œì¡±ë„ & ì–¸ê¸‰ëŸ‰ */
        .graph-box {
            flex: 1; /* ë™ì¼í•œ ë„ˆë¹„ ì°¨ì§€ */
            background-color: #ffffff !important; /* âœ… í°ìƒ‰ ë°°ê²½ */
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 250px;
        }

        /* ì™¼ìª½ ì˜ì—­: í† í”½ë³„ ë§Œì¡±ë„ & ì–¸ê¸‰ëŸ‰ */
        .graph-left {
            background-color: #ffffff !important; /* âœ… í°ìƒ‰ ë°°ê²½ */
            display: flex;
            /* flex-direction: row; âœ… ê°€ë¡œ ì •ë ¬ ì ìš© */
            gap: 20px;
            flex: 1;
        }

        /* ì˜¤ë¥¸ìª½ ì˜ì—­: ë¸Œëœë“œ ì¢…í•© í‰ê°€ */
        .chart-right {
            background-color: #ffffff !important; /* âœ… í°ìƒ‰ ë°°ê²½ */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 20px;
            /* width: 100px; */
        }

        /* ë¸Œëœë“œ ë¶„ì„ í‰ê°€ ë°” */
        .bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            min-height: 20px; /* âœ… ìµœì†Œ ë†’ì´ ìœ ì§€ */
        }

        .bar-label {
            width: 120px;
            text-align: right;
            font-size: 13px;
            margin-right: 10px;
        }

        .bar-wrapper {
            flex: 1;
            position: relative;
            height: 18px;
            background-color: transparent;  /* âœ… íšŒìƒ‰ ì œê±° */
            border-radius: 8px;
        }
        
        .background-bar {
            width: 100%;
            height: 100%;
            background-color: transparent;  /* âœ… íšŒìƒ‰ ì œê±° */
            border-radius: 8px;
            position: absolute;
        }

        /* âœ… "í† í”½ë³„ ì–¸ê¸‰ëŸ‰" ì „ìš© ìŠ¤íƒ€ì¼ */
        .background-bar-sentiment {
            display: flex;  /* âœ… flex ì‚¬ìš©í•˜ì—¬ ë¹„ìœ¨ëŒ€ë¡œ ì •ë ¬ */
            justify-content: flex-start;  /* âœ… ì™¼ìª½ë¶€í„° ì •ë ¬ */
            width: 100%;
            height: 20px;
            border-radius: 10px;
            overflow: hidden; /* âœ… ë°”ë“¤ì´ ë„˜ì¹˜ì§€ ì•Šë„ë¡ ì„¤ì • */
        }

        .bar {
            height: 100%;
            border-radius: 8px;
            transition: width 1.5s ease-in-out;
        }

        .bar-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-size: 12px;
        }

        .bar-text-sentiment { 
            position: absolute;
            color: black; /* âœ… ê²€ì •ìƒ‰ ê¸€ì”¨ */
            font-weight: bold;
            font-size: 12px;
            white-space: nowrap; /* âœ… í…ìŠ¤íŠ¸ê°€ ì¤„ ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ ì„¤ì • */
        }
        .gauge-container {
            width: 140px;
            height: 70px;
            position: relative;
            margin: auto;
            display: inline-block;
            justify-content: center;
            align-items: center;
        }

        .gauge-svg {
            overflow: visible;
        }

        .gauge-background {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 16; /* âœ… ë°°ê²½ ë‘ê»˜ ì¡°ì • */
        }

        .gauge-fill {
            fill: none;
            /* stroke: #dc3f0b; ê¸°ë³¸ê°’: ë…¸ë€ìƒ‰ */
            stroke-width: 16;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-in-out;
        }

        .gauge-rating {
            font-size: 14px;
            font-weight: bold;
            fill: #333; /* ë“±ê¸‰ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
        }

        .gauge-text {
            font-size: 16px;
            font-weight: bold;
            fill: black;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        /* ê²€ìƒ‰ì°½ê³¼ ë¸Œëœë“œ ì¢…í•© í‰ê°€ë¥¼ ê°€ë¡œë¡œ ì •ë ¬ */
        .search-container-brand {
            display: flex;
            justify-content: space-between; /* âœ… ì¢Œìš° ì •ë ¬ (ì¢…í•© ì ìˆ˜ ì™¼ìª½, ê²€ìƒ‰ì°½+ë²„íŠ¼ ì˜¤ë¥¸ìª½) */
            align-items: center; /* âœ… ìˆ˜ì§ ì •ë ¬ */
            width: 100%;
            margin-bottom: 20px;
            /* gap: 20px; ê²€ìƒ‰ì°½ê³¼ ë¸Œëœë“œ ì¢…í•© í‰ê°€ ì‚¬ì´ ê°„ê²© ì¶”ê°€ */
        }

        .search-box-brand {
            display: flex;
            align-items: center;
            gap: 10px; /* ê²€ìƒ‰ì°½ê³¼ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ì¡°ì • */
            justify-content: flex-end; /* âœ… ì˜¤ë¥¸ìª½ ì •ë ¬ */
            flex: 1;
        }

        .brand-search-container {
            position: relative;
            min-width: 250px; /* âœ… ìµœì†Œ í¬ê¸° ì„¤ì • */
        }

        #brand-name {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border-radius: 20px;
            border: 1px solid #ccc;
            text-align: center;
        }

        #brand-suggestions {
            position: absolute;
            top: 100%; /* âœ… ê²€ìƒ‰ì°½ ë°”ë¡œ ì•„ë˜ ì •ë ¬ */
            left: 0;
            width: 100%; /* âœ… ê²€ìƒ‰ì°½ê³¼ ë™ì¼í•œ ë„ˆë¹„ */
            background: white;
            border: 1px solid #ddd;
            border-top: none; /* âœ… ìœ„ìª½ í…Œë‘ë¦¬ ì œê±° */
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* âœ… ê·¸ë¦¼ì ì¶”ê°€ */
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            z-index: 1000; /* âœ… ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
        }
        .search-box-brand input {
            width: 100%; /* âœ… ë¶€ëª¨ ë„ˆë¹„ë¥¼ ë”°ë¼ê° */
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .search-box-brand button {
            padding: 12px 20px;
            font-size: 16px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        .guideline-card {
            padding: 24px;
            border-radius: 16px;
            background-color: #ffffff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            max-width: 680px;
            margin: 0 auto;
            font-family: 'Pretendard', sans-serif;
            line-height: 1.8;
            font-size: 15.5px;
        }
        .guideline-header {
            text-align: center;
            margin-bottom: 24px;
        }
        .guideline-header h2 {
            font-size: 22px;
            font-weight: 700;
            color: #222;
            word-break: break-word;
            white-space: normal;
            line-height: 1.4;
        }
        .guideline-title {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .guideline-section {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007acc;
        }

        .section-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #005b9f;
        }

        .section-content {
            font-size: 15px;
            color: #333;
        }

        .guideline-card p:first-child {
            margin-top: 0;
        }

        .guideline-card strong {
            font-weight: 600;
            color: #000;
        }

            /* ğŸ”¹ ë¸Œëœë“œ íŒë§¤ëŸ‰ ì¶”ì´ë¥¼ í† í”½ë³„ ì–¸ê¸‰ëŸ‰ ì˜†ìœ¼ë¡œ ë°°ì¹˜ */
        .graph-right {
            display: flex;
            gap: 20px;
        }

        /* ğŸ”¹ ë¸Œëœë“œ ì¢…í•© í‰ê°€ëŠ” ë³„ë„ë¡œ ë°°ì¹˜ */
        .chart-top {
            display: flex;
            justify-content: flex-start; /* âœ… ì™¼ìª½ ì •ë ¬ */
            align-items: center;
        }
        
        /* ë¸Œëœë“œ ì¢…í•© í‰ê°€ (ìœ„ìª½ì— ë°°ì¹˜) */
        /* ê³µí†µ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .graph-box,
        .score-box {
            flex: 1; /* âœ… ë™ì¼í•œ ë„ˆë¹„ ë°°ë¶„ */
            background-color: #ffffff !important; /* âœ… í•˜ì–€ìƒ‰ ë°°ê²½ */
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 200px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.15);
        }

        .score-box h3 {
            display: flex;
            align-items: center;
            justify-content: center; /* âœ… ì¤‘ì•™ ì •ë ¬ */
            gap: 4px;
            font-size: 16px; /* âœ… ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì • */
            margin-bottom: 20px;  /* âœ… ê¸€ìì™€ ê·¸ë˜í”„ ì‚¬ì´ ì—¬ë°± ì¶”ê°€ */
        }

        .graph-box h3 {
            margin-bottom: 15px; /* ê¸°ì¡´ë³´ë‹¤ ì—¬ë°± ì¶”ê°€ */
            /* padding-bottom: 5px; í•„ìš”í•˜ë©´ ì¶”ê°€ */
        }

        .legend {
            font-size: 12px;
            margin-left: 15px;
            display: inline-flex;
            gap: 10px;
            vertical-align: middle;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-weight: bold;
            gap: 4px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            display: inline-block;
            border-radius: 2px; /* âŒ ì•ˆ ë‘¥ê¸€ê²Œ - ë„¤ëª¨ë°•ìŠ¤ */
            /* box-shadow: 0 0 1px rgba(0, 0, 0, 0.2); (ì„ íƒ) ì…ì²´ê° */
        }
        
        /* ë¸Œëœë“œ íŒë§¤ëŸ‰ ì¶”ì´ (ì•„ë˜ìª½ì— ë°°ì¹˜) */
        .brand-sales-chart-container {
            width: 100%;
            max-width: 500px; /* ìµœëŒ€ ë„ˆë¹„ */
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .suggestions {
            position: absolute;
            top: 100%; /* âœ… ê²€ìƒ‰ì°½ ë°”ë¡œ ì•„ë˜ ì •ë ¬ */
            left: 0;
            width: 100%; /* âœ… ê²€ìƒ‰ì°½ê³¼ ë™ì¼í•œ ë„ˆë¹„ */
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            z-index: 1000; /* âœ… ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            border-radius: 8px;
        }


        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
        }

        .suggestion-item:hover {
            background: #f0f0f0;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 6px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: none;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        .tooltip-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip-icon {
        /* margin-left: 6px; */
        font-size: 12px;
        color: #555;
        }

        .tooltip-text {
        visibility: hidden;
        width: 220px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 8px;
        font-size: 12px;

        position: absolute;
        z-index: 1;
        bottom: 125%; /* ì•„ì´ì½˜ ìœ„ì— í‘œì‹œ */
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
        white-space: normal;
        }

        .tooltip-wrapper:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
        }

        
        /* âœ… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); /* âœ… ì‚´ì§ íë¦° ë°°ê²½ */
            backdrop-filter: blur(15px); /* âœ… íë¦¼ íš¨ê³¼ ì¶”ê°€ */
            width: 80%;
            max-width: 600px;
            padding: 20px;
            border-radius: 12px; /* âœ… ë” ë¶€ë“œëŸ¬ìš´ ê³¡ì„  */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* âœ… ê·¸ë¦¼ì ê°•ì¡° */
            z-index: 1000;
        }
        
        .modal-content {
            text-align: center;
        }
        .modal.show {
            display: block;
            visibility: visible;
            opacity: 1;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;  /* âœ… ëª¨ë‹¬ë³´ë‹¤ ì‚´ì§ ë‚®ì€ ê°’ */
            display: none;
        }
        
        /* ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ */
        .close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 24px;  /* âœ… í¬ê¸° í‚¤ì›€ */
            font-weight: bold;
            cursor: pointer;
            color: #ff4d4d; /* âœ… ë‹«ê¸° ë²„íŠ¼ ê°•ì¡° */
            transition: color 0.2s ease-in-out;
        }
        .close:hover {
            color: #d9534f;
        }
        /* âœ… ë²„íŠ¼ ê·¸ë£¹ ì •ë ¬ */
        /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .button-group {
        display: flex;
        justify-content: flex-start;  /* â† ì™¼ìª½ ì •ë ¬ */
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: nowrap;     /* âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }
        /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s, box-shadow 0.2s;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1); /* ğŸ‘‰ ë²„íŠ¼ì´ ì‚´ì§ ë–  ë³´ì´ê²Œ */
        }
        .btn:hover {
            background: #0056b3;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.15);
        }
        /* âœ… ê°ì„± ë¶„ì„ ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .card-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        /* âœ… ê°ì„± ë¶„ì„ ê°œë³„ ì¹´ë“œ */
        .card {
            width: 45%;
            padding: 20px;
            background: white;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            text-align: center;
        }
        /* âœ… ì´ìƒ ê°ì§€ ëª©ë¡ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #anomalyModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            width: 60%;  /* âœ… í™”ë©´ì˜ 60% í¬ê¸° */
            max-height: 80vh;  /* âœ… í™”ë©´ ë†’ì´ì˜ 80% ì´ìƒ ì»¤ì§€ì§€ ì•Šë„ë¡ ì„¤ì • */
            padding: 20px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;  /* âœ… ëª¨ë‹¬ ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* âœ… ëª¨ë‹¬ ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • */
        #modalAnomalyList {
            max-height: 60vh;  /* âœ… ëª¨ë‹¬ ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ë†’ì´ ì œí•œ */
            overflow-y: auto;  /* âœ… ìŠ¤í¬ë¡¤ í•„ìš” ì‹œ í™œì„±í™” */
            padding-right: 10px;
        }
        .custom-chart-container {
            flex: 1 1 calc(33.33% - 20px);
            min-width: 280px; /* âœ… ê¸°ì¡´ë³´ë‹¤ í¬ê¸° ì¤„ì´ê¸° */
            text-align: center;
            background: white;
            padding: 12px;
            min-height: 250px; /* âœ… ìµœì†Œ ë†’ì´ ì„¤ì • */
            border-radius: 10px;
            box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.1);
        }
        /* âœ… ì°¨íŠ¸ í–‰ ì •ë ¬ (ê°„ê²© ì¡°ì •) */
        .custom-chart-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        /* âœ… ê°ì„± ë¶„ì„ ì¹´ë“œ ìŠ¤íƒ€ì¼ (ì „ì²´ ì¹´ë“œ í¬ê¸° í™•ì¥) */
        /* âœ… ê°ì„± ë¶„ì„ ì¹´ë“œ í¬ê¸° ì¡°ì • (ìœ„ìª½ ì¹´ë“œì™€ ë™ì¼í•œ í¬ê¸°) */
        .anomal-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.15);
            padding: 15px;  /* âœ… ì—¬ë°± ì¤„ì´ê¸° */
            margin: 8px auto;
            max-width: 1300px; /* âœ… ê¸°ì¡´ ì„¤ì • ìœ ì§€ */
            position: relative;
            transition: transform 0.2s ease-in-out;
        }
        .anomal-card:hover {
            transform: translateY(-3px);
        }
        /* âœ… ì œëª©ê³¼ ë²„íŠ¼ì„ ê°™ì€ ì¤„ì— ë°°ì¹˜ */
        /* ì¹´ë“œ í—¤ë”: ì œëª©ê³¼ ë²„íŠ¼ì„ ê°™ì€ ì¤„ì— ë°°ì¹˜ */
        /* ì¹´ë“œ í—¤ë” */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        /* ì œëª©ì´ ì¤‘ì•™ì— ì •í™•íˆ ìœ„ì¹˜í•˜ë„ë¡ ì¡°ì • */
        .card-header h2 {
            flex-grow: 1; /* ê°€ë³€ì ì¸ ë„ˆë¹„ í™•ë³´ */
            text-align: center;
            margin: 0;
            font-size: 24px; /* ì œëª© í¬ê¸° ì¡°ì • */
            font-weight: bold;
        }
        /* âœ… ì°¨íŠ¸ í–‰ ì •ë ¬ (ê°„ê²© ì¡°ì •) */
        .custom-chart-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .custom-button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        /* âœ… ì°¨íŠ¸ í¬ê¸° ìë™ ì¡°ì • */
        .custom-chart {
            width: 100% !important;
            height: 230px !important; /* âœ… ê¸°ì¡´ë³´ë‹¤ ì•½ê°„ ì¤„ì´ê¸° */
        }
        /* ë²„íŠ¼ì´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì •ë ¬ë˜ë„ë¡ ì„¤ì • */
        .card-buttons {
            position: absolute;
            right: 20px; /* ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì •ë ¬ */
        }
        /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        /* ë²„íŠ¼ í¬ê¸° ì¡°ì • (ì¤„ë°”ê¿ˆ ë°©ì§€) */
        /* ë²„íŠ¼ í¬ê¸° ì¡°ì • (ì¤„ë°”ê¿ˆ ë°©ì§€) */
        .card-buttons .btn {
            padding: 8px 14px;
            font-size: 14px;
            white-space: nowrap;
        }
        .card-buttons .btn:hover {
            background: #0056b3;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.15);
        }
        .ranking-container ul {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        .ranking-container ul li {
            padding: 5px 0;
            font-size: 14px;
            border-bottom: 1px solid #ddd;
        }
        /* âœ… ìˆœìœ„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        /* âœ… ìˆœìœ„ ì¹´ë“œ (ì™¼ìª½ ê³ ì •) */
        /* âœ… ìˆœìœ„ ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .ranking-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 300px;
            max-width: 500px;
        }

/* âœ… ê°œë³„ ìˆœìœ„ ì¹´ë“œ */
        /* âœ… ìˆœìœ„ ì¹´ë“œ (í•˜ë‚˜ë¡œ í†µí•© & 2x2 ê·¸ë¦¬ë“œ) */
        /* âœ… ê°œë³„ ìˆœìœ„ ì¹´ë“œ */
        /* âœ… ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
            /* âœ… ìˆœìœ„ ì¹´ë“œ í¬ê¸° ì¤„ì´ê¸° */
    .ranking-section {
        width: 98%;
        min-height: 220px; /* âœ… ì°¨íŠ¸ì™€ ê°™ì€ ë†’ì´ë¡œ ë§ì¶¤ */
        padding: 8px;
        border-radius: 10px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* âœ… ë‚´ë¶€ ìš”ì†Œ ê· í˜• ìœ ì§€ */
        font-size: 14px; /* í°íŠ¸ í¬ê¸°ë„ ì¡°ì • */
    }
    .flex-container {
        display: flex;
        justify-content: space-between; /* ì¢Œìš° ì •ë ¬ */
        gap: 20px; /* ê°„ê²© ì¡°ì • */
    }
    .ranking-section h4 {
        text-align: center;
        margin-bottom: 10px;
        font-size: 16px;
    }
        /* ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .ranking-list {
            list-style: none;
            padding: 0;
            text-align: left;
            margin: 10px 0;
        }
            .ranking-list li {
        background: #f8f8f8;
        padding: 8px;
        border-radius: 6px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
        font-size: 13px;
    }
        /* âœ… ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .top-rank {
            color: #FFD700; /* ê¸ˆìƒ‰ */
            font-weight: bold;
        }
        .low-rank {
            color: #ff4d4d; /* ë¹¨ê°„ìƒ‰ */
            font-weight: bold;
        }
        /* âœ… ìˆœìœ„ í•­ëª© ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
.ranking-item {
    width: 90% !important;
    padding: 12px !important;
    margin: 6px auto !important;
    border-radius: 8px !important;
    font-weight: bold !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    background: #ffffff !important;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1) !important;
    transition: transform 0.2s, box-shadow 0.2s, background 0.3s !important;
    cursor: pointer !important;
    color: black !important;
}

.ranking-item::before {
    display: inline; /* âœ… í˜¹ì‹œ hiddenì´ë©´ ë³€ê²½ */
    content: "ğŸ†"; /* âœ… ì•„ì´ì½˜ ê°•ì œ ì‚½ì… */
}

/* ë§ˆìš°ìŠ¤ ì˜¬ë¦´ ë•Œ íš¨ê³¼ */
.ranking-item:hover {
    transform: scale(1.05);
    box-shadow: 3px 3px 12px rgba(0, 0, 0, 0.2);
}
/* âœ… ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ */
.ranking {
    margin-bottom: 10px;
}

/* ìƒìœ„ ë¸Œëœë“œ ìŠ¤íƒ€ì¼ */
.ranking-item.top {
    background: linear-gradient(135deg, #fff7c2, #ffdd57) !important;
    color: black !important;
}

/* í•˜ìœ„ ë¸Œëœë“œ ìŠ¤íƒ€ì¼ */
/* âœ… í•˜ìœ„ ë¸Œëœë“œ ìŠ¤íƒ€ì¼ */
.ranking-item.low {
    background: linear-gradient(135deg, #ffb6b6, #ff6b6b) !important;
    color: black !important;
}
/* âœ… ë§ˆìš°ìŠ¤ í˜¸ë²„ íš¨ê³¼ */
.ranking-item.top:hover {
    background: linear-gradient(135deg, #FFD700, #FFA500) !important;
    color: white !important;
}

/* í•˜ìœ„ ë¸Œëœë“œ ìŠ¤íƒ€ì¼ */
.ranking-item.low:hover {
    background: linear-gradient(135deg, #ff4d4d, #ff6666);
    color: white;
}
/* âœ… ìˆ¨ê¹€ ì²˜ë¦¬ */
.hidden {
    display: none;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.rank-toggle-btn {
    padding: 10px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    margin: 5px;
    transition: background 0.3s, box-shadow 0.2s;
}

.rank-toggle-btn:hover {
    background: #0056b3;
}

.rank-toggle-btn.active {
    background: #004080;
}
/* âœ… ìƒìœ„/í•˜ìœ„ ìˆœìœ„ ìŠ¤íƒ€ì¼ */
.ranking-list li.top {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: white;
}
.ranking-list li.low {
    background: linear-gradient(135deg, #ff4d4d, #ff6666);
    color: white;
}
/* âœ… ì œëª© & ë‚ ì§œ í•„í„° ì •ë ¬ */
.chart-header {
    display: flex;
    justify-content: center;  /* ì œëª©ì„ ì¤‘ì•™ ì •ë ¬ */
    align-items: center;
    position: relative;
    padding: 10px 20px;
}

/* âœ… "íŒë§¤ëŸ‰ ë¶„ì„" ì œëª©ì„ ì •í™•íˆ ì¤‘ì•™ì— ë°°ì¹˜ */
.chart-header h3 {
    font-size: 24px;
    font-weight: bold;
    margin: 0;
    white-space: nowrap;
}
#ws-status {
    display: none; /* ìš”ì†Œë¥¼ ì™„ì „íˆ ìˆ¨ê¹€ */
}
/* âœ… ì œëª©ê³¼ ì¡°íšŒ í•„í„°ë¥¼ í•œ ì¤„ë¡œ ì •ë ¬ */
.anomal-card .title-filter-container {
    display: flex;
    justify-content: space-between; /* ğŸ‘‰ ì œëª©ê³¼ í•„í„°ë¥¼ ì¢Œìš° ì •ë ¬ */
    align-items: center;
    margin-bottom: 10px; /* âœ… ì°¨íŠ¸ì™€ ê°„ê²© ìœ ì§€ */
}

/* âœ… ì œëª© ìŠ¤íƒ€ì¼ */
.anomal-card h2 {
    font-size: 22px;
    font-weight: bold;
    margin: 0;
}

/* âœ… ì¡°íšŒ í•„í„° ìŠ¤íƒ€ì¼ */
.anomal-card .date-filter {
    display: flex;
    gap: 10px;
    align-items: center;
}

/* âœ… ë“œë¡­ë‹¤ìš´ê³¼ ë²„íŠ¼ ë””ìì¸ */
.anomal-card .date-filter select,
.anomal-card .date-filter button,
.anomal-card .date-filter input {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background: white;
}

/* âœ… ì¡°íšŒ ë²„íŠ¼ ë””ìì¸ */
.anomal-card .date-filter button {
    background: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease-in-out;
}

.anomal-card .date-filter button:hover {
    background: #388E3C;
}

/* âœ… ì°¨íŠ¸ì™€ ë‚ ì§œ í•„í„° ì‚¬ì´ ê°„ê²© ì¡°ì • */
.anomal-card .custom-chart-row {
    display: flex;
    justify-content: space-between; /* ğŸ‘‰ ì°¨íŠ¸ ê· í˜• ìˆê²Œ ì •ë ¬ */
    align-items: stretch;
    padding-top: 5px;
}
/* âœ… ì œëª© + ë‚ ì§œ í•„í„°ë¥¼ ê°™ì€ ì¤„ì— ì •ë ¬ */
.header-container {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    border-bottom: 1px solid #e0e0e0;
    position: relative; /* âœ… ì œëª© ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ ìƒëŒ€ ìœ„ì¹˜ ì§€ì • */
    height: 50px; /* âœ… ë†’ì´ ì¡°ì • */
}

/* âœ… ì œëª©(h2)ì„ ì •í™•íˆ ì¤‘ì•™ì— ë°°ì¹˜ */
.header-container h2 {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    margin: 0;
    font-size: 22px;
    font-weight: bold;
    pointer-events: none; /* âœ… ì œëª©ì´ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ê°€ë¡œì±„ì§€ ì•Šë„ë¡ ì„¤ì • */
}

/* âœ… í•„í„°ë¥¼ ì˜¤ë¥¸ìª½ ì •ë ¬ */
.filter-container {
    margin-left: auto; /* âœ… ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ ì´ë™ */
    display: flex;
    gap: 10px;
    align-items: center;
    font-size: 14px;
    z-index: 1; /* âœ… í•„í„°ê°€ ì œëª© ìœ„ë¡œ ì˜¬ë¼ì˜¤ë„ë¡ ì„¤ì • */
}

/* âœ… ë¼ë²¨ê³¼ ë“œë¡­ë‹¤ìš´ ì •ë ¬ */
.filter-container label {
    font-size: 14px;
    font-weight: bold;
    margin-right: 3px;
    white-space: nowrap;
}

/* âœ… ë“œë¡­ë‹¤ìš´ ë””ìì¸ */
.filter-container select {
    padding: 5px 10px;
    font-size: 14px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background: white;
    height: 34px; /* âœ… ë“œë¡­ë‹¤ìš´ ë†’ì´ ì¡°ì • */
}

/* âœ… ì¡°íšŒ ë²„íŠ¼ ë””ìì¸ */
.filter-container button {
    background: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease-in-out;
    padding: 5px 12px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 34px; /* âœ… ë“œë¡­ë‹¤ìš´ê³¼ ë†’ì´ ë§ì¶¤ */
    font-size: 14px;
    white-space: nowrap;
    z-index: 2; /* âœ… ë²„íŠ¼ì´ ìµœìƒìœ„ë¡œ ì˜¤ë„ë¡ ì„¤ì • */
}

.filter-container button:hover {
    background: #388E3C;
}
/* ëª¨ë‹¬ ì „ì²´ í‹€ */
#guidelineModal.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    width: 80%;
    max-width: 700px;
    max-height: 80vh;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    overflow: hidden;
}

/* ëª¨ë‹¬ ë‚´ë¶€ ë³¸ë¬¸ (ìŠ¤í¬ë¡¤ ì ìš©) */
.guideline-modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: 70vh;
    position: relative;
}

/* ë‹«ê¸° ë²„íŠ¼ */
.guideline-modal-body .close {
    position: absolute;
    top: 12px;
    right: 18px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    color: #ff4d4d;
}
.guideline-modal-body .close:hover {
    color: #d9534f;
}
#resizeHandle {
  width: 16px;
  height: 16px;
  background: #ccc;
  position: absolute;
  right: 0;
  bottom: 0;
  cursor: se-resize;
  border-bottom-right-radius: 4px;
}
    </style>
</head>

{% extends "base.html" %}
{% block title %}ë©”ì¸ í˜ì´ì§€{% endblock %}
{% block content %}

<div class="mainPage-content"> 
    <!-- <h2 style="margin-top: 30px;">ë¦¬ë·° ë¶„ì„ ë©”ë‰´</h2>

    <div class="grid">
        <div class="menu-box" onclick="navigateTo('/overall-analysis')">ì¢…í•© í‰ê°€</div>
        <div class="menu-box" onclick="navigateTo('/strength-weakness.html')">ê°•/ì•½ì  ì œê³µ</div>
        <div class="menu-box" onclick="navigateTo('/top-ranked')">ì„  ìˆœìœ„ ì œê³µ</div> -->
        <!-- <div class="menu-box" onclick="navigateTo('/size_analysis.html')">ì‚¬ì´ì¦ˆ ë¶„ì„</div> -->
        <!-- <div class="menu-box" onclick="navigateTo('/date_analysis.html')">ë‚ ì§œ ë¶„ì„</div>
        <div class="menu-box" onclick="navigateTo('/product-review')">ì œí’ˆ í‰ê°€</div>
        <div class="menu-box" onclick="navigateTo('/brand-analysis')">ë¸Œëœë“œ ë¶„ì„</div>
        <div class="menu-box" onclick="navigateTo('/anomaly-detection.html')">ì´ìƒ ê°ì§€ ë¦¬ë·° ë¶„ì„</div>
    </div> -->

    <!-- <div class="search-container">
        <input type="text" placeholder="ë¸Œëœë“œëª…ì„ ì…ë ¥í•˜ì„¸ìš”...">
        <button>ê²€ìƒ‰</button>
    </div> -->
<!-- ############################################################################################ -->

    <!-- ğŸ”¹ íŒë§¤ëŸ‰ ì¶”ì´ -->
    <!-- ğŸ”¹ íŒë§¤ëŸ‰ ë¶„ì„ -->
    <div class="ranking-card">
        <div class="chart-header">   
            <h2>ë¸Œëœë“œ/ì œí’ˆ ìˆœìœ„</h2>
        </div>

        <!-- âœ… 1x2 ë ˆì´ì•„ì›ƒ -->
        <div class="ranking-box">
            <!-- âœ… ë¸Œëœë“œ ìˆœìœ„ & ì œí’ˆ ìˆœìœ„ ë‚˜ë€íˆ ë°°ì¹˜ -->
                <div class="ranking-section">
                    <h4>ë¸Œëœë“œ ìˆœìœ„</h4>
                    <ul class="ranking-list" id="top-brands"></ul>
                    <h4>í•˜ìœ„ ë¸Œëœë“œ</h4>
                    <ul class="ranking-list" id="bottom-brands"></ul>
                </div>
                <div class="ranking-section">
                    <h4>ì œí’ˆ ìˆœìœ„</h4>
                    <ul class="ranking-list" id="top-products"></ul>
                    <h4>í•˜ìœ„ ì œí’ˆ</h4>
                    <ul class="ranking-list" id="bottom-products"></ul>
                </div>
        </div>
    </div>
    
    <div class="sales-card">
        <!-- âœ… ì œëª© & ë‚ ì§œ í•„í„° í•œ ì¤„ ì •ë ¬ -->
        <div class="chart-header">
            <h2>íŒë§¤ëŸ‰ ë¶„ì„</h2>
            <!-- ë²„íŠ¼: ëª¨ë‹¬ ì—´ê¸° -->
            <div class="sales-button">
                <button id="toggleAnalysisButton" onclick="salesModal()">íŒë§¤ëŸ‰ ë¶„ì„ ë¦¬í¬íŠ¸</button> 
            </div>
            <!-- ë‚ ì§œ í•„í„° -->
            <div class="date-filter">
                <input type="date" id="startDate">
                <input type="date" id="endDate">
                <button onclick="loadCharts()">ì¡°íšŒ</button>
            </div>
        </div>   

        <!-- âœ… íŒë§¤ëŸ‰ ì¶”ì´ ë¶„ì„ ëª¨ë‹¬ -->
        <div id="salesModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('salesModal')">&times;</span>
                <h3 id="modalSalesTitle">íŒë§¤ëŸ‰ ì¶”ì´ ë¶„ì„ ë‚´ìš©</h3>
                <div id="modalSalesList">
                    <p>-------------------------------------------------------------------------------------------</p>
                    <p>ì°¸ê³  : ë‹¤ë¥¸ ì—°ë„ ëŒ€ë¹„ 2025ë…„ ë°ì´í„°ì–‘ì´ ì ì–´ì„œ ê·¸ë˜í”„ìƒ ê¸‰ê°í•˜ê³  ìˆìŠµë‹ˆë‹¤. </p>
                    <p>-------------------------------------------------------------------------------------------</p>
                    <p>ğŸ”¹ì „ì²´ íŒë§¤ëŸ‰ ì¶”ì´ ë¶„ì„ğŸ”¹</p>
                    <p>2019ë…„ë¶€í„° ì ì§„ì ìœ¼ë¡œ íŒë§¤ëŸ‰ì´ ì¦ê°€í•˜ë‹¤ê°€ ì§€ê¸ˆì€ ì •ì²´ì¤‘ì…ë‹ˆë‹¤.</p>
                    <p>2023ë…„ 1ì›”, 2024ë…„ 9ì›”ì— íŒë§¤ëŸ‰ ê¸‰ê°í•˜ì˜€ëŠ”ë° ì›ì¸ íŒŒì•…ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <p>-------------------------------------------------------------------------------------------</p>
                    <p>ğŸ”¹ ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëŸ‰ ì¶”ì´ ë¶„ì„ğŸ”¹</p>
                    <p>ì—¬ë¦„ ì‹œì¦Œ ìƒí’ˆì¸ 'ìƒŒë“¤/ìŠ¬ë¦¬í¼'ì™€ ê²¨ìš¸ ì‹œì¦Œ ìƒí’ˆì¸ 'êµ¬ë‘'ì™€ 'ë¶€ì¸ /ì›Œì»¤'ëŠ” 2023ë…„ ëŒ€ë¹„ 2024ë…„ì—ëŠ” íŒë§¤ëŸ‰ì´ ê°ì†Œí•˜ì˜€ìœ¼ë‹ˆ ê³µê¸‰ëŸ‰ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                    <p>'ë“±ì‚°í™”'ì™€ 'íŠ¸ë ˆí‚¹í™”'ëŠ” íŒë§¤ëŸ‰ì´ ê¸‰ê²©í•˜ê²Œ ì¦ê°€í•˜ê³  ìˆëŠ” ì¸ê¸° ìƒí’ˆìœ¼ë¡œ ê³µê¸‰ëŸ‰ì„ ëŠ˜ë¦¬ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                    <p>-------------------------------------------------------------------------------------------</p>
                    <p>ğŸ”¹ ì„±ë³„ íŒë§¤ëŸ‰ ì¶”ì´ ë¶„ì„ğŸ”¹</p>
                    <p>ì—¬ì„±ì œí’ˆì˜ êµ¬ë§¤ìœ¨ì´ 2022ë…„ë¶€í„° ê¸‰ì¦í•˜ë‹¤ 2024ë…„ì—” ê°ì†Œí•˜ì˜€ìœ¼ë‹ˆ ê³µê¸‰ëŸ‰ì„ ì¤„ì´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                    <p>ë‚¨ë…€ê³µìš©ì œí’ˆ êµ¬ë§¤ìœ¨ì´ 2020ë…„ë¶€í„° íŒë§¤ëŸ‰ì´ ê¸‰ì¦í•˜ê³  ìœ ì§€í•˜ê³  ìˆìœ¼ë‹ˆ ê³µê¸‰ëŸ‰ì„ ìœ ì§€ ë˜ëŠ” ì†Œí­ ì¦ê°€ì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                    <p>ë‚¨ì„±ì œí’ˆ êµ¬ë§¤ìœ¨ì´ 2021ë…„ë¶€í„° íŒë§¤ëŸ‰ì´ ì ì§„ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ì¤‘ì´ë‹ˆ ê³µê¸‰ëŸ‰ì„ ëŠ˜ë¦¬ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>



        <div class="sales-box">
                <!-- âœ… ì „ì²´ íŒë§¤ëŸ‰ -->
            <div class="sales-container">
                <h4>ì „ì²´ íŒë§¤ëŸ‰ ì¶”ì´</h4>
                <canvas class="sales-chart" id="totalSalesChart"></canvas>
            </div>
                 <!-- âœ… ì„±ë³„ íŒë§¤ëŸ‰ -->
            <div class="sales-container">
                <h4>ì„±ë³„ íŒë§¤ëŸ‰ ì¶”ì´</h4>
                <canvas class="sales-chart" id="genderSalesChart"></canvas>
            </div>
                <!-- âœ… ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëŸ‰ -->
            <div class="sales-container">
                <h4>ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ëŸ‰ ì¶”ì´</h4>
                <canvas class="sales-chart" id="categorySalesChart"></canvas>
            </div>
        </div>
    </div>     


<!-- ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„  -->

<!-- âœ… í† ê¸€ ë°©ì‹ìœ¼ë¡œ ëª©ë¡ì„ ìˆ¨ê¸´ ìƒíƒœì—ì„œ í´ë¦­ ì‹œ ë³´ì´ê²Œ ë³€ê²½ -->
<!-- âœ… ê°ì„± ë¶„ì„ ì¹´ë“œ -->

    <span id="today_date" style="display: none;"></span>

    <!-- âœ… ì˜¤ëŠ˜ ê°ì„± ë¶„ì„ -->
    <div class="anomal-card">
        <div class="card-header">
            <span id="ws-status">ğŸ”„ WebSocket ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
            <h2>ì˜¤ëŠ˜ / ì´ë²ˆì£¼ ë¦¬ë·° ë¶„ì„</h2>
            <div class="card-buttons">
                <button id="today-btn" class="btn">ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ëª©ë¡</button>
                <button id="weekly-btn" class="btn">ì´ë²ˆ ì£¼ ì´ìƒ ê°ì§€ ëª©ë¡</button>
            </div>
        </div>
        <div class="custom-chart-row">
            <div class="custom-chart-container">
                <h4>ê°ì„± ë¹„ìœ¨</h4>
                <canvas class="custom-chart" id="stackedSentimentChart"></canvas>
            </div>
            <div class="custom-chart-container">
                <h4>ë¦¬ë·° í† í”½ë³„ ì–¸ê¸‰ëŸ‰</h4>
                <canvas class="custom-chart" id="reviewTopicChart"></canvas>
            </div>
            <div class="custom-chart-container">
                <h4>í‰ì  ë¶„í¬</h4>
                <canvas class="custom-chart" id="ratingDistributionChart"></canvas>
            </div>
        </div>
    </div>

    <div class="anomal-card">
        <!-- âœ… ì œëª© + í•„í„° -->
        <div class="header-container">
            <div style="margin-top: 4px; margin-bottom: 12px; text-align: right;">
                <button id="monthlyGuidelineBtn" class="btn btn-secondary">
                    ì›”ê°„ ì´ìƒ ê°ì§€ ë¦¬í¬íŠ¸
                 </button>
            </div>
            <h2>ì´ìƒ ê°ì§€ ë¦¬ë·° ë° ì œí’ˆ í˜„í™©</h2>
            <div class="filter-container">
                <label for="yearSelect">ì—°ë„:</label>
                <select id="yearSelect"></select>
    
                <label for="monthSelect">ì›”:</label>
                <select id="monthSelect"></select>
    
                <button onclick="updateAnomalyTrend()">ì¡°íšŒ</button>
            </div>
        </div>
    
        <!-- âœ… ì°¨íŠ¸ -->
        <div class="custom-chart-row">
            <div class="custom-chart-container">
                <h4>ì´ìƒ ê°ì§€ ì¶”ì´</h4>
                <canvas class="custom-chart" id="anomalyTrendChart"></canvas>
            </div>
            <div class="custom-chart-container">
                <h4>ì¹´í…Œê³ ë¦¬ë³„ ì´ìƒ ê°ì§€ ë¶„í¬</h4>
                <canvas class="custom-chart" id="shoesAnomalyChart"></canvas>
            </div>
            <div class="custom-chart-container">
                <h4>ì´ìƒ ê°ì§€ëœ ì œí’ˆ ì°¨íŠ¸</h4>
                <canvas class="custom-chart" id="anomalyProductChart"></canvas>
            </div>
        </div>
    </div>
    

    <!-- âœ… ë¦¬ë·° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('reviewModal')">&times;</span>
            <h3 id="modalReviewTitle"></h3>
            <div id="modalReviewList"></div>
        </div>
    </div>

        <!-- âœ… ì´ìƒ ê°ì§€ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="anomalyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('anomalyModal')">&times;</span>
            <h2 id="modalAnomalyTitle">ì´ìƒ ê°ì§€ ëª©ë¡</h2>
            <div id="modalAnomalyList"></div>
        </div>
    </div>
    <div id="guidelineModal" class="modal">
        <div class="guideline-modal-body"> <!-- ê¸°ì¡´ modal-content â†’ ë³€ê²½ë¨ -->
          <span class="close" onclick="closeGuidelineModal()">&times;</span>
          <div id="guidelineModalContent"></div>
        </div>
      </div>
      <!-- ğŸ§  ì›”ê°„ ì¢…í•© ê°€ì´ë“œë¼ì¸ ì „ìš© ëª¨ë‹¬ -->
      <div id="monthlyGuidelineModal" class="modal">
        <div class="modal-content guideline-modal-body" id="monthlyGuidelineContentWrapper">
          <div class="modal-drag-header" id="monthlyGuidelineHeader">
            <span class="close" onclick="closeMonthlyGuidelineModal()">&times;</span>
          </div>
          <div id="monthlyGuidelineContent"></div>
      
          <!-- âœ… í¬ê¸° ì¡°ì ˆ í•¸ë“¤ (ì˜¤ë¥¸ìª½ ì•„ë˜) -->
          <div id="resizeHandle"></div>
        </div>
      </div>
    <div id="notification" class="notification"></div>
    <!-- ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„  -->

    <div class="brand-card">
        <!-- ë¸Œëœë“œ ë¶„ì„ í‰ê°€ ì˜ì—­ ì „ì²´ -->
        <div class="brand-analysis-header">
            <!-- ì™¼ìª½: ì¢…í•© ì ìˆ˜ -->
            <div class="score-box">
                <h3>ì¢…í•© ì ìˆ˜
                    <span class="tooltip-wrapper">
                        <span class="tooltip-icon">&#10068;</span>
                        <span class="tooltip-text">
                            1. ê°ì„± ì ìˆ˜ë¥¼ 0~100 ë²”ìœ„ë¡œ ë³€í™˜<br>
                            2. ë¦¬ë·° ê°œìˆ˜ ë°˜ì˜<br>
                            - ë¦¬ë·°ê°€ 30ê°œ ë¯¸ë§Œì´ë©´ ê°ì ì„ í¬ê²Œ (*0.7)<br>
                            - 100ê°œ ë¯¸ë§Œì´ë©´ *0.85, 300ê°œ ë¯¸ë§Œì´ë©´ *0.95<br>
                            - 300ê°œ ì´ìƒì´ë©´ ê°ì  ì—†ìŒ (1.0)<br>
                            3. ìµœê·¼ ê¸ì • ë¦¬ë·° ë¹„ìœ¨ ë°˜ì˜<br>
                            - ìµœê·¼ ê¸ì • ë¦¬ë·° ë¹„ìœ¨ì´ 30% ë¯¸ë§Œì´ë©´ ê°ì  (*0.85)<br>
                            - 30~50%ì´ë©´ *0.95<br>
                            - 50% ì´ìƒì´ë©´ ê°ì  ì—†ìŒ (1.0)<br>
                            4. í† í”½ë³„ ìµœì € ì ìˆ˜ ë°˜ì˜<br>
                            - íŠ¹ì • í† í”½ ì ìˆ˜ê°€ 60 ë¯¸ë§Œì´ë©´ ê°ì  (*0.8)<br>
                            - 60~75ë©´ *0.9<br>
                            - 75 ì´ìƒì´ë©´ ê°ì  ì—†ìŒ<br>
                            5. ìµœì¢… ë¸Œëœë“œ ì ìˆ˜ ê³„ì‚°
                        </span>
                    </span>
                </h3>
                <div class="gauge-container">
                    <!-- ğŸ‘‡ ê¸°ì¡´ gauge svg ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
                    <svg width="120" height="60" viewBox="0 0 140 70" class="gauge-svg">
                        <path d="M 10 60 A 50 50 0 0 1 130 60" class="gauge-background"/>
                        <path d="M 10 60 A 50 50 0 0 1 130 60" class="gauge-fill" id="brand-score-fill" stroke-dasharray="0, 251"/>
                        <text x="70" y="35" text-anchor="middle" class="gauge-rating" id="brand-score-rating">ë¯¸í¡</text>
                        <text x="70" y="50" class="gauge-text" id="brand-score-text">40ì /100ì </text>
                    </svg>
                </div>
            </div>

            <!-- ì¤‘ì•™: íƒ€ì´í‹€ -->
            <div class="analysis-section">
                <strong>ë¸Œëœë“œ ë¶„ì„ í‰ê°€</strong>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ê²€ìƒ‰ì°½ + ë²„íŠ¼ -->
            <div class="search-box-brand">
                <div class="brand-search-container">
                    <input type="text" id="brand-name" placeholder="ë¸Œëœë“œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    <div id="brand-suggestions" class="suggestions"></div>
                </div>
                <button onclick="fetchBrandAnalysis()">ê²€ìƒ‰</button>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ë° í‰ê°€ UI -->
        <div class="graph-container">
            <!-- ì™¼ìª½: í† í”½ë³„ ë§Œì¡±ë„ & í† í”½ë³„ ì–¸ê¸‰ëŸ‰ -->
            <div class="graph-left">
                <div class="graph-box">
                    <h3>í† í”½ë³„ ë§Œì¡±ë„</h3>
                    <div id="brand-score-results"></div>
                </div>
                
                <div class="graph-box">
                    <h3>
                        í† í”½ë³„ ì–¸ê¸‰ëŸ‰
                        <span class="legend">
                            <span class="legend-item">
                                <span class="legend-color" style="background-color: #187BCD;"></span>
                                ê¸ì •
                            </span>
                            <span class="legend-item">
                                <span class="legend-color" style="background-color: #8B5A2B;"></span>
                                ì¤‘ë¦½
                            </span>
                            <span class="legend-item">
                                <span class="legend-color" style="background-color: #FF4D4D;"></span>
                                ë¶€ì •
                            </span>
                        </span>
                    </h3>
                    <div id="brand-frequency-results"></div>
                </div>
            </div>

            <!-- ë¸Œëœë“œë³„ íŒë§¤ëŸ‰ ì¶”ì´ë¥¼ í† í”½ë³„ ì–¸ê¸‰ëŸ‰ ì˜†ì— ë°°ì¹˜ -->
            <div class="graph-right">
                <!-- ë¸Œëœë“œ íŒë§¤ëŸ‰ ì¶”ì´ -->
                <div class="score-box">
                    <div class="brand-sales-chart-container">
                        <h3>ë¦¬ë·°ëŸ‰ ì¶”ì´</h3>
                        <canvas id="brandSalesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>        
    </div>

<!-- ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„  -->
<!-- ğŸ”¹ ì œí’ˆ ì°¾ê¸° ì„¹ì…˜ -->
    <div class="product-search-card">
    <!-- ì™¼ìª½ ê²€ìƒ‰ í•„í„° -->
        <div class="product-search-box">
            <div class='filter-box'>
                <h2 class="search-title">ì œí’ˆ ì°¾ê¸°</h2>

                <button class="filter-button" onclick="toggleFilter('topic')">
                    í† í”½ <span class="filter-selected" id="selected-topic"></span>
                </button>
                <div class="filter-options" id="filter-topic">
                    <label>í† í”½ ì„ íƒ:</label>
                    <select id="topic-select" onchange="updateFilterLabel('topic')">
                        <option value="">ì „ì²´</option>
                        <option value="ë‚´êµ¬ì„± ë° í’ˆì§ˆ">ë‚´êµ¬ì„± ë° í’ˆì§ˆ</option>
                        <option value="ë””ìì¸">ë””ìì¸</option>
                        <option value="ì‚¬ì´ì¦ˆ">ì‚¬ì´ì¦ˆ</option>
                        <option value="ê°€ì„±ë¹„">ê°€ì„±ë¹„</option>
                        <option value="ì°©ìš©ê°">ì°©ìš©ê°</option>
                        <option value="ë°°ì†¡ ë° í¬ì¥ ë° ì‘ëŒ€">ë°°ì†¡ ë° í¬ì¥ ë° ì‘ëŒ€</option>
                    </select>
                </div>
        
                <button class="filter-button" onclick="toggleFilter('category')">
                    ì¹´í…Œê³ ë¦¬ <span class="filter-selected" id="selected-category"></span>
                </button>
                <div class="filter-options" id="filter-category">
                    <label>ì¹´í…Œê³ ë¦¬ ì„ íƒ:</label>
                    <select id="category-select" onchange="updateFilterLabel('category')">
                        <option value="">ì „ì²´</option>
                        <option value="ìº”ë²„ìŠ¤/ë‹¨í™”">ìº”ë²„ìŠ¤/ë‹¨í™”</option>
                        <option value="êµ¬ë‘">êµ¬ë‘</option>
                        <option value="ìƒŒë“¤/ìŠ¬ë¦¬í¼">ìƒŒë“¤/ìŠ¬ë¦¬í¼</option>
                        <option value="í">í</option>
                        <option value="ìŠ¤í¬ì¸ í™”">ìŠ¤í¬ì¸ í™”</option>
                        <option value="ë¶€ì¸ /ì›Œì»¤">ë¶€ì¸ /ì›Œì»¤</option>
                        <option value="ë“±ì‚°í™”">ë“±ì‚°í™”</option>
                        <option value="íŠ¸ë ˆí‚¹í™”">íŠ¸ë ˆí‚¹í™”</option>
                    </select>
                </div>
        
                <button class="filter-button" onclick="toggleFilter('gender')">
                    ì„±ë³„ <span class="filter-selected" id="selected-gender"></span>
                </button>
                <div class="filter-options" id="filter-gender">
                    <label>ì„±ë³„ ì„ íƒ:</label>
                    <select id="gender-select">
                        <option value="ê³µìš©">ê³µìš©</option>
                        <option value="ë‚¨ì">ë‚¨ì</option>
                        <option value="ì—¬ì">ì—¬ì</option>
                    </select>
                </div>
        
                <button class="filter-button" onclick="toggleFilter('price')">
                    ê°€ê²©ëŒ€ <span class="filter-selected" id="selected-price"></span>
                </button>
                <div class="filter-options" id="filter-price">
                    <input type="number" id="price-min">
                    <label> ~ </label>
                    <input type="number" id="price-max">
                </div>

                <button class="filter-button" onclick="toggleFilter('reviews')">
                    ë¦¬ë·°ìˆ˜ <span class="filter-selected" id="selected-reviews"></span>
                </button>
                <div class="filter-options" id="filter-reviews">
                    <label>ìµœì†Œ ë¦¬ë·° ìˆ˜:</label>
                    <input type="number" id="min-reviews" value="50" min="0" onchange="updateFilterLabel('reviews')">
                </div>
        
                <!-- ê²€ìƒ‰ ë²„íŠ¼ì„ í•„í„° ì•„ë˜ì— ë°°ì¹˜ -->
                <div class="filter-search-button">
                    <button class="search-button" onclick="fetchProductList()">ê²€ìƒ‰</button>
                </div>
            </div>   
        
                <!-- ì˜¤ë¥¸ìª½ ì œí’ˆ ëª©ë¡ -->
            <div class="product-list">              
                <h2>ê²€ìƒ‰ ê²°ê³¼</h2>  
                <div id="product-results"></div>
            </div>
        </div>
    </div>
</div>

<!-- ìŠ¤í¬ë¦½íŠ¸ìŠ¤í¬ë¦½íŠ¸ìŠ¤í¬ë¦½íŠ¸ìŠ¤í¬ë¦½íŠ¸ìŠ¤í¬ë¦½íŠ¸ìŠ¤í¬ë¦½íŠ¸/////////////////////////////////////////// -->
    <script>
        let totalSalesChart, categorySalesChart, genderSalesChart; // ì°¨íŠ¸ ë³€ìˆ˜ ì„ ì–¸

function salesModal() {
    const modal = document.getElementById("salesModal");
    
    // í˜„ì¬ ìƒíƒœì— ë”°ë¼ ë³´ì´ê±°ë‚˜ ìˆ¨ê¹€ ì²˜ë¦¬
    if (modal.style.display === "block") {
        modal.style.display = "none"; // ìˆ¨ê¹€ ì²˜ë¦¬
    } else {
        modal.style.display = "block"; // ë³´ì„ ì²˜ë¦¬
    }
}


// ë‚ ì§œ ë¶„ì„ ì°¨íŠ¸ //
async function fetchData(url) {
    try {
        const response = await fetch(url);
        console.log(`ì‘ë‹µ ìƒíƒœ ì½”ë“œ: ${response.status}`);
        console.log(`ìš”ì²­ URL: ${url}`);
        if (!response.ok) throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${url}`);
        const data = await response.json();
        console.log("ì‘ë‹µ ë°ì´í„°:", data);
        return data;
    } catch (error) {
        console.error("ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:", error);
        return null;
    }
}

async function loadCharts() {
    const startDate = document.getElementById("startDate").value;
    const endDate = document.getElementById("endDate").value;

    // âœ… ë‚ ì§œ ê°’ í™•ì¸

    try {
        // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
        if (totalSalesChart) totalSalesChart.destroy();
        if (categorySalesChart) categorySalesChart.destroy();
        if (genderSalesChart) genderSalesChart.destroy();

        // âœ… ë³‘ë ¬ API í˜¸ì¶œë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ìµœì í™”)
        const [totalSales, categorySales, genderSales] = await Promise.all([
            fetchData(`/api/total-sales?startDate=${startDate}&endDate=${endDate}`),
            fetchData(`/api/category-sales?startDate=${startDate}&endDate=${endDate}`),
            fetchData(`/api/gender-sales?startDate=${startDate}&endDate=${endDate}`)
        ]);

        if (totalSales) renderTotalSalesChart(totalSales);
        if (categorySales) renderCategorySalesChart(categorySales);
        if (genderSales) renderGenderSalesChart(genderSales);

    } catch (error) {
        console.error("ğŸš¨ ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
        alert("ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }

    window.onload = function() {
        console.log(window.innerWidth);

        if(window.innerWidth >= 999) {
            Chart.defaults.font.size = 9;
        } else if(window.innerWidth >= 666 && window.innerWidth < 999) {
            Chart.defaults.font.size = 6;
        } else {
            Chart.defaults.font.size = 9;
        }
    }
}

//ì „ì²´ ì œí’ˆ ë¦¬ë·° ê·¸ë˜í”„
function renderTotalSalesChart(data) {
    console.log("ì „ì²´ íŒë§¤ëŸ‰ ì°¨íŠ¸ ë°ì´í„°:", data);
    const monthlyData = data.labels.reduce((acc, dateStr, index) => {
        const date = new Date(dateStr);
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`; // "YYYY-MM" í˜•ì‹ìœ¼ë¡œ ì›”ë³„ í‚¤ ìƒì„±
        acc[monthKey] = (acc[monthKey] || 0) + data.values[index]; 
        return acc;
    }, {});

    const sortedMonths = Object.keys(monthlyData).sort((a, b) => new Date(a) - new Date(b)); // ì›”ì„ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
    const processedData = {
        labels: sortedMonths, // ì›”ë³„ ë¼ë²¨ (YYYY-MM)
        values: sortedMonths.map(month => monthlyData[month]) // ì›”ë³„ íŒë§¤ëŸ‰
    };
    
    const ctx = document.getElementById("totalSalesChart")?.getContext("2d");
    if (!ctx) return;

    // âœ… ë°ì´í„°ì…‹ ë¶„ë¦¬
    const totalSalesDataset = {
        label: "ì „ì²´ íŒë§¤ëŸ‰",
        data: processedData.values,
        borderColor: "rgba(72, 209, 204, 0.7)",
        backgroundColor: "rgba(72, 209, 204, 0.7)",
        borderWidth: 2,
    };


    totalSalesChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: processedData.labels,
            datasets: [totalSalesDataset]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                text: dataset.label,
                                datasetIndex: i,
                                fillStyle: dataset.backgroundColor, // ìƒ‰ìƒ ì œê±°
                                strokeStyle: "transparent", // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìœ ì§€
                                lineWidth: 0,  // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ìœ ì§€
                                hidden: !chart.isDatasetVisible(i),
                                font: {size: 9,weight: 'bold', },
                            }));
                        }
                    },
                position: 'top'},
                tooltip: { mode: 'index', intersect: false },
            },             
            responsive: true,  // âœ… ìë™ í¬ê¸° ì¡°ì • í™œì„±í™”
            maintainAspectRatio: false,  // âœ… ë¹„ìœ¨ ìœ ì§€
            tension: 0.4,
            fill: false,
            pointRadius: 0,         
            scales: {
                x: { 
                    type: "time", 
                    time: { unit: "year" }, 
                    grid: {display: false},
                    ticks: {font: {size: 11,weight: 'bold',}}
                },
                y: { 
                    beginAtZero: true, 
                    ticks: {font: {size: 11,weight: 'bold',}}
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    })
}


//ì¹´í…Œê³ ë¦¬ë³„ ë¦¬ë·° ê·¸ë˜í”„
function renderCategorySalesChart(rawData) {
    const groupedData = groupDataByMonth(rawData);
    console.log("ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™”ëœ ë°ì´í„°:", groupedData);

    const ctx = document.getElementById("categorySalesChart")?.getContext("2d");
    if (!ctx) return;

    const labels = Object.keys(groupedData); // ì›”ë³„ ë ˆì´ë¸” (YYYY-MM)
    console.log("ì°¨íŠ¸ ë¼ë²¨:", labels);

    const categories = new Set();
    labels.forEach(month => {
        Object.keys(groupedData[month]).forEach(category => categories.add(category));
    });
    console.log("ì¹´í…Œê³ ë¦¬ ëª©ë¡:", categories);

    const datasets = [...categories].map(category => ({
        label: category,
        data: labels.map(month => groupedData[month][category] || 0),
        borderColor:  categoryColors[category] || "rgba(150, 150, 150, 0.7)",
        backgroundColor:  categoryColors[category] || "rgba(150, 150, 150, 0.7)",
        borderWidth: 2
    }));

    console.log("ì°¨íŠ¸ ë°ì´í„°ì…‹:", datasets);

    categorySalesChart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
            plugins: {
                legend: {
                    labels: {
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                    text: dataset.label,
                                    datasetIndex: i,
                                    fillStyle: dataset.backgroundColor, // ìƒ‰ìƒ ì œê±°
                                    strokeStyle: "transparent", // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìœ ì§€
                                    lineWidth: 0,  // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ìœ ì§€
                                    hidden: !chart.isDatasetVisible(i),
                                    font: {size: 9,weight: 'bold', },
                            }))
                        }
                    },   
                position: 'top'},
                tooltip: { mode: 'index', intersect: false },
            },
            responsive: true,
            maintainAspectRatio: false,
            tension: 0.4,
            fill: false,
            pointRadius: 0,     
            scales: {
                x: { 
                    type: 'time',
                    time: { unit: 'year' }, 
                    grid: {display: false},
                    ticks: {font: {size: 11,weight: 'bold',} } },
                y: { 
                    beginAtZero: true,
                    ticks: {font: {size: 11,weight: 'bold',} } }
                    },
            interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
            }
        }
    })
};





function renderGenderSalesChart(rawData) {
  // âœ… ë°ì´í„° ì›”ë³„ ì§‘ê³„
  const groupedData = groupDataByMonth(rawData);

  const ctx = document.getElementById("genderSalesChart")?.getContext("2d");
  if (!ctx) return;

  const labels = Object.keys(groupedData); // ì›”ë³„ ë ˆì´ë¸” (YYYY-MM)
  const genders = new Set();
  
  // âœ… ì„±ë³„ ì¶”ì¶œ
  labels.forEach(month => {
    Object.keys(groupedData[month]).forEach(gender => genders.add(gender));
  });

  // âœ… ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ë§¤í•‘ (ê³ ì • ìƒ‰ìƒ ì ìš©)
const genderColors = {
    "ë‚¨ì": "rgba(70, 130, 180, 0.7)",      
    "ê³µìš©": "rgba(255, 140, 0, 0.7)",   
    "ì—¬ì": "rgba(205, 92, 92, 0.7)"
};

  // âœ… ë°ì´í„°ì…‹ ìƒì„±
  const datasets = [...genders].map(gender => ({
    label: gender,
    data: labels.map(month => groupedData[month][gender] || 0), // í•´ë‹¹ ì›”ì˜ ì„±ë³„ íŒë§¤ëŸ‰
    borderColor: genderColors[gender] || "rgba(150, 150, 150, 0.7)",
    backgroundColor: genderColors[gender] || "rgba(150, 150, 150, 0.7)",
    borderWidth:2
  }));

  // âœ… ì°¨íŠ¸ ìƒì„±
    genderSalesChart = new Chart(ctx, {
        type: "line",
        data: { labels, datasets },
        options: {
            plugins: {
                legend: {
                    labels: {
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                    text: dataset.label,
                                    datasetIndex: i,
                                    fillStyle: dataset.backgroundColor, // ìƒ‰ìƒ ì œê±°
                                    strokeStyle: "transparent", // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìœ ì§€
                                    lineWidth: 0,  // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ìœ ì§€
                                    hidden: !chart.isDatasetVisible(i),
                                    font: {size: 9,weight: 'bold', },
                            }))
                        }
                    },
                position: 'top'},
                tooltip: { mode: 'index', intersect: false },
            }, 
            responsive: true,
            maintainAspectRatio: false,  
            tension: 0.4, // ê³¡ì„  ì •ë„
            fill: false, // âœ… ì„  ì•„ë˜ ì˜ì—­ ì±„ìš°ê¸° í™œì„±í™”
            pointRadius: 0, // âœ… ë°ì´í„° í¬ì¸íŠ¸ ì œê±°   
            scales: {
                x: {
                    type: "time",
                    time: { unit: "year" }, // âœ… xì¶•ì„ ì›” ë‹¨ìœ„ë¡œ í‘œì‹œ
                    grid: {display: false}, // ì„¸ë¡œì¶• ì•ˆë³´ì´ê²Œ
                    ticks: {font: {size: 11,weight: 'bold',padding:0} } }, // ë¼ë²¨ í°íŠ¸ ì‚¬ì´ì¦ˆ,ë‘ê»˜,
                y: {
                    beginAtZero: true,
                    ticks: {font: {size: 11,weight: 'bold'} } }
                    },
            interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
            }
        }
    })
};

    // âœ… ë°ì´í„° ê·¸ë£¹í™” í•¨ìˆ˜ (ì›”ë³„ ì§‘ê³„)
    function groupDataByMonth(data) {
    const grouped = {};

    Object.keys(data).forEach(date => {
        const month = date.slice(0, 7); // YYYY-MM í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        if (!grouped[month]) grouped[month] = {};

        Object.entries(data[date]).forEach(([gender, count]) => {
        grouped[month][gender] = (grouped[month][gender] || 0) + count;
        });
    });

  console.log("ê·¸ë£¹í™”ëœ ì›”ë³„ ë°ì´í„°:", grouped); // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
  return grouped;
}
    function updateCommentBox(data) {
        const commentContent = document.getElementById("comment-content");
        console.log("ğŸ“¡ ë¶„ì„ ë°ì´í„°:", data);  // ğŸ” ì„œë²„ ì‘ë‹µ ë°ì´í„° í™•ì¸
    
        if (!data || !data.product) {
            commentContent.innerHTML = "<p>ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
            return;
        }
    
        // **ğŸ”¥ ìµœì¢… HTML ì‚½ì… (ìŠ¤í¬ë¡¤ ì¶”ê°€)**
        commentContent.innerHTML = `
            <div style="max-height: 200px; overflow-y: auto; text-align: left; padding: 10px;font-weight: bold;">
                <p>ğŸ”¹ ì¹´í…Œê³ ë¦¬ ë³„ ì¶”ì´ ë¶„ì„</p>
                <p>ì—¬ë¦„ ì‹œì¦Œ ìƒí’ˆ :ìƒŒë“¤,ìŠ¬ë¦¬í¼ / ê¸°ì¤€ì›”: 6ì›”,2017ë…„ë¶€í„° ê³„ì† ì¦ê°€í•˜ë‹¤ê°€ 2024ë…„ì—ëŠ” ê°ì†Œ</p>
                <p>ê²¨ìš¸ ì‹œì¦Œ ìƒí’ˆ :êµ¬ë‘ / ê¸°ì¤€ì›”: 12ì›”,2019ë…„ë¶€í„° ê³„ì† ì¦ê°€í•˜ë‹¤ê°€ 2024ë…„ì—ëŠ” ê°ì†Œ</p>
            </div>
        `;
    }		
        



<!-- ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„ ì„  -->

// ==================================================================================================
document.getElementById("today_date").innerText = new Date().toISOString().slice(0, 10);

    let socket = null;
    let reconnectAttempts = 0;  
    const maxReconnectAttempts = 10;
    let lastData = null;
    let lastAnomalyData = null;

    // âœ… APIì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì°¨íŠ¸ ê°±ì‹ 
// âœ… APIì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì°¨íŠ¸ ê°±ì‹ 
async function fetchAnomalySummary() {
    // âœ… ì „ì—­ ë³€ìˆ˜ë¡œ anomaly-summary ë°ì´í„° ì €ì¥
    try {
        console.log("ğŸ“¡ ë°ì´í„° ê°±ì‹  ìš”ì²­...");
        // âœ… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸° (ë¡œì»¬ ìƒíƒœ í™œìš©)
        const lastUpdate = localStorage.getItem("last_anomaly_update") || "";

        const response = await fetch('/api/anomaly-summary');
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

        const data = await response.json();
        console.log("ğŸ“Š Anomaly Summary Data:", data);

        if (!data.today || !data.weekly) {
            throw new Error("âŒ ì´ìƒ ê°ì§€ ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŒ");
        }

        // âœ… ìµœì‹  ì—…ë°ì´íŠ¸ ì‹œê°„ ì €ì¥
        localStorage.setItem("last_anomaly_update", new Date().toISOString());

        // âœ… ì¤‘ë³µ ì œê±° (review_id + sentence ê¸°ì¤€)
        data.today.anomaly_reviews = removeDuplicateReviews(data.today.anomaly_reviews);
        data.weekly.anomaly_reviews = removeDuplicateReviews(data.weekly.anomaly_reviews);

        lastAnomalyData = data; // âœ… ì¤‘ë³µ ì œê±°ëœ ë°ì´í„° ì €ì¥

        console.log("âœ… lastAnomalyData ì—…ë°ì´íŠ¸ ì™„ë£Œ!", lastAnomalyData);
        console.log("ğŸ“Š ì˜¤ëŠ˜ ê°ì„± ë¶„ì„ ë°ì´í„°:", data.today.sentiment_analysis);
        console.log("âš ï¸ ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ë¦¬ë·° ê°œìˆ˜:", data.today.anomaly_reviews.length);
        console.log("ğŸ“Œ ì˜¤ëŠ˜ ë¶€ì • ë¦¬ë·° ê°œìˆ˜:", data.today.negative_reviews.length);

        // updateDoughnutChart("todaySentimentChart", ["ë¶€ì •", "ì¤‘ë¦½", "ê¸ì •"], [
        //     data.today.sentiment_analysis?.[0] || 0,
        //     data.today.sentiment_analysis?.[1] || 0,
        //     data.today.sentiment_analysis?.[2] || 0
        // ]);

        // updateDoughnutChart("weeklySentimentChart", ["ë¶€ì •", "ì¤‘ë¦½", "ê¸ì •"], [
        //     data.weekly.sentiment_analysis?.[0] || 0,
        //     data.weekly.sentiment_analysis?.[1] || 0,
        //     data.weekly.sentiment_analysis?.[2] || 0
        // ]);
        // âœ… ê¸°ì¡´ ë„ë„› ì°¨íŠ¸ í˜¸ì¶œ ì œê±° (ëŒ€ì‹  ìŠ¤íƒí˜• ë§‰ëŒ€ ê·¸ë˜í”„ í˜¸ì¶œ)
        updateStackedSentimentChart(
            "stackedSentimentChart",
            [
                data.today.sentiment_analysis?.[0] || 0,  // ì˜¤ëŠ˜ ë¶€ì •
                data.today.sentiment_analysis?.[1] || 0,  // ì˜¤ëŠ˜ ì¤‘ë¦½
                data.today.sentiment_analysis?.[2] || 0   // ì˜¤ëŠ˜ ê¸ì •
            ],
            [
                data.weekly.sentiment_analysis?.[0] || 0, // ì´ë²ˆ ì£¼ ë¶€ì •
                data.weekly.sentiment_analysis?.[1] || 0, // ì´ë²ˆ ì£¼ ì¤‘ë¦½
                data.weekly.sentiment_analysis?.[2] || 0  // ì´ë²ˆ ì£¼ ê¸ì •
            ]
        );

        // âœ… ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ (ì¼ì¼ & ì£¼ê°„)
        const todayCategoryKeys = Object.keys(data.today.category_analysis || {}).sort();
        const weeklyCategoryKeys = Object.keys(data.weekly.category_analysis || {}).sort();

        console.log("ğŸ“Œ ì •ë ¬ëœ ì˜¤ëŠ˜ ì¹´í…Œê³ ë¦¬ í‚¤:", todayCategoryKeys);
        console.log("ğŸ“Œ ì£¼ê°„ ì¹´í…Œê³ ë¦¬ í‚¤:", weeklyCategoryKeys);
        console.log("ğŸ“Œ ì£¼ê°„ ì¹´í…Œê³ ë¦¬ ë°ì´í„°:", data.weekly.category_analysis);
        console.log("ğŸ“Œ ì£¼ê°„ ë¶€ì • ì¹´í…Œê³ ë¦¬ ë°ì´í„°:", data.weekly.negative_category_analysis);
        // ğŸš¨ ë¹ˆ ë°°ì—´ì´ë©´ ë¡œê·¸ ì¶œë ¥
        if (weeklyCategoryKeys.length === 0) {
            console.error("ğŸš¨ ì£¼ê°„ ì¹´í…Œê³ ë¦¬ í‚¤ê°€ ë¹„ì–´ ìˆìŒ. ë°ì´í„° ë¬¸ì œ í™•ì¸ í•„ìš”!");
        }



        const allCategories = Array.from(new Set([
            ...Object.keys(data.today.category_analysis || {}),
            ...Object.keys(data.today.negative_category_analysis || {}),
            ...Object.keys(data.weekly.category_analysis || {}),
            ...Object.keys(data.weekly.negative_category_analysis || {})
        ])).sort();

        const negativeCategoryCounts = allCategories.map(cat => 
            data.today.negative_category_analysis?.[cat] ?? 0 // âœ… ì—†ëŠ” ì¹´í…Œê³ ë¦¬ëŠ” 0ìœ¼ë¡œ ì²˜ë¦¬
        );

        // updateCombinedBarChart(
        //     "todayCombinedCategoryChart",
        //     allCategories,  // âœ… ì „ì²´ ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ (ì •ë ¬ëœ ìƒíƒœ)
        //     allCategories.map(cat => data.today.category_analysis?.[cat] ?? 0), // âœ… ì „ì²´ ë¦¬ë·° ê°œìˆ˜ (ì—†ëŠ” ê°’ì€ 0)
        //     negativeCategoryCounts // âœ… ë¶€ì • ë¦¬ë·° ê°œìˆ˜ (ì—†ëŠ” ê°’ì€ 0)
        // );

        // // âœ… ì´ë²ˆ ì£¼ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸ (ìˆœì„œ ì •ë ¬)
        // updateCombinedBarChart("weeklyCombinedCategoryChart",
        //     weeklyCategoryKeys,
        //     weeklyCategoryKeys.map(cat => data.weekly.category_analysis?.[cat] ?? 0),
        //     weeklyCategoryKeys.map(cat => data.weekly.negative_category_analysis?.[cat] ?? 0)
        // );
        updateReviewTopicChart(
    "reviewTopicChart",
    allCategories,
    allCategories.map(cat => data.today.category_analysis?.[cat] ?? 0), // ì˜¤ëŠ˜ ì „ì²´ ë¦¬ë·° ê°œìˆ˜
    allCategories.map(cat => data.weekly.category_analysis?.[cat] ?? 0), // ì´ë²ˆ ì£¼ ì „ì²´ ë¦¬ë·° ê°œìˆ˜
    allCategories.map(cat => data.today.negative_category_analysis?.[cat] ?? 0), // ì˜¤ëŠ˜ ë¶€ì • ë¦¬ë·° ê°œìˆ˜
    allCategories.map(cat => data.weekly.negative_category_analysis?.[cat] ?? 0) // ì´ë²ˆ ì£¼ ë¶€ì • ë¦¬ë·° ê°œìˆ˜
);





updateRatingDistributionChart(
    "ratingDistributionChart",
    ["â­ 1ì ", "â­ 2ì ", "â­ 3ì ", "â­ 4ì ", "â­ 5ì "],
    [
        {
            label: "ì˜¤ëŠ˜ í‰ì  ë¶„í¬",
            data: [
                data.today.rating_distribution?.[1] || 0,
                data.today.rating_distribution?.[2] || 0,
                data.today.rating_distribution?.[3] || 0,
                data.today.rating_distribution?.[4] || 0,
                data.today.rating_distribution?.[5] || 0
            ],
            backgroundColor: "rgba(54, 162, 235, 0.5)",
            borderColor: "rgba(54, 162, 235, 1)",
            fill: true
        },
        {
            label: "ì´ë²ˆ ì£¼ í‰ì  ë¶„í¬",
            data: [
                data.weekly.rating_distribution?.[1] || 0,
                data.weekly.rating_distribution?.[2] || 0,
                data.weekly.rating_distribution?.[3] || 0,
                data.weekly.rating_distribution?.[4] || 0,
                data.weekly.rating_distribution?.[5] || 0
            ],
            backgroundColor: "rgba(255, 99, 132, 0.5)",
            borderColor: "rgba(255, 99, 132, 1)",
            fill: true
        }
    ]
);


        console.log("ğŸ“Œ ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ëª©ë¡:", data.today.anomaly_reviews);
        console.log("ğŸ“Œ ì´ë²ˆ ì£¼ ì´ìƒ ê°ì§€ ëª©ë¡:", data.weekly.anomaly_reviews);

        // âœ… í˜„ì¬ ì—´ë ¤ ìˆëŠ” ëª¨ë‹¬ íƒ€ì… í™•ì¸ í›„ ê°±ì‹ 
        const currentModalType = document.getElementById("modalAnomalyTitle").getAttribute("data-active");

        if (currentModalType === "today") {
            updateAnomalyReviews("today", lastAnomalyData.today.anomaly_reviews || []);
        } else if (currentModalType === "weekly") {
            updateAnomalyReviews("weekly", lastAnomalyData.weekly.anomaly_reviews || []);
        }

    } catch (error) {
        console.error("ğŸš¨ Error fetching anomaly summary:", error);
    }
}

function updateReviewTopicChart(canvasId, labels, todayData, weeklyData, todayNegative, weeklyNegative) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
            labels,
            datasets: [
                {
                    label: "ì˜¤ëŠ˜ ì „ì²´ ë¦¬ë·°",
                    data: todayData,
                    backgroundColor: "rgba(0, 128, 128, 0.3)",  
                    borderColor: "rgba(0, 128, 128, 0.8)",  
                    fill: true,
                    tension: 0.4
                },
                {
                    label: "ì´ë²ˆ ì£¼ ì „ì²´ ë¦¬ë·°",
                    data: weeklyData,
                    backgroundColor: "rgba(75, 192, 192, 0.2)",  
                    borderColor: "rgba(75, 192, 192, 0.8)",  
                    fill: true,
                    tension: 0.4
                },
                {
                    label: "ì˜¤ëŠ˜ ë¶€ì • ë¦¬ë·°",
                    data: todayNegative,
                    backgroundColor: "rgba(255, 0, 0, 0.3)",  
                    borderColor: "rgba(255, 0, 0, 0.8)",  
                    fill: true,
                    tension: 0.4
                },
                {
                    label: "ì´ë²ˆ ì£¼ ë¶€ì • ë¦¬ë·°",
                    data: weeklyNegative,
                    backgroundColor: "rgba(255, 99, 132, 0.2)",  
                    borderColor: "rgba(255, 99, 132, 0.8)",  
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { font: { size: 12, weight: 'bold' } }
                },
                y: {
                    beginAtZero: true,
                    grid: { borderDash: [3, 3] },
                    ticks: { font: { size: 14, weight: 'bold' } }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        usePointStyle: false,  // âœ… ë²”ë¡€ ì•„ì´ì½˜ì„ ì‚¬ê°í˜•ìœ¼ë¡œ ìœ ì§€
                        generateLabels: function (chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                text: dataset.label,
                                datasetIndex: i,
                                fillStyle: dataset.borderColor,  // âœ… í…Œë‘ë¦¬ ìƒ‰ìƒìœ¼ë¡œ ë‚´ë¶€ ì±„ìš°ê¸°
                                strokeStyle:"transparent",  // âœ… í…Œë‘ë¦¬ ìœ ì§€
                                hidden: !chart.isDatasetVisible(i),
                                lineWidth: 2  
                            }));
                        }
                    }
                },
                tooltip: { mode: 'index', intersect: false },
                datalabels: { display: false }
            },
            interaction: { mode: 'nearest', axis: 'x', intersect: false }
        },
        plugins: [ChartDataLabels]
    });
}



function updateRatingDistributionChart(canvasId, labels, datasets) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'bar',  // âœ… ë§‰ëŒ€ ê·¸ë˜í”„ ì‚¬ìš©
        data: {
            labels: labels,
            datasets: [
                {
                    label: "ì˜¤ëŠ˜ í‰ì  ë¶„í¬",
                    data: datasets[0].data,
                    backgroundColor: "rgba(0, 128, 128, 0.8)",  // âœ… ì§„í•œ ì²­ë¡ìƒ‰
                    borderColor: "rgba(0, 128, 128, 1)",
                    borderWidth: 1
                },
                {
                    label: "ì´ë²ˆ ì£¼ í‰ì  ë¶„í¬",
                    data: datasets[1].data,
                    backgroundColor: "rgba(75, 192, 192, 0.6)",  // âœ… ì—°í•œ ì²­ë¡ìƒ‰
                    borderColor: "rgba(75, 192, 192, 1)",
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    stacked: true,  // âœ… Xì¶• ëˆ„ì  ë§‰ëŒ€ ì„¤ì •
                    ticks: { font: { size: 12, weight: 'bold' } }
                },
                y: {
                    stacked: true,  // âœ… Yì¶• ëˆ„ì  ì„¤ì • (ê° ë§‰ëŒ€ê°€ ëˆ„ì ë¨)
                    beginAtZero: true,
                    grid: { borderDash: [3, 3] },
                    ticks: { font: { size: 14, weight: 'bold' } }
                }
            },
            plugins: {
                legend: { 
                    labels: {
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                text: dataset.label,
                                datasetIndex: i,
                                fillStyle: dataset.backgroundColor, // ìƒ‰ìƒ ì œê±°
                                strokeStyle: "transparent", // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìœ ì§€
                                lineWidth: 0,  // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ìœ ì§€
                                hidden: !chart.isDatasetVisible(i),
                                font: {size: 9,weight: 'bold', },
                            }));
                        },
                    },
                display: true, 
                position: 'top' 
                },
                tooltip: { mode: 'index', intersect: false },
                datalabels: { display: false }  // âœ… ìˆ«ì í‘œì‹œ ì œê±°
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
}


    function updateNegativeReviews(reviews) {
        const reviewList = document.getElementById("negative-reviews");
        reviewList.innerHTML = "";

        reviews.forEach(review => {
            const listItem = document.createElement("li");
            listItem.innerHTML = `<span><strong>${review.category}</strong>: ${review.sentence}</span>`;
            reviewList.appendChild(listItem);
        });
    }
// âœ… ì¤‘ë³µ ë¦¬ë·° ì œê±° í•¨ìˆ˜ (review_id + sentence ê¸°ì¤€)
function removeDuplicateReviews(reviews) {
    const seen = new Set();
    return reviews.filter(review => {
        const key = `${review.review_id}-${review.sentence.trim()}`; // âœ… ì¤‘ë³µ ê¸°ì¤€: review_id + sentence
        if (seen.has(key)) {
            return false;
        }
        seen.add(key);
        return true;
    });
}

    // âœ… ì „ì—­ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì €ì¥ ë³€ìˆ˜
let chartInstances = {};

// âœ… ê¸°ì¡´ ì°¨íŠ¸ë¥¼ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
function destroyAllCharts() {
    for (const canvasId in chartInstances) {
        if (chartInstances[canvasId]) {
            console.log(`ğŸ—‘ï¸ ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œë¨: ${canvasId}`);
            chartInstances[canvasId].destroy();  // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì™„ì „ ì‚­ì œ
            delete chartInstances[canvasId];  // âœ… ë©”ëª¨ë¦¬ í•´ì œ
        }
    }
}

// âœ… ì—°ë„ ë° ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
// âœ… ì—°ë„ ë° ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
function populateDateSelectors() {
    const yearSelect = document.getElementById("yearSelect");
    const monthSelect = document.getElementById("monthSelect");

    const currentYear = new Date().getFullYear();
    for (let year = currentYear; year >= 2023; year--) {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = `${year}ë…„`;
        yearSelect.appendChild(option);
    }

    for (let month = 1; month <= 12; month++) {
        const option = document.createElement("option");
        option.value = month;
        option.textContent = `${month}ì›”`;
        monthSelect.appendChild(option);
    }

    yearSelect.value = currentYear;
    monthSelect.value = new Date().getMonth() + 1;
}

async function fetchAnomalyProducts(year, month) { 
    try {
        console.log(`ğŸ“¡ ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ì œí’ˆ ëª©ë¡ ìš”ì²­...`);
        const response = await fetch(`/api/anomaly-products/${year}/${month}`);
        const data = await response.json();

        if (!data || data.error || data.length === 0) {
            console.warn(`âš ï¸ ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ì œí’ˆ ì—†ìŒ`);
            updateAnomalyProductChart(["ë°ì´í„° ì—†ìŒ"], [0], []);
            return;
        }

        console.log(`ğŸ“Š ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ì œí’ˆ ëª©ë¡:`, data);

        // âœ… ì œí’ˆ ì´ë¦„, ê°ì§€ íšŸìˆ˜, ì œí’ˆ ID ë°°ì—´ ìƒì„±
        const productNames = data.map(product => product.product_name);
        const anomalyCounts = data.map(product => product.anomaly_count);
        const productIds = data.map(product => product.product_id);

        updateAnomalyProductChart(productNames, anomalyCounts, productIds);

    } catch (error) {
        console.error(`ğŸš¨ ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ì œí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
    }
}

function updateAnomalyProductChart(productNames, anomalyCounts, productIds) {
    const canvasId = "anomalyProductChart";
    const canvas = document.getElementById(canvasId);

    if (!canvas) {
        console.warn(`âš ï¸ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${canvasId}`);
        return;
    }

    const ctx = canvas.getContext("2d");

    // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ (ì¤‘ë³µ ìƒì„± ë°©ì§€)
    if (window.chartInstances && window.chartInstances[canvasId]) {
        window.chartInstances[canvasId].destroy();
    }

    // âœ… ì œí’ˆëª…ì„ 8ê¸€ìë¡œ ì¤„ì´ëŠ” í•¨ìˆ˜ (Yì¶• ì „ìš©)
    function shortenLabel(name, maxLength = 8) {
        return name.length > maxLength ? name.substring(0, maxLength) + "..." : name;
    }

    // âœ… ëª¨ë“  ë§‰ëŒ€ë¥¼ ì—°í•œ íšŒìƒ‰ ê³„ì—´ë¡œ ì„¤ì •
    const barColors = Array(productNames.length).fill("rgba(192, 192, 192, 0.7)"); // ì—°í•œ íšŒìƒ‰
    const borderColors = Array(productNames.length).fill("rgba(128, 128, 128, 1)"); // ì¤‘ê°„ íšŒìƒ‰ í…Œë‘ë¦¬

    window.chartInstances[canvasId] = new Chart(ctx, {
        type: "bar",
        data: {
            labels: productNames.map(name => shortenLabel(name)), // âœ… ì œí’ˆëª… 8ê¸€ì ì œí•œ
            datasets: [{
                label: "ì´ìƒ ê°ì§€ íšŸìˆ˜",
                data: anomalyCounts,
                backgroundColor: barColors,
                borderColor: borderColors,
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',  
            responsive: true,
            maintainAspectRatio: false,
            onClick: (event, elements) => {
                console.log("ğŸ“Œ í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ!", event, elements);

                // âœ… í´ë¦­í•œ ìš”ì†Œê°€ ìˆëŠ”ì§€ í™•ì¸
                if (!elements || elements.length === 0 || !elements[0]) {
                    console.warn("âš ï¸ í´ë¦­í•œ ìš”ì†Œê°€ ê°ì§€ë˜ì§€ ì•ŠìŒ!");
                    return;
                }

                const index = elements[0].index;

                // âœ… ìœ íš¨í•œ indexì¸ì§€ í™•ì¸
                if (index === undefined || index < 0 || index >= productIds.length) {
                    console.warn(`âš ï¸ ìœ íš¨í•˜ì§€ ì•Šì€ index (${index})`);
                    return;
                }

                const selectedProductId = productIds[index];

                // âœ… ìœ íš¨í•œ ì œí’ˆ IDì¸ì§€ í™•ì¸
                if (!selectedProductId) {
                    console.warn(`âš ï¸ ì„ íƒí•œ ì œí’ˆ IDê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ (index: ${index})`);
                    return;
                }

                console.log(`ğŸ” ì„ íƒí•œ ì œí’ˆ ID: ${selectedProductId}`);
                window.location.href = `/strength-weakness.html?product_id=${selectedProductId}`;
            },
            scales: {
                x: { 
                    grid: { display: true },
                    ticks: { font: { size: 12, weight: "bold" } }
                },
                y: { 
                    grid: { display: false },
                    ticks: {
                        font: { size: 12, weight: "bold" },
                        autoSkip: false
                    }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: "nearest",
                    intersect: false
                }
            },
            barThickness: 20,  
            categoryPercentage: 0.8  
        }
    });
}



async function fetchAnomalyShoesCategory(year, month) {
    try {
        console.log(`ğŸ“¡ ${year}ë…„ ${month}ì›” ì‹ ë°œ ì¹´í…Œê³ ë¦¬ë³„ ì´ìƒ ê°ì§€ ë°ì´í„° ìš”ì²­...`);
        const response = await fetch(`/api/anomaly-shoes-category/${year}/${month}`);
        const jsonResponse = await response.json();

        console.log(`ğŸ“Š API ì‘ë‹µ:`, jsonResponse);

        const data = jsonResponse.data || [];

        if (!data.length) {
            console.warn(`âš ï¸ ${year}ë…„ ${month}ì›” ì‹ ë°œ ì¹´í…Œê³ ë¦¬ ë°ì´í„° ì—†ìŒ`);
            updateShoesAnomalyChart(["ë°ì´í„° ì—†ìŒ"], [0]); 
            return;
        }

        console.log(`ğŸ“Š ${year}ë…„ ${month}ì›” ì‹ ë°œ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„°:`, data);

        const categories = data.map(item => item.category);
        const anomalyCounts = data.map(item => item.anomaly_count);
        updateShoesAnomalyChart(categories, anomalyCounts);

    } catch (error) {
        console.error(`ğŸš¨ ${year}ë…„ ${month}ì›” ì‹ ë°œ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
    }
}

// âœ… ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ë§¤í•‘ (ê³ ì • ìƒ‰ìƒ ì ìš©)
const categoryColors = {
    "êµ¬ë‘": "rgba(255, 99, 132, 0.7)",       // ë¹¨ê°•
    "ë¶€ì¸ /ì›Œì»¤": "rgba(255, 165, 0, 0.7)",   // ì˜¤ë Œì§€
    "ìƒŒë“¤/ìŠ¬ë¦¬í¼": "rgba(75, 192, 92, 0.7)", // ì´ˆë¡
    "ìº”ë²„ìŠ¤/ë‹¨í™”": "rgba(54, 162, 235, 0.7)", // íŒŒë‘
    "ìŠ¤í¬ì¸ í™”": "rgba(153, 102, 255, 0.7)", // ë³´ë¼
    "ë“œë ˆìŠ¤í™”": "rgba(255, 206, 86, 0.7)",  // ë…¸ë‘
    "ë“±ì‚°í™”": "rgba(0, 139, 139, 0.7)",      // ë‹¤í¬ ì²­ë¡
    "íŠ¸ë˜í‚¹í™”": "rgba(128, 128, 128, 0.7)", // íšŒìƒ‰
    "í": "rgba(139, 69, 19, 0.7)"          // ê°ˆìƒ‰ (ë³€ê²½ë¨)
};

// âœ… ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ì—ì„œë„ ë™ì¼í•œ categoryColors ì ìš©
function updateShoesAnomalyChart(categories, anomalyCounts) {
    const canvasId = "shoesAnomalyChart";
    const canvas = document.getElementById(canvasId);
    
    if (!canvas) {
        console.warn(`âš ï¸ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${canvasId}`);
        return;
    }

    const ctx = canvas.getContext("2d");

    if (!window.chartInstances) {
        window.chartInstances = {};
    }

    // âœ… ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒì„ ê³ ì •ëœ ìƒ‰ìƒ ë§¤í•‘ì—ì„œ ê°€ì ¸ì˜´
    const colors = categories.map(category => categoryColors[category] || "rgba(150, 150, 150, 0.7)");

    if (!window.chartInstances[canvasId]) {
        // âœ… ìµœì´ˆ ì‹¤í–‰ ì‹œ ìƒˆ ì°¨íŠ¸ ìƒì„±
        window.chartInstances[canvasId] = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: categories,
                datasets: [{
                    label: "ì‹ ë°œ ì¹´í…Œê³ ë¦¬ë³„ ì´ìƒ ê°ì§€ íšŸìˆ˜",
                    data: anomalyCounts,
                    backgroundColor: colors,  // âœ… ê³ ì •ëœ ìƒ‰ìƒ ì ìš©
                    borderColor: colors,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
					legend: {
                        labels: {
                            generateLabels: function(chart) {
                                return chart.data.labels.map((label, i) => ({
                                    text: label,  // âœ… ë²”ë¡€ í…ìŠ¤íŠ¸ ìˆ˜ì •ë¨
                                    datasetIndex: 0,  // âœ… datasetì€ 1ê°œ
                                    fillStyle: chart.data.datasets[0].backgroundColor[i],
                                    strokeStyle: "transparent",
                                    lineWidth: 0,
                                    hidden: !chart.isDatasetVisible(0),
                                    font: { size: 9, weight: 'bold' }
                                }))        
                            }
                        },
                        display: true, 
                        position: "right" 
                    },
                    tooltip: { mode: "index", intersect: false }
                }
            }
        });
    } else {
        // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        window.chartInstances[canvasId].data.labels = categories;
        window.chartInstances[canvasId].data.datasets[0].data = anomalyCounts;
        window.chartInstances[canvasId].data.datasets[0].backgroundColor = colors;
        window.chartInstances[canvasId].update();
    }
}




// âœ… ì¡°íšŒ ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
async function updateAnomalyTrend() {
    const selectedYear = document.getElementById("yearSelect").value;
    const selectedMonth = document.getElementById("monthSelect").value;

    console.log(`ğŸ“¡ ${selectedYear}ë…„ ${selectedMonth}ì›” ë°ì´í„° ë³‘ë ¬ ìš”ì²­ ì‹œì‘...`);

    await Promise.all([
        fetchAnomalyTrend(selectedYear, selectedMonth),
        fetchAnomalyProducts(selectedYear, selectedMonth),
        fetchAnomalyShoesCategory(selectedYear, selectedMonth)
    ]);

    console.log(`âœ… ${selectedYear}ë…„ ${selectedMonth}ì›” ë°ì´í„° ë³‘ë ¬ ìš”ì²­ ì™„ë£Œ!`);
}



function updateLineChart(canvasId, labels, values) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.warn(`âš ï¸ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${canvasId}`);
        return;
    }

    const ctx = canvas.getContext('2d');
    
    // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ (ì¤‘ë³µ ìƒì„± ë°©ì§€)
    if (window.chartInstances && window.chartInstances[canvasId]) {
        window.chartInstances[canvasId].destroy();
    }

    window.chartInstances = window.chartInstances || {}; // âœ… ì „ì—­ ì°¨íŠ¸ ì €ì¥ ê°ì²´ ìƒì„±

    window.chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ì´ìƒ ê°ì§€ ë¦¬ë·° ìˆ˜',
                data: values,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { grid: { display: false }, ticks: { font: { size: 12, weight: 'bold' } } },
                y: { beginAtZero: true, ticks: { font: { size: 14, weight: 'bold' } } }
            },
            plugins: {
                legend: { display: true, position: 'top' },
                tooltip: { mode: 'index', intersect: false },
                datalabels: { display: false }
            },
            interaction: { mode: 'nearest', axis: 'x', intersect: false }
        }
    });
}

async function fetchAnomalyTrend(year, month) {
    try {
        console.log(`ğŸ“¡ ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ë°ì´í„° ìš”ì²­...`);
        const response = await fetch(`/api/anomaly-trend/${year}/${month}`);
        const data = await response.json();

        if (!data || data.error || data.length === 0) {
            console.warn(`âš ï¸ ${year}ë…„ ${month}ì›” ë°ì´í„° ì—†ìŒ`);
            document.getElementById("anomalyTrendChart").innerHTML = "<p>âš ï¸ ë°ì´í„° ì—†ìŒ</p>"; // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
            return;
        }

        console.log(`ğŸ“Š ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ë¦¬ë·° ë°ì´í„°:`, data);

        const labels = data.map(item => item.date);
        const negativeCounts = data.map(item => item.negative_count);
        const lowRatingCounts = data.map(item => item.low_rating_count);

        updateAnomalyTrendChart("anomalyTrendChart", labels, negativeCounts, lowRatingCounts);
    } catch (error) {
        console.error(`ğŸš¨ ${year}ë…„ ${month}ì›” ì´ìƒ ê°ì§€ ë¦¬ë·° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
    }
}

function updateAnomalyTrendChart(canvasId, labels, negativeCounts, lowRatingCounts) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.warn(`âš ï¸ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${canvasId}`);
        return;
    }

    const ctx = canvas.getContext('2d');

    // âœ… ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ (ì¤‘ë³µ ìƒì„± ë°©ì§€)
    if (window.chartInstances && window.chartInstances[canvasId]) {
        window.chartInstances[canvasId].destroy();
    }

    window.chartInstances = window.chartInstances || {};

    window.chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: "ë¶€ì • ê°ì„± ë¦¬ë·°",
                    data: negativeCounts,
                    borderColor: 'rgba(255, 140, 0, 1)',  // âœ… ì§„í•œ ì£¼í™©ìƒ‰ í…Œë‘ë¦¬
                    backgroundColor: 'rgba(255, 140, 0, 0.3)',  // âœ… ì—°í•œ ì£¼í™©ìƒ‰ ì˜ì—­
                    fill: true,
                    tension: 0.4
                },
                {
                    label: "í‰ì  1~3 ë¦¬ë·°",
                    data: lowRatingCounts,
                    borderColor: 'rgba(147, 112, 219, 1)',  // âœ… ì§„í•œ ë³´ë¼ìƒ‰ í…Œë‘ë¦¬
                    backgroundColor: 'rgba(147, 112, 219, 0.3)',  // âœ… ì—°í•œ ë³´ë¼ìƒ‰ ì˜ì—­
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { grid: { display: false }, ticks: { font: { size: 12, weight: 'bold' } } },
                y: { beginAtZero: true, ticks: { font: { size: 14, weight: 'bold' } } }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                text: dataset.label,
                                datasetIndex: i,
                                fillStyle: dataset.borderColor,  // âœ… ë²”ë¡€ ë‚´ë¶€ ìƒ‰ìƒì„ í…Œë‘ë¦¬ ìƒ‰ìƒê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
                                strokeStyle: dataset.borderColor,  // âœ… í…Œë‘ë¦¬ë„ ë™ì¼í•œ ìƒ‰ìƒ ì ìš©
                                lineWidth: 2,  // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ìœ ì§€
                                hidden: !chart.isDatasetVisible(i)
                            }));
                        }
                    }
                },
                tooltip: { mode: 'index', intersect: false },
                datalabels: { display: false }
            },
            interaction: { mode: 'nearest', axis: 'x', intersect: false }
        }
    });
}

function makeModalResizable(wrapperId, handleId) {
  const wrapper = document.getElementById(wrapperId);
  const handle = document.getElementById(handleId);

  let isResizing = false;

  handle.addEventListener("mousedown", function (e) {
    isResizing = true;

    const startX = e.clientX;
    const startY = e.clientY;
    const startWidth = parseInt(window.getComputedStyle(wrapper).width, 10);
    const startHeight = parseInt(window.getComputedStyle(wrapper).height, 10);

    function doDrag(e) {
      if (!isResizing) return;
      wrapper.style.width = (startWidth + e.clientX - startX) + "px";
      wrapper.style.height = (startHeight + e.clientY - startY) + "px";
    }

    function stopDrag() {
      isResizing = false;
      document.removeEventListener("mousemove", doDrag);
      document.removeEventListener("mouseup", stopDrag);
    }

    document.addEventListener("mousemove", doDrag);
    document.addEventListener("mouseup", stopDrag);
  });
}



// âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ (ì¤‘ë³µ ì œê±°)
document.addEventListener("DOMContentLoaded", () => {
    if (!window.isDOMContentLoaded) {
        window.isDOMContentLoaded = true;  // âœ… ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€

        console.log("ğŸ“¡ DOM ë¡œë“œ ì™„ë£Œ, í•„ìˆ˜ ìš”ì†Œ í™•ì¸ ì¤‘...");
        const guidelineBtn = document.getElementById("monthlyGuidelineBtn");
        // const guidelineCard = document.querySelector(".guideline-card");
        if (guidelineBtn) {
            // guidelineCard.style.width = "460px"; // ì›í•˜ëŠ” í¬ê¸°
            guidelineBtn.addEventListener("click", async () => {
                const year = document.getElementById("yearSelect").value;
                const month = document.getElementById("monthSelect").value;

                const modal = document.getElementById("monthlyGuidelineModal");
                const content = document.getElementById("monthlyGuidelineContent");

                if (!modal || !content) {
                    console.error("ğŸš¨ ì›”ê°„ ê°€ì´ë“œë¼ì¸ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                modal.style.display = "block";
                content.innerHTML = `<p>ğŸ”„ ${year}ë…„ ${month}ì›” ê°€ì´ë“œë¼ì¸ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>`;

                try {
                    const res = await fetch(`/api/anomaly-guideline-monthly/${year}/${month}`);
                    if (!res.ok) throw new Error("API ì‘ë‹µ ì‹¤íŒ¨");

                    const json = await res.json();
                    const guidelineText = json.guideline || "âš ï¸ ë¶„ì„ ê²°ê³¼ ì—†ìŒ";

                    // âœ… ì œí’ˆëª… ë˜ëŠ” ì œëª© ì¶”ì¶œ
                    const titleMatch = guidelineText.match(/ğŸ“\s*\[\s*([\s\S]*?)\s*\]/);
                    const title = titleMatch ? titleMatch[1].trim() : `${year}ë…„ ${month}ì›” ì›”ê°„ ì´ìƒ ê°ì§€ ë¦¬í¬íŠ¸`;

                    // âœ… ğŸ“ ì œê±° ë° í…ìŠ¤íŠ¸ í´ë¦°ì—…
                    let body = guidelineText.replace(/ğŸ“\s*\[\s*([\s\S]*?)\s*\]/, "").trim();
                    body = body
                        .replace(/\*{0,2}ì œí’ˆ\s*ê°œì„ \s*ê°€ì´ë“œë¼ì¸\*{0,2}/gi, "")
                        .replace(/\*{1,3}(.+?)\*{1,3}/g, "$1")
                        .trim();

                    const lines = body.split("\n").filter(line => {
                        const cleanLine = line.replace(/\s/g, "");
                        const cleanTitle = title.replace(/\s/g, "");
                        return !cleanLine.includes(cleanTitle);
                    });
                    body = lines.join("\n").trim();

                    // âœ… ì„¹ì…˜ë³„ë¡œ ë‚˜ëˆ„ê¸°
                    const sectionBlocks = body.split(/\n(?=\d\.\s)/g);
                    const formattedSections = sectionBlocks.map(section => {
                        const lines = section.trim().split("\n");
                        const sectionTitle = lines[0].trim();
                        const sectionContent = lines.slice(1).join("<br>");
                        return `
                            <div class="guideline-section">
                                <div class="section-title">${sectionTitle}</div>
                                <div class="section-content">${sectionContent}</div>
                            </div>
                        `;
                    }).join("");

                    // âœ… ìµœì¢… ë Œë”ë§ (ê¸°ì¡´ guideline ë””ìì¸ê³¼ ë™ì¼í•˜ê²Œ êµ¬ì„±)
                    content.innerHTML = `
                        <div class="guideline-card">
                            <div class="guideline-header">
                                <h2>${title}</h2>
                            </div>
                            ${formattedSections}
                        </div>
                    `;
                    // âœ… ëª¨ë‹¬ ë“œë˜ê·¸ ê¸°ëŠ¥ í™œì„±í™” (ë Œë”ë§ í›„ í˜¸ì¶œ)
                    makeModalResizable("monthlyGuidelineContentWrapper", "resizeHandle");
                } catch (error) {
                    console.error("ğŸš¨ ì›”ê°„ ê°€ì´ë“œë¼ì¸ í˜¸ì¶œ ì˜¤ë¥˜:", error);
                    content.innerHTML = `<p>âš ï¸ ì›”ê°„ ê°€ì´ë“œë¼ì¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;
                }
            });
}
        // âœ… ìš”ì†Œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        const yearSelect = document.getElementById("yearSelect");
        const monthSelect = document.getElementById("monthSelect");

        if (!yearSelect || !monthSelect) {
            console.error("ğŸš¨ ì—°ë„ ë˜ëŠ” ì›” ì„ íƒ ë“œë¡­ë‹¤ìš´ ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
            return;
        }

        // âœ… ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” (ê¸°ì¡´ ì˜µì…˜ì´ ìˆì„ ê²½ìš° ì œê±°)
        if (!window.isDateSelectorsInitialized) {
            populateDateSelectors();
            window.isDateSelectorsInitialized = true;
        }

        // âœ… í˜„ì¬ ì—°ë„ì™€ ì›”ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;

        console.log(`ğŸ“¡ ${year}ë…„ ${month}ì›” ë°ì´í„° ë³‘ë ¬ ìš”ì²­ ì‹œì‘...`);
        
        Promise.all([
            fetchAnomalyTrend(year, month),
            fetchAnomalyProducts(year, month),
            fetchAnomalyShoesCategory(year, month)
        ]).then(() => {
            console.log(`âœ… ${year}ë…„ ${month}ì›” ë°ì´í„° ë³‘ë ¬ ìš”ì²­ ì™„ë£Œ!`);
        }).catch(error => {
            console.error(`ğŸš¨ API ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error}`);
        });
    }
});
// âœ… ì°¨íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ì „ì— ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
// âœ… ì›í˜• ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
function updateDoughnutChart(canvasId, labels, data) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels,
            datasets: [{
                data,
                backgroundColor: ['#ff4d4d', '#ffc107', '#17a2b8'],
                borderWidth: 2, // âœ… ì¡°ê° í…Œë‘ë¦¬ ë‘ê»ê²Œ
                borderColor: '#fff' // âœ… ì¡°ê° ê²½ê³„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // âœ… ë¹„ìœ¨ ê³ ì • í•´ì œ
            cutout: '40%', // âœ… ë„ë„› ë‚´ë¶€ êµ¬ë© í¬ê¸° ì¡°ì •
            plugins: {
                legend: { display: true, position: 'top' },
                datalabels: {
                    color: '#fff', // âœ… ê¸°ë³¸ í°ìƒ‰ í…ìŠ¤íŠ¸
                    textStrokeColor: '#000', // âœ… ê²€ì€ìƒ‰ í…Œë‘ë¦¬ ì¶”ê°€
                    textStrokeWidth: 2, // âœ… í…Œë‘ë¦¬ ë‘ê»˜ ì¦ê°€
                    font: { weight: 'bold', size: 14 },
                    formatter: (value, context) => {
                        const dataset = context.dataset.data;
                        const total = dataset.reduce((acc, num) => acc + num, 0);
                        if (total === 0) return "";
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${percentage}%`;
                    }
                }
            }
        },
        plugins: [ChartDataLabels]
    });
}
function updateStackedSentimentChart(canvasId, todayData, weeklyData) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["ë¶€ì •", "ì¤‘ë¦½", "ê¸ì •"], // Xì¶• ë¼ë²¨
            datasets: [
                {
                    label: "ì˜¤ëŠ˜",
                    data: todayData,
                    backgroundColor: ["#FF4D4D", "#8B5A2B", "#187BCD"], // ë¹¨ê°•, ê°ˆìƒ‰, íŒŒë‘
                    borderColor: ["#FF4D4D", "#8B5A2B", "#187BCD"],
                    borderWidth: 1
                },
                {
                    label: "ì´ë²ˆ ì£¼",
                    data: weeklyData,
                    backgroundColor: ["rgba(255, 77, 77, 0.4)", "rgba(139, 90, 43, 0.4)", "rgba(24, 123, 205, 0.4)"], 
                    borderColor: ["rgba(255, 77, 77, 0.7)", "rgba(139, 90, 43, 0.7)", "rgba(24, 123, 205, 0.7)"],
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { 
                    stacked: true, 
                    ticks: { font: { size: 14, weight: 'bold' } }
                },
                y: { 
                    stacked: true, 
                    beginAtZero: true,
                    ticks: { font: { size: 14, weight: 'bold' } }
                }
            },
            plugins: {
                legend: { 
                    display: true, 
                    position: 'top',
                    labels: {
                        usePointStyle: true, // â— ì•„ì´ì½˜ ì‚¬ìš©
                        generateLabels: function(chart) {
                            return chart.data.datasets.map((dataset, i) => ({
                                text: i === 0 ? "ì˜¤ëŠ˜" : "ì´ë²ˆ ì£¼",
                                datasetIndex: i,
                                fillStyle: "transparent", // ìƒ‰ìƒ ì œê±°
                                strokeStyle: "black", // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìœ ì§€
                                hidden: chart.isDatasetVisible(i) ? false : true,
                                lineWidth: 0
                            }));
                        }
                    },
                    onClick: function(e, legendItem, legend) {
                        const index = legendItem.datasetIndex;
                        const meta = legend.chart.getDatasetMeta(index);
                        meta.hidden = meta.hidden === null ? !legend.chart.data.datasets[index].hidden : null;
                        legend.chart.update();
                    }
                },
                datalabels: { display: false } // ìˆ«ì ì œê±°
            }
        },
        plugins: [ChartDataLabels]
    });
}

function closeMonthlyGuidelineModal() {
  const modal = document.getElementById("monthlyGuidelineModal");
  if (modal) {
    modal.style.display = "none";
  }
}

// âœ… ì œí’ˆ ë¦¬ìŠ¤íŠ¸ë§Œ í‘œì‹œ & ë¦¬ë·° ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì¶”ê°€
document.addEventListener("DOMContentLoaded", async () => {
    console.log("ğŸ“¡ fetchAnomalySummary() ì‹¤í–‰ë¨!");
    await fetchAnomalySummary();

    document.getElementById("today-btn").addEventListener("click", () => {
        console.log("âœ… ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ëª©ë¡ ë²„íŠ¼ í´ë¦­ë¨!");
        updateAnomalyReviews("today", lastAnomalyData?.today?.anomaly_reviews || []);
        showModal("anomalyModal");
    });

    document.getElementById("weekly-btn").addEventListener("click", () => {
        console.log("âœ… ì´ë²ˆ ì£¼ ì´ìƒ ê°ì§€ ëª©ë¡ ë²„íŠ¼ í´ë¦­ë¨!");
        updateAnomalyReviews("weekly", lastAnomalyData?.weekly?.anomaly_reviews || []);
        showModal("anomalyModal");
    });
});

function showModal(modalId) {
    // âœ… ê¸°ì¡´ ëª¨ë‹¬ ìˆ¨ê¸°ê¸° (ì™„ì „íˆ ë‹«ì§€ ì•ŠìŒ)
    document.getElementById("anomalyModal").style.visibility = "hidden";

    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error(`ğŸš¨ ëª¨ë‹¬ ID "${modalId}"ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        return;
    }

    console.log(`âœ… ${modalId} ëª¨ë‹¬ ì—´ê¸°`);
    modal.style.display = "block";
    modal.style.visibility = "visible";
    modal.style.opacity = "1";
    modal.style.zIndex = "9999";
}

function updateAnomalyReviews(type, reviews) {
    const modalTitle = document.getElementById("modalAnomalyTitle");
    const modalList = document.getElementById("modalAnomalyList");

    if (modalTitle.getAttribute("data-active") === type) {
        console.log(`âš ï¸ ${type} ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ ìˆì–´ ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€`);
        return;
    }

    modalTitle.setAttribute("data-active", type);
    modalTitle.innerText = type === "today" ? "ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ëª©ë¡" : "ì´ë²ˆ ì£¼ ì´ìƒ ê°ì§€ ëª©ë¡";
    modalList.innerHTML = "";

    console.log(`ğŸ“¢ ${type} ì´ìƒ ê°ì§€ ë¦¬ë·° ê°œìˆ˜:`, reviews.length);

    if (!reviews || reviews.length === 0) {
        modalList.innerHTML = "<p>ì´ìƒ ê°ì§€ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    } else {
        // âœ… ì¤‘ë³µ ì œê±° (review_id + sentence ê¸°ì¤€)
        const uniqueReviews = removeDuplicateReviews(reviews);

        const groupedReviews = uniqueReviews.reduce((acc, review) => {
            if (!acc[review.product_id]) {
                acc[review.product_id] = {
                    product_id: review.product_id,
                    product_name: review.product_name || "ìƒí’ˆëª… ì—†ìŒ",
                    brand: review.brand || "ë¸Œëœë“œ ì—†ìŒ",
                    price: review.price || "ê°€ê²© ì •ë³´ ì—†ìŒ",
                    image_url: review.image_url || "",
                    reviews: [],
                };
            }
            acc[review.product_id].reviews.push(review);
            return acc;
        }, {});

        Object.values(groupedReviews).forEach(product => {
    const reviewCount = product.reviews.length;

    const reviewCard = document.createElement("div");
    reviewCard.classList.add("review-card");

    reviewCard.innerHTML = `
        <img src="${product.image_url}" class="review-image">
        <div class="review-content">
            <div class="review-title product-link" data-product-id="${product.product_id}">
                ${product.product_name} (${product.brand})
            </div>
            <span class="review-meta">ê°€ê²©: ${product.price || "ê°€ê²© ì •ë³´ ì—†ìŒ"}</span>
            <span class="review-meta">ë¦¬ë·° ê°œìˆ˜: ${reviewCount}ê°œ</span>
            <div class="button-group">
                <button class="review-btn" data-product-id="${product.product_id}">ë¦¬ë·° ë³´ê¸°</button>
                <button class="review-btn guideline-btn" data-product-id="${product.product_id}">ì œí’ˆ ì´ìƒ ê°ì§€ ë¦¬í¬íŠ¸</button>
</div>
            </div>
    `;

    modalList.appendChild(reviewCard);
});

        // âœ… ì œí’ˆ ì´ë¦„ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ ì´ë™
        document.querySelectorAll(".product-link").forEach(link => {
            link.addEventListener("click", (event) => {
                const productId = event.target.getAttribute("data-product-id");
                if (productId) {
                    redirectToStrengthWeakness(productId);
                }
            });
        });

        // âœ… ë¦¬ë·° ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        document.querySelectorAll(".review-btn").forEach(btn => {
            btn.addEventListener("click", (event) => {
                const productId = event.target.getAttribute("data-product-id");
                console.log(`âœ… ë¦¬ë·° ìƒì„¸ë³´ê¸° ë²„íŠ¼ í´ë¦­ë¨: Product ID = ${productId}`);

                if (!productId) {
                    console.error("ğŸš¨ ì˜¤ë¥˜: í´ë¦­í•œ ë²„íŠ¼ì—ì„œ productIdë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                    return;
                }

                showReviewModal(productId);
            
            });
        });
        document.querySelectorAll(".guideline-btn").forEach(btn => {
            btn.addEventListener("click", async (event) => {
                const productId = event.target.getAttribute("data-product-id");
                const productName = event.target.closest(".review-content")?.querySelector(".review-title")?.innerText || "";

                // âœ… í˜„ì¬ ëª¨ë‹¬ ìƒíƒœ(type: 'today' or 'weekly') í™•ì¸
                const modalType = document.getElementById("modalAnomalyTitle").getAttribute("data-active");

                // âœ… API URL ë¶„ê¸° ì²˜ë¦¬
                const endpoint = modalType === "today"
                    ? `/api/anomaly-guideline-today/${productId}`
                    : `/api/anomaly-guideline/${productId}`;

                // âœ… ë¡œë”© ë©”ì‹œì§€
                showGuidelineModal(`ğŸ”„ ${productName} ê°€ì´ë“œë¼ì¸ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...`);

                try {
                    const res = await fetch(endpoint);
                    if (!res.ok) throw new Error("ê°€ì´ë“œë¼ì¸ ìš”ì²­ ì‹¤íŒ¨");

                    const json = await res.json();
                    showGuidelineModal(`ğŸ“ [${productName}]\n\n${json.guideline}`);
                } catch (error) {
                    console.error("ğŸš¨ ê°€ì´ë“œë¼ì¸ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                    showGuidelineModal("âš ï¸ ê°€ì´ë“œë¼ì¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                }
            });
        });
    }
}

function showGuidelineModal(guidelineText) {
    const modal = document.getElementById("guidelineModal");
    const content = document.getElementById("guidelineModalContent");

    if (!modal || !content) return;

    // âœ… ë§¨ ìœ„ '[ë¬´ë£Œë°˜í’ˆ]' ì œê±°
    guidelineText = guidelineText.replace(/^\[.*?\]\s*\n*/, "").trim();

    // âœ… ì œí’ˆëª… ì¶”ì¶œ
    const productTitleMatch = guidelineText.match(/ğŸ“\s*\[\s*([\s\S]*?)\s*\]/);
    const productTitle = productTitleMatch ? productTitleMatch[1].trim() : "ì œí’ˆëª… ì—†ìŒ";

    // âœ… ğŸ“ [ì œí’ˆëª…] ì œê±°
    let body = guidelineText.replace(/ğŸ“\s*\[\s*([\s\S]*?)\s*\]/, "").trim();

    // âœ… ê¸°íƒ€ í…ìŠ¤íŠ¸ í´ë¦°ì—…
    body = body
        .replace(/\*{0,2}ì œí’ˆ\s*ê°œì„ \s*ê°€ì´ë“œë¼ì¸\*{0,2}/gi, "")
        .replace(/\*{1,3}(.+?)\*{1,3}/g, "$1")
        .trim();

    // âœ… ì œí’ˆëª…ì´ í¬í•¨ëœ ì¤„ ì œê±°
    const lines = body.split("\n").filter(line => {
        const cleanLine = line.replace(/\s/g, "");
        const cleanTitle = productTitle.replace(/\s/g, "");
        return !cleanLine.includes(cleanTitle);
    });
    body = lines.join("\n").trim();

    // âœ… ì„¹ì…˜ ë‚˜ëˆ„ê¸°
    const sectionBlocks = body.split(/\n(?=\d\.\s)/g);
    const formattedSections = sectionBlocks.map(section => {
        const lines = section.trim().split("\n");
        const title = lines[0].trim();
        const content = lines.slice(1).join("<br>");
        return `
            <div class="guideline-section">
                <div class="section-title">${title}</div>
                <div class="section-content">${content}</div>
            </div>
        `;
    }).join("");

    // âœ… ìµœì¢… ë Œë”ë§
    content.innerHTML = `
        <div class="guideline-card">
            <div class="guideline-header">
                <h2>${productTitle}</h2>
            </div>
            ${formattedSections}
        </div>
    `;

    modal.style.display = "block";
    modal.style.visibility = "visible";
    modal.style.opacity = "1";
    modal.style.zIndex = "9999";
}






function closeGuidelineModal() {
    const modal = document.getElementById("guidelineModal");
    if (modal) {
        modal.style.display = "none";
        modal.style.visibility = "hidden";
        modal.style.opacity = "0";
    }
}

function showReviewModal(productId) {
    if (!productId) {
        console.error("ğŸš¨ ì˜¤ë¥˜: showReviewModal()ì—ì„œ productIdê°€ undefinedì…ë‹ˆë‹¤!");
        return;
    }

    console.log(`ğŸ“¢ ë¦¬ë·° ìƒì„¸ë³´ê¸° ì‹¤í–‰ (Product ID: ${productId})`);

    if (!lastAnomalyData) {
        console.error("ğŸš¨ lastAnomalyDataê°€ ë¹„ì–´ ìˆìŒ!");
        return;
    }

    const modalTitle = document.getElementById("modalReviewTitle");
    const reviewList = document.getElementById("modalReviewList");

    modalTitle.innerText = `ë¦¬ë·° ìƒì„¸ë³´ê¸° (ìƒí’ˆ ID: ${productId})`;
    reviewList.innerHTML = "<p>ë¦¬ë·° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";

    let productReviews = [
        ...(lastAnomalyData.today.anomaly_reviews || []),
        ...(lastAnomalyData.weekly.anomaly_reviews || [])
    ].filter(review => String(review.product_id) === String(productId));

    // âœ… ì¤‘ë³µ ë¦¬ë·° ì œê±° (review_id + sentence ê¸°ì¤€)
    productReviews = removeDuplicateReviews(productReviews);

    if (productReviews.length === 0) {
        reviewList.innerHTML = "<p>ë¦¬ë·° ì—†ìŒ</p>";
        return;
    }

    reviewList.innerHTML = productReviews.map(review => {
        let sentimentClass = "";
        let sentimentIcon = "";

        switch (review.sentiment) {
            case 0:
                sentimentClass = "sentiment-negative";
                sentimentIcon = '<i class="fa-solid fa-face-frown" style="color: red;"></i>';
                break;
            case 1:
                sentimentClass = "sentiment-neutral";
                sentimentIcon = '<i class="fa-solid fa-meh" style="color: orange;"></i>';
                break;
            case 2:
                sentimentClass = "sentiment-positive";
                sentimentIcon = '<i class="fa-solid fa-face-smile" style="color: green;"></i>';
                break;
        }

        return `
            <div class="review-box">
                <div class="review-item"><i class="fa-solid fa-star" style="color: gold;"></i> <strong>ë³„ì :</strong> ${review.rating || "N/A"}ì </div>
                <div class="review-item"><i class="fa-solid fa-comment-dots"></i> <strong>ë¦¬ë·°:</strong> ${review.sentence || "ë‚´ìš© ì—†ìŒ"}</div>
                <div class="review-item"><i class="fa-solid fa-folder"></i> <strong>ì¹´í…Œê³ ë¦¬:</strong> ${review.category || "ë¯¸ë¶„ë¥˜"}</div>
                <div class="review-item"><i class="fa-solid fa-ruler-horizontal"></i> <strong>ì‚¬ì´ì¦ˆ:</strong> ${review.review_size || "ë¯¸ì§€ì •"}</div>
                <div class="review-item"><i class="fa-solid fa-calendar-day"></i> <strong>ì‘ì„±ì¼:</strong> ${review.review_date?.split(" ")[0] || "ë‚ ì§œ ì—†ìŒ"}</div>
                <div class="review-item ${sentimentClass}">
                    <i class="fa-solid fa-chart-line"></i> <strong>ê°ì„± ë¶„ì„:</strong>
                    ${sentimentIcon} ${review.sentiment === 0 ? "ë¶€ì • ê°ì„±" : review.sentiment === 1 ? "ì¤‘ë¦½ ê°ì„±" : "ê¸ì • ê°ì„±"}
                </div>
            </div>
        `;
    }).join("");

    const anomalyModal = document.getElementById("anomalyModal");
    if (anomalyModal) {
        anomalyModal.style.display = "none";
    }

    showModal("reviewModal");
}




// âœ… ëª¨ë‹¬ ì°½ ë‹«ê¸°
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = "none";
        modal.style.visibility = "hidden";
        modal.style.opacity = "0";
        console.log(`âœ… ëª¨ë‹¬ ë‹«í˜: ${modalId}`);

        // âœ… ë¦¬ë·° ëª¨ë‹¬ì„ ë‹«ìœ¼ë©´ anomalyModal ë‹¤ì‹œ ë³´ì´ê¸°
        if (modalId === "reviewModal") {
            const anomalyModal = document.getElementById("anomalyModal");
            if (anomalyModal) {
                anomalyModal.style.visibility = "visible";
                anomalyModal.style.display = "block";
                anomalyModal.style.opacity = "1";
            }
        }
    } else {
        console.warn(`âš ï¸ ëª¨ë‹¬ ID "${modalId}"ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
    }
}


// âœ… ê°•/ì•½ì  ë¶„ì„ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
function redirectToStrengthWeakness(productId) {
    window.location.href = `/strength-weakness.html?product_id=${productId}`;
}

// âœ… ì¹´í…Œê³ ë¦¬ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ (ì „ì²´ + ë¶€ì • ë¦¬ë·° í†µí•©)
function updateCombinedBarChart(canvasId, labels, totalData, negativeData) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    console.log(`ğŸ“Š [DEBUG] ${canvasId} ì°¨íŠ¸ ì—…ë°ì´íŠ¸:`);
    console.log("âœ… ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸:", labels);
    console.log("âœ… ì „ì²´ ë¦¬ë·° ìˆ˜:", totalData);
    console.log("âœ… ë¶€ì • ë¦¬ë·° ìˆ˜:", negativeData);

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels,
            datasets: [
                {
                    label: "ì „ì²´ ë¦¬ë·°",
                    data: totalData,
                    backgroundColor: '#36a2eb'
                },
                {
                    label: "ë¶€ì • ë¦¬ë·°",
                    data: negativeData,
                    backgroundColor: '#ff4d4d'
                }
            ]
        },
        options: {
            responsive: true,
            indexAxis: 'y',
            plugins: {
            legend: { display: true, position: 'top' },
            datalabels: {
                color: '#000',
                font: { weight: 'bold', size: 12 },
                formatter: (value) => value > 0 ? value : '',
                anchor: 'end', align: 'right', 
                clip: false  // ğŸš¨ í…ìŠ¤íŠ¸ê°€ ì˜ë¦¬ì§€ ì•Šë„ë¡ ì¶”ê°€
            }
        }
        },
        plugins: [ChartDataLabels]
    });
}
    // âœ… ë ˆì´ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateStackedAreaChart(canvasId, labels, dataset) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
    }

    chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: dataset
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    stacked: true,
                    beginAtZero: true
                }
            },
            plugins: {
                legend: { display: true, position: 'top' },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    color: '#000',
                    font: { weight: 'bold', size: 12 },
                    formatter: (value) => value > 0 ? value : ''
                }
            }
        },
        plugins: [ChartDataLabels]
    });
}

function showNotification(message, review) {
    if (!review) {
        console.error("ğŸš¨ ì˜¤ë¥˜: ì•Œë¦¼ì— í•„ìš”í•œ ë¦¬ë·° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const notificationId = `notification-${review.review_id}-${review.sentiment}`;
    if (document.getElementById(notificationId)) {
        console.warn(`âš ï¸ ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€: ë¦¬ë·° ID ${review.review_id} (${review.sentiment})`);
        return;
    }

    let anomalyType = "";
    if (review.sentiment === 0 && (review.rating === 4.0 || review.rating === 5.0)) {
        anomalyType = "ğŸ”´ [ë¶€ì • ê°ì„± ê°ì§€]";
    } else if (review.rating === 1.0 || review.rating === 2.0) {
        anomalyType = "ğŸŸ  [í‰ì  ê°ì§€]";
    } else {
        anomalyType = "âš ï¸ [ì¼ë°˜ ë¶€ì • ê°ì§€]";
    }

    const notification = document.createElement("div");
    notification.classList.add("notification-popup");
    notification.id = notificationId;

    const closeButton = document.createElement("span");
    closeButton.classList.add("close-btn");
    closeButton.innerHTML = "Ã—";
    closeButton.onclick = function () {
        notification.style.opacity = "0";
        notification.style.transform = "scale(0.95)";
        setTimeout(() => notification.remove(), 200);
    };

    notification.innerHTML = `
        <div class="title">ğŸš¨ ì´ìƒ ê°ì§€: ë¶€ì • ë¦¬ë·° ê°ì§€</div>
        <div class="anomaly-type">${anomalyType}</div>
        <div class="review">
            ğŸ“Œ ë¦¬ë·°: ${review.sentence || "ë‚´ìš© ì—†ìŒ"}
        </div>
        <div class="meta-info">
            // <span>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${review.category || "ë¯¸ë¶„ë¥˜"}</span>
            <span>â­ í‰ì : ${review.rating || "N/A"}ì </span>
        </div>
    `;

    notification.prepend(closeButton);

    let notificationContainer = document.getElementById("notification-container");
    if (!notificationContainer) {
        notificationContainer = document.createElement("div");
        notificationContainer.id = "notification-container";
        document.body.appendChild(notificationContainer);
    }

    notificationContainer.appendChild(notification);

    setTimeout(() => {
        notification.classList.add("show");
    }, 100);

    setTimeout(() => {
        notification.classList.remove("show");
        notification.style.transform = "scale(0.95)";
        setTimeout(() => notification.remove(), 200);
    }, 5000);
}



let reconnectInterval = 3000; // ì´ˆê¸° ì¬ì—°ê²° ê°„ê²© (3ì´ˆ)
let reconnectMaxInterval = 30000; // ìµœëŒ€ ì¬ì—°ê²° ê°„ê²© (30ì´ˆ)
let lastReceivedReviewId = null;
let pingInterval = null;  // âœ… Ping Intervalì„ ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬

function connectWebSocket() {
    console.log("ğŸ“¡ WebSocket ì—°ê²° ì‹œë„...");

    const wsStatusElement = document.getElementById("ws-status");
    if (!wsStatusElement) {
        console.warn("âš ï¸ WebSocket ìƒíƒœ í‘œì‹œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!");
        return;
    }

    // âœ… ì´ë¯¸ ì—°ê²° ì¤‘ì´ë©´ ì¤‘ë³µ ì—°ê²° ë°©ì§€
    if (socket && (socket.readyState === WebSocket.OPEN || socket.readyState === WebSocket.CONNECTING)) {
        console.log("âœ… WebSocketì´ ì´ë¯¸ ì—°ê²° ì¤‘ì´ê±°ë‚˜ ì—°ê²°ë¨.");
        return;
    }

    try {
        socket = new WebSocket(`ws://${window.location.host}/ws`);
        console.log("âœ… WebSocket ê°ì²´ ìƒì„±ë¨:", socket);

        socket.onopen = () => {
            console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ!");
            wsStatusElement.innerText = "âœ… WebSocket ì—°ê²°ë¨";
            reconnectAttempts = 0;

            // âœ… Ping ìš”ì²­ì„ í•œ ë²ˆë§Œ ì‹¤í–‰ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
            if (!pingInterval) {
                pingInterval = setInterval(() => {
                    if (socket.readyState === WebSocket.OPEN) {
                        console.log("ğŸ“¡ WebSocket Ping ìš”ì²­ ë³´ëƒ„...");
                        socket.send(JSON.stringify({ ping: "keep-alive" }));
                    }
                }, 300000); // 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
            }
        };

        socket.onmessage = (event) => {
            try {
                console.log("ğŸ“© WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :", event.data);

                let data;
                try {
                    data = JSON.parse(event.data);
                } catch (e) {
                    console.warn("âš ï¸ WebSocket JSON íŒŒì‹± ì‹¤íŒ¨, ì›ë³¸ ë©”ì‹œì§€ ì‚¬ìš©");
                    data = event.data;
                }

                // ğŸ”¹ Keep-alive Ping ì‘ë‹µ ì²˜ë¦¬
                if (data.ping === "keep-alive") {
                    console.log("ğŸ”„ WebSocket Ping ì‘ë‹µ ìˆ˜ì‹ ");
                    return;
                }

                // ğŸ”¹ WebSocket ë©”ì‹œì§€ ë°ì´í„° ê²€ì¦
                if (!data.alert || !data.review) {
                    console.warn("âš ï¸ ìˆ˜ì‹ ëœ WebSocket ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ:", data);
                    return;
                }

                // âœ… ì¤‘ë³µ ë©”ì‹œì§€ í•„í„°ë§ (ê°™ì€ review_id ì—°ì† ìˆ˜ì‹  ë°©ì§€)
                if (lastReceivedReviewId === data.review.review_id) {
                    console.warn(`âš ï¸ ì¤‘ë³µëœ WebSocket ì•Œë¦¼ ë¬´ì‹œ: ${data.review.review_id}`);
                    return;
                }
                lastReceivedReviewId = data.review.review_id;

                console.log("ğŸ“¢ ì´ìƒ ê°ì§€ ì•Œë¦¼ ìˆ˜ì‹ :", data.alert);
                showNotification(data.alert, data.review);
                updateNegativeReviewsList(data.review);
            } catch (error) {
                console.error("ğŸš¨ WebSocket ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:", error, "ë°›ì€ ë°ì´í„°:", event.data);
            }
        };

        socket.onclose = () => {
            console.warn("âš ï¸ WebSocket ì—°ê²° ì¢…ë£Œë¨. ì¬ì—°ê²° ì‹œë„...");
            wsStatusElement.innerText = "âš ï¸ WebSocket ì—°ê²° í•´ì œë¨";

            if (reconnectAttempts >= maxReconnectAttempts) {
                console.warn("ğŸš¨ WebSocket ì¬ì—°ê²° ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼. ë” ì´ìƒ ì¬ì—°ê²°í•˜ì§€ ì•ŠìŒ.");
                wsStatusElement.innerText = "âŒ WebSocket ì—°ê²° ì‹¤íŒ¨ (ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼)";
                return;
            }

            reconnectAttempts++;
            const retryDelay = Math.min(3000 * reconnectAttempts, 30000); // ìµœëŒ€ 30ì´ˆê¹Œì§€ ì¦ê°€

            console.log(`ğŸ”„ WebSocket ì¬ì—°ê²° ì‹œë„ (${reconnectAttempts}/${maxReconnectAttempts})... ëŒ€ê¸° ì‹œê°„: ${retryDelay / 1000}ì´ˆ`);
            reconnectTimeout = setTimeout(connectWebSocket, retryDelay);
        };

        socket.onerror = (error) => {
            console.error("ğŸš¨ WebSocket ì˜¤ë¥˜ ë°œìƒ:", error);
            socket.close();
        };
    } catch (error) {
        console.error("ğŸš¨ WebSocket ìƒì„± ì˜¤ë¥˜:", error);
    }
}
    document.addEventListener("DOMContentLoaded", async () => {
    console.log("ğŸ“¡ WebSocket ë° ë°ì´í„° ì´ˆê¸°í™”...");

    // âœ… ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
    const todayDateElement = document.getElementById("today_date");
    if (todayDateElement) {
        todayDateElement.innerText = new Date().toISOString().slice(0, 10);
    } else {
        console.warn("âš ï¸ today_date ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // âœ… WebSocket ì—°ê²°
    console.log("ğŸ” connectWebSocket í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€:", typeof connectWebSocket);
    connectWebSocket();
    console.log("ğŸ“¡ ê°•ì œ ì‹¤í–‰ í›„ WebSocket ìƒíƒœ:", typeof socket, socket ? socket.readyState : "WebSocket ê°ì²´ ì—†ìŒ");
    // âœ… ì´ìƒ ê°ì§€ ë¦¬ë·° ë°ì´í„° ë¡œë“œ
    console.log("ğŸ“¡ fetchAnomalySummary() ì‹¤í–‰ë¨!");
    fetchAnomalySummary();
    // âœ… ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ í‘œì‹œ (ìˆ˜ì •ë¨)
    document.querySelector(".btn[data-type='today']")
        ?.addEventListener("click", () => {
            console.log("âœ… ì˜¤ëŠ˜ ì´ìƒ ê°ì§€ ëª©ë¡ ë²„íŠ¼ í´ë¦­ë¨!");
            updateAnomalyReviews("today", lastAnomalyData?.today?.anomaly_reviews || []);
        });
        document.querySelector(".btn[data-type='weekly']")
        ?.addEventListener("click", () => {
            console.log("âœ… ì´ë²ˆ ì£¼ ì´ìƒ ê°ì§€ ëª©ë¡ ë²„íŠ¼ í´ë¦­ë¨!");
            updateAnomalyReviews("weekly", lastAnomalyData?.weekly?.anomaly_reviews || []);
        });
    setInterval(fetchAnomalySummary, 60000); // 30ì´ˆë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
    
    // âœ… ì°¨íŠ¸ ë°ì´í„° ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
    const startDate = document.getElementById("startDate").value;
    const endDate = document.getElementById("endDate").value;

    // âœ… APIì—ì„œ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
    const [totalSales, categorySales, genderSales] = await Promise.all([
        fetchData(`/api/total-sales?startDate=${startDate}&endDate=${endDate}`),
        fetchData(`/api/category-sales?startDate=${startDate}&endDate=${endDate}`),
        fetchData(`/api/gender-sales?startDate=${startDate}&endDate=${endDate}`)
    ]);

    // âœ… ë°ì´í„° ìºì‹± (ë¡œì»¬ ë³€ìˆ˜ë¡œ ì €ì¥)
    console.log("âœ… ë¬¸ì„œê°€ ë¡œë“œë¨, ì´ìƒ ê°ì§€ ë¦¬ìŠ¤íŠ¸ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ");
    
    // âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelector(".toggle-btn[data-type='today']")
        ?.addEventListener("click", () => toggleAnomalyList("today"));
    
    document.querySelector(".toggle-btn[data-type='weekly']")
        ?.addEventListener("click", () => toggleAnomalyList("weekly"));
    const chartData = { totalSales, categorySales, genderSales };

    // âœ… ì°¨íŠ¸ ì§€ì—° ë¡œë”© ì„¤ì •
    const lazyCharts = document.querySelectorAll("canvas");

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const canvasId = entry.target.id;
                console.log(`ğŸ¨ ì°¨íŠ¸ ë¡œë”©: ${canvasId}`);

                // âœ… APIì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„° ì „ë‹¬
                if (canvasId === "totalSalesChart" && chartData.totalSales) {
                    renderTotalSalesChart(chartData.totalSales);
                }
                if (canvasId === "categorySalesChart" && chartData.categorySales) {
                    renderCategorySalesChart(chartData.categorySales);
                }
                if (canvasId === "genderSalesChart" && chartData.genderSales) {
                    renderGenderSalesChart(chartData.genderSales);
                }
                
                observer.unobserve(entry.target); // âœ… í•œ ë²ˆ ë¡œë“œí•œ í›„ ë” ì´ìƒ ê°ì§€í•˜ì§€ ì•ŠìŒ
            }
        });
    }, { threshold: 0.1 });

    lazyCharts.forEach(chart => observer.observe(chart));
});

function toggleAnomalyList(type) {
    document.getElementById("today-anomaly-section").style.display = type === "today" ? "block" : "none";
    document.getElementById("weekly-anomaly-section").style.display = type === "weekly" ? "block" : "none";
}

function updateNegativeReviewsList(newReview) {
    let reviewList = document.getElementById("negative-reviews");

    // âœ… ìš”ì†Œê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„± í›„ ì¶”ê°€
    if (!reviewList) {
        console.warn("âš ï¸ `negative-reviews` ìš”ì†Œê°€ ì—†ì–´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.");
        reviewList = document.createElement("ul");
        reviewList.id = "negative-reviews";
        document.body.appendChild(reviewList);  // âœ… bodyì— ì¶”ê°€
    }

    // âœ… ì¤‘ë³µ ë¦¬ë·° ë°©ì§€
    if (document.getElementById(`review-${newReview.review_id}`)) {
        console.warn(`âš ï¸ ì¤‘ë³µ ë¦¬ë·° ê°ì§€: ${newReview.review_id}`);
        return;
    }

    const listItem = document.createElement("li");
    listItem.id = `review-${newReview.review_id}`;
    listItem.innerHTML = `
        <strong>${newReview.product_name}</strong> (${newReview.brand}) - â­ ${newReview.rating}ì <br>
        ğŸ“Œ ${newReview.sentence}
    `;

    reviewList.prepend(listItem);
}

function navigateTo(url) {
    window.location.href = url;
}
// ##############################################################################################################################################################################################################################
// ë¸Œëœë“œ ë¶„ì„ í‰ê°€
document.addEventListener("DOMContentLoaded", async function () {
    const defaultBrand = "ë¬´ì‹ ì‚¬ ìŠ¤íƒ ë‹¤ë“œ"; // âœ… ê¸°ë³¸ ê²€ìƒ‰í•  ë¸Œëœë“œ ì§€ì •
    document.getElementById("brand-name").value = defaultBrand;
    await fetchBrandAnalysis(); // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ë¸Œëœë“œ ê²€ìƒ‰ ì‹¤í–‰
});

async function fetchBrandAnalysis() {
    let brandName = document.getElementById("brand-name").value.trim();
    if (!brandName) {
        brandName = "ë¬´ì‹ ì‚¬ ìŠ¤íƒ ë‹¤ë“œ"; // âœ… ê¸°ë³¸ ë¸Œëœë“œ ì§€ì •
    }

    console.log(`ğŸ“¡ ë¸Œëœë“œ ë¶„ì„ ìš”ì²­: /api/brand-analysis/${brandName}`);

    try {
        const response = await fetch(`/api/brand-analysis/${brandName}`);
        const data = await response.json();

        if (!response.ok) {
            console.error("ğŸš¨ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
            return;
        }

        console.log("ğŸ“¡ ì„œë²„ ì‘ë‹µ ë°ì´í„°:", data); 
        updateBrandGauge(data.overall_score);  // âœ… ë¸Œëœë“œ ì¢…í•© í‰ê°€ ì—…ë°ì´íŠ¸
        displayBrandAnalysis(data); // âœ… í† í”½ë³„ ë§Œì¡±ë„ & ì–¸ê¸‰ëŸ‰ í‘œì‹œ
        const salesData = data.sales_data || {}; 
        renderBrandSalesChart(salesData); // âœ… ë¸Œëœë“œë³„ íŒë§¤ëŸ‰ ì¶”ì´ ì¶”ê°€

    } catch (error) {
        console.error("ğŸ”¥ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:", error);
    }
}

// ê²€ìƒ‰ ê¸°ëŠ¥
document.getElementById("brand-name").addEventListener("input", async function () {
    const query = this.value.trim();
    const dropdown = document.getElementById("brand-suggestions");

    if (query.length === 0) {
        dropdown.innerHTML = "";
        return;
    }

    try {
        const response = await fetch(`/api/search-brands/?query=${query}`);
        const data = await response.json();

        dropdown.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        data.brands.forEach((brand) => {
            const option = document.createElement("div");
            option.classList.add("suggestion-item");
            option.innerText = brand;
            // ğŸš€ `click` ëŒ€ì‹  `mousedown` ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì— ì…ë ¥ë˜ë„ë¡ ìˆ˜ì •
            option.addEventListener("mousedown", async function () {
                document.getElementById("brand-name").value = brand;
                dropdown.innerHTML = ""; // ì„ íƒ í›„ ëª©ë¡ ìˆ¨ê¸°ê¸°
                
                await fetchBrandAnalysis(); // ğŸš€ ìë™ ê²€ìƒ‰ ì‹¤í–‰
            });
            dropdown.appendChild(option);
        });

        dropdown.style.display = data.brands.length ? "block" : "none";

    } catch (error) {
        console.error("ğŸš¨ ë¸Œëœë“œ ìë™ ì™„ì„± ì˜¤ë¥˜:", error);
    }
});

// âœ… ê²€ìƒ‰ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ìë™ì™„ì„± ëª©ë¡ ìˆ¨ê¹€
document.addEventListener("click", function (event) {
    const searchContainer = document.querySelector(".search-container");
    if (!searchContainer.contains(event.target)) {
        document.getElementById("brand-suggestions").style.display = "none";
    }
});

function displayBrandAnalysis(data) {
    const scoreResults = document.getElementById("brand-score-results");
    const frequencyResults = document.getElementById("brand-frequency-results");

    scoreResults.innerHTML = "";
    frequencyResults.innerHTML = "";
    
    if (!data.topics || Object.keys(data.topics).length === 0) {
        scoreResults.innerHTML = "<p>í•´ë‹¹ ë¸Œëœë“œì— ëŒ€í•œ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        frequencyResults.innerHTML = "<p>í•´ë‹¹ ë¸Œëœë“œì— ëŒ€í•œ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
    }
    Object.entries(data.topics)
        .sort((a, b) => b[1].score - a[1].score)
        .forEach(([topic, info]) => {
            addBar(scoreResults, topic, info.score, "", 100, true);
        });
    
    // âœ… "í† í”½ë³„ ì–¸ê¸‰ëŸ‰" ë°ì´í„° í™•ì¸
    console.log("ğŸ“Š í† í”½ë³„ ì–¸ê¸‰ëŸ‰ ë°ì´í„° í™•ì¸:", data.topic_sentiment);

    if (!data.topic_sentiment || Object.keys(data.topic_sentiment).length === 0) {
        console.warn("âš ï¸ í† í”½ë³„ ì–¸ê¸‰ëŸ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    
    Object.entries(data.topic_sentiment).forEach(([topic, info]) => {
        console.log(`ğŸ“Š ${topic}: ê¸ì •=${info.positive}, ì¤‘ë¦½=${info.neutral}, ë¶€ì •=${info.negative}`);
        addSentimentBar(frequencyResults, topic, info.positive, info.neutral, info.negative);
    });
}


function addBar(container, label, value, text, maxValue, isSatisfaction = false) {
    const barContainer = document.createElement("div");
    barContainer.classList.add("bar-container");

    const labelDiv = document.createElement("div");
    labelDiv.classList.add("bar-label");
    labelDiv.innerHTML = `${label}`;

    const barWrapper = document.createElement("div");
    barWrapper.classList.add("bar-wrapper");

    const backgroundBar = document.createElement("div");
    backgroundBar.classList.add("background-bar");

    const bar = document.createElement("div");
    bar.classList.add("bar");

    let widthPercentage;
    if (isSatisfaction) {
        widthPercentage = ((value - 50) / (100 - 50)) * 100;
    } else {
        widthPercentage = Math.min(100, (value / maxValue) * 100);
    }

    // âœ… 0ì ì´ë©´ ë°”ë¥¼ í‘œì‹œí•˜ì§€ ì•Šê³  ë°°ê²½ ì‚­ì œ
    if (value === 0) {
        bar.style.width = "100%"; // âœ… ë³´ì´ì§€ëŠ” ì•Šì§€ë§Œ íˆ´íŒ ê°ì§€ë¥¼ ìœ„í•´ ì˜ì—­ ìœ ì§€
        bar.style.backgroundColor = "transparent"; // âœ… ì‹œê°ì ìœ¼ë¡œ ìˆ¨ê¹€
        bar.style.minHeight = "20px"; // âœ… ë†’ì´ ìœ ì§€ (ì´ë²¤íŠ¸ ê°ì§€ìš©)

    } else {
        widthPercentage = Math.max(5, widthPercentage); // ìµœì†Œ ë„ˆë¹„ 5% ìœ ì§€
        bar.style.width = `${widthPercentage}%`;

        if (isSatisfaction) {
            bar.style.backgroundColor = value > 92 ? "#4CAF50" : value >= 85 ? "#FFD700": "#FF5733";
        } else {
            bar.style.backgroundColor = "#888";
        }
    }

    // âœ… ì ìˆ˜ í‘œì‹œí•˜ëŠ” í…ìŠ¤íŠ¸
    const textElement = document.createElement("span");
    textElement.classList.add("bar-text");
    textElement.innerText = text ? text : `${value.toFixed(1)}ì `;

    textElement.style.position = "absolute";
    textElement.style.right = "10px";
    textElement.style.fontWeight = "bold";
    textElement.style.color = "#333";

    if (widthPercentage < 20) {
        textElement.style.right = "5px";
        textElement.style.color = "#fff";
    }

    // **íˆ´íŒ ìƒì„±**
    const tooltip = document.createElement("div");
    tooltip.classList.add("tooltip");
    tooltip.innerHTML = `<strong>${label}</strong><br>ë§Œì¡±ë„: ${value.toFixed(1)}ì `;

    document.body.appendChild(tooltip);

    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì¶”ê°€
    bar.addEventListener("mouseover", (event) => {
        tooltip.style.display = "block";
        tooltip.style.left = event.pageX + 10 + "px";
        tooltip.style.top = event.pageY - 30 + "px";
    });

    bar.addEventListener("mousemove", (event) => {
        tooltip.style.left = event.pageX + 10 + "px";
        tooltip.style.top = event.pageY - 30 + "px";
    });

    bar.addEventListener("mouseout", () => {
        tooltip.style.display = "none";
    });
    
    bar.appendChild(textElement);
    backgroundBar.appendChild(bar);
    barWrapper.appendChild(backgroundBar);
    barContainer.appendChild(labelDiv);
    barContainer.appendChild(barWrapper);
    container.appendChild(barContainer);
}

function addSentimentBar(container, label, positive, neutral, negative) {
    const barContainer = document.createElement("div");
    barContainer.classList.add("bar-container");

    const labelDiv = document.createElement("div");
    labelDiv.classList.add("bar-label");
    labelDiv.innerHTML = `${label}`;

    const barWrapper = document.createElement("div");
    barWrapper.classList.add("bar-wrapper");

    const backgroundBar = document.createElement("div");
    backgroundBar.classList.add("background-bar-sentiment");

    const total = (positive || 0) + (neutral || 0) + (negative || 0);

    // âœ… íˆ´íŒ ìƒì„± (ëª¨ë“  ê°’ì´ 0ì¼ ë•Œë„ íˆ´íŒì„ í‘œì‹œí•´ì•¼ í•¨)
    const tooltip = document.createElement("div");
    tooltip.classList.add("tooltip");
    tooltip.innerHTML = `<strong>${label}</strong><br>ê¸ì •: ${positive}ê±´<br>ì¤‘ë¦½: ${neutral}ê±´<br>ë¶€ì •: ${negative}ê±´`;
    tooltip.style.display = "none";
    document.body.appendChild(tooltip);

    function showTooltip(event) {
        tooltip.style.display = "block";
        tooltip.style.left = `${event.pageX + 10}px`;
        tooltip.style.top = `${event.pageY - 30}px`;
    }

    function hideTooltip() {
        tooltip.style.display = "none";
    }

    // âœ… ëª¨ë“  ê°’ì´ 0ì´ë©´ íšŒìƒ‰ ë°°ê²½ ìœ ì§€ + "0ê±´" í‘œì‹œ + íˆ´íŒ ì´ë²¤íŠ¸ ì¶”ê°€
    if (total === 0) {
        backgroundBar.style.backgroundColor = "transparent"; // âœ… ë°°ê²½ ì—†ìŒ
        backgroundBar.style.width = "100%";
        backgroundBar.style.position = "relative"; // íˆ´íŒ ìœ„ì¹˜ë¥¼ ìœ„í•´ ì¶”ê°€

        const zeroText = document.createElement("span");
        zeroText.classList.add("zero-text");
        zeroText.innerText = "0ê±´";
        zeroText.style.position = "absolute";
        zeroText.style.left = "50%";
        zeroText.style.top = "50%";
        zeroText.style.transform = "translate(-50%, -50%)";
        zeroText.style.color = "#FFF";
        zeroText.style.fontWeight = "900";
        zeroText.style.fontSize = "11px";

        backgroundBar.appendChild(zeroText);

        // âœ… "0ê±´"ì´ ìˆëŠ” ê²½ìš°ì—ë„ íˆ´íŒì´ ë³´ì´ë„ë¡ ì´ë²¤íŠ¸ ì¶”ê°€
        backgroundBar.addEventListener("mouseover", showTooltip);
        backgroundBar.addEventListener("mousemove", showTooltip);
        backgroundBar.addEventListener("mouseout", hideTooltip);
    }

    // âœ… ë¹„ìœ¨ ê³„ì‚° (ì „ì²´ í¬ê¸° ì•ˆì—ì„œ ìƒëŒ€ì ì¸ ë¹„ìœ¨ ìœ ì§€)
    const positiveRatio = (positive / total) * 100;
    const neutralRatio = (neutral / total) * 100;
    const negativeRatio = (negative / total) * 100;

    function createBar(color, width, value) {
        if (value === 0) return null; // âœ… 0ì ì´ë©´ ë°” ìì²´ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŒ.

        const bar = document.createElement("div");
        bar.classList.add("bar");
        bar.style.width = `${width}%`;
        bar.style.backgroundColor = color;
        bar.style.position = "relative";

        // âœ… í…ìŠ¤íŠ¸ ìƒì„± (0ê±´ì´ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
        if (value > 0) {
            const textElement = document.createElement("span");
            textElement.classList.add("bar-text-sentiment");
            textElement.innerText = `${value}ê±´`;

            // âœ… ë°”ì˜ ì¤‘ì•™ì— í…ìŠ¤íŠ¸ ë°°ì¹˜
            textElement.style.position = "absolute";
            textElement.style.left = "50%";
            textElement.style.top = "50%";
            textElement.style.transform = "translate(-50%, -50%)";
            textElement.style.whiteSpace = "nowrap";
            textElement.style.color = "black";
            textElement.style.fontSize = width < 10 ? "10px" : "12px"; // ë°”ê°€ ì‘ìœ¼ë©´ ê¸€ì í¬ê¸° ì¡°ì •
            bar.appendChild(textElement);
        }

        // âœ… íˆ´íŒ ì´ë²¤íŠ¸ ì¶”ê°€
        bar.addEventListener("mouseover", showTooltip);
        bar.addEventListener("mousemove", showTooltip);
        bar.addEventListener("mouseout", hideTooltip);

        return bar;
    }

    // âœ… ë°”ë¥¼ ìˆœì„œëŒ€ë¡œ ì¶”ê°€ (ì™¼ìª½ë¶€í„° ê¸ì • â†’ ì¤‘ë¦½ â†’ ë¶€ì •)
    const posBar = createBar("#187BCD", positiveRatio, positive); // íŒŒë‘ (ê¸ì •)
    const neuBar = createBar("#8B5A2B", neutralRatio, neutral); // íšŒìƒ‰ (ì¤‘ë¦½)
    const negBar = createBar("#FF4D4D", negativeRatio, negative); // ë¹¨ê°• (ë¶€ì •)

    if (posBar) backgroundBar.appendChild(posBar);
    if (neuBar) backgroundBar.appendChild(neuBar);
    if (negBar) backgroundBar.appendChild(negBar);

    barWrapper.appendChild(backgroundBar);
    barContainer.appendChild(labelDiv);
    barContainer.appendChild(barWrapper);
    container.appendChild(barContainer);
}


function updateBrandGauge(score) {
    console.log(`âš™ï¸ [updateBrandGauge] score=${score}`);

    let fillElement = document.getElementById("brand-score-fill");
    let scoreElement = document.getElementById("brand-score-text");
    let ratingElement = document.getElementById("brand-score-rating");

    if (!fillElement || !scoreElement || !ratingElement) {
        console.error("âŒ ë¸Œëœë“œ í‰ê°€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ");
        return;
    }

    if (typeof score !== "number" || isNaN(score)) {
        console.warn("âš ï¸ ë¸Œëœë“œ ì ìˆ˜ ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’(40) ì ìš©");
        score = 40;
    } else if (score === 0) {
        scoreElement.textContent = "ì•„ì§ í‰ê°€ ì—†ìŒ";
        return;
    }

    let rating = "ë¯¸í¡";
    let color = "rgba(255, 99, 132, 0.7)";  // ê¸°ë³¸ê°’ ë¹¨ê°„ìƒ‰ (ë¯¸í¡)

    if (score >= 80) {
        rating = "ì¢‹ìŒ";
        color = "rgba(75, 192, 92, 0.7)";  // âœ… ì´ˆë¡ìƒ‰
    } else if (score >= 60) {
        rating = "ë³´í†µ";
        color = "rgba(255, 206, 86, 0.7)";  // âœ… ë…¸ë€ìƒ‰
    }

    let adjustedScore = Math.max(40, Math.min(score, 115));
    let percent = (adjustedScore - 40) / (115 - 40);
    let dashArrayValue = Math.min(percent * 251, 251);

    console.log(`ğŸ¯ [updateBrandGauge] ë³€í™˜ëœ ë¹„ìœ¨: ${percent}, stroke-dasharray: ${dashArrayValue}, color: ${color}`);

    // âœ… stroke ìƒ‰ìƒ ë³€ê²½
    fillElement.setAttribute("stroke", color);
    fillElement.setAttribute("stroke-dasharray", `${dashArrayValue}, 251`);
    
    scoreElement.textContent = `${score.toFixed(1)}ì /100ì `;
    ratingElement.textContent = rating;
}


function renderBrandSalesChart(salesData) {
    const ctx = document.getElementById("brandSalesChart").getContext("2d");
    ctx.canvas.style.maxHeight = "400px"; // âœ… ìµœëŒ€ ë†’ì´ ì„¤ì •

    // âœ… ê¸°ì¡´ ì°¨íŠ¸ê°€ ì¡´ì¬í•˜ë©´ ì‚­ì œ
    if (window.brandSalesChart instanceof Chart) {
        window.brandSalesChart.destroy();
    }


    if (salesData && Object.keys(salesData).length > 0) {
        defaultLabels = Object.keys(salesData);
        defaultSales = Object.values(salesData);
    }

    // âœ… salesDataê°€ ì—†ê±°ë‚˜ ë¹ˆ ê°ì²´ì¼ ê²½ìš° ê·¸ë˜í”„ ì´ˆê¸°í™”
    if (!salesData || Object.keys(salesData).length === 0) {
        console.warn("ğŸ“Š íŒë§¤ëŸ‰ ë°ì´í„° ì—†ìŒ. ê·¸ë˜í”„ ì´ˆê¸°í™”.");
        window.brandSalesChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [{
                    label: "ì—°ë„ë³„ ë¦¬ë·° ê°œìˆ˜",
                    data: [],
                    borderColor: "rgba(255, 255, 255, 1)",
                    backgroundColor: "rgba(54, 162, 235, 0.1)",
                    borderWidth: 2,
                    pointRadius: 5,
                    pointBackgroundColor: "rgba(54, 162, 235, 1)",
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: { title: { display: true, text: "ì—°ë„ë³„" } },
                    y: { beginAtZero: true, title: { display: true, text: "ë¦¬ë·° ê°œìˆ˜" } }
                },
                plugins: {
                    legend: { position: "top"}
                }
            }
        });
        return; // ğŸš€ ì—¬ê¸°ì„œ í•¨ìˆ˜ ì¢…ë£Œ (ë” ì´ìƒ ì‹¤í–‰í•  í•„ìš” ì—†ìŒ)
    }

    // âœ… ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš° ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
    const years = Object.keys(salesData);
    const sales = Object.values(salesData);

    console.log("ğŸ“Š ì •ì œëœ ë°ì´í„°:", { years, sales });

    window.brandSalesChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: years,
            datasets: [{
                label: "ì—°ë„ë³„ ë¦¬ë·° ê°œìˆ˜",
                data: sales,
                borderColor: "rgba(72, 209, 204, 0.7)",
                backgroundColor: "rgba(72, 209, 204, 0.2)",
                borderWidth: 2,
                pointRadius: 5,
                pointBackgroundColor: "rgba(72, 209, 204, 0.7)",
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                x: { title: { display: true, text: "ì—°ë„ë³„" } },
                y: { beginAtZero: true, title: { display: true, text: "ë¦¬ë·° ê°œìˆ˜" } }
            },
            plugins: {
                legend: { position: "top" }
            }
        }
    });
}

// ##############################################################################################################################################################################################################################
// ë¸Œëœë“œ ë¶„ì„ í‰ê°€ ì•„ë˜ ì œí’ˆ ê²€ìƒ‰

// í•„í„° ì˜µì…˜ ì°½ì„ ì—´ê³  ë‹«ëŠ” ê¸°ëŠ¥ì„ ì œê³µ
function toggleFilter(filterId) {
    const currentFilter = document.getElementById(`filter-${filterId}`);
    const allFilters = document.querySelectorAll(".filter-options");

    // ëª¨ë“  í•„í„° ì°½ ë‹«ê¸°
    allFilters.forEach(filter => {
        if (filter !== currentFilter) {
            filter.style.display = "none";
            filter.parentElement.classList.remove("active");
        }
    });

    // í˜„ì¬ ì„ íƒëœ í•„í„° í† ê¸€
    const isOpen = currentFilter.style.display === "block";
    currentFilter.style.display = isOpen ? "none" : "block";
    currentFilter.parentElement.classList.toggle("active", !isOpen);
}
// í•„í„° ì„ íƒ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ê²€ìƒ‰ ìš”ì²­ì„ ì‹¤í–‰
function updateFilterLabel(filterId) {
    let selectElement = document.getElementById(`${filterId}-select`);
    let selectedText = "";

    if (filterId === "reviews") {
        selectedText = document.getElementById("min-reviews").value + "ê°œ ì´ìƒ";
    } else if (filterId === "price") {
        const minPrice = document.getElementById("price-min").value.trim();
        const maxPrice = document.getElementById("price-max").value.trim();

        if (minPrice !== "" && maxPrice !== "") {
            selectedText = `${minPrice} ~ ${maxPrice}`;
        } else if (minPrice !== "") {
            selectedText = `${minPrice} ì› ì´ìƒ`;
        } else if (maxPrice !== "") {
            selectedText = `${maxPrice} ì› ì´í•˜`;
        } else {
            selectedText = "ìµœì†Œ ~ ìµœëŒ€";
        }
    } else {
        selectedText = selectElement.options[selectElement.selectedIndex].text;
    }

    document.getElementById(`selected-${filterId}`).innerText = selectedText !== "ì „ì²´" ? ` ${selectedText}` : "";
    // âœ… í•„í„° ì„ íƒ í›„ ìë™ ë‹«ê¸° ì¶”ê°€
    const currentFilter = document.getElementById(`filter-${filterId}`);
    currentFilter.style.display = "none";
    currentFilter.parentElement.classList.remove("active");
    // âœ… UI ì—…ë°ì´íŠ¸ í›„ ê²€ìƒ‰ ì‹¤í–‰
    fetchProductList();
}

async function applyAutoFilters(data) {
    try {
        const productInfo = data.product;
        if (!productInfo) return;

        // âœ… ê°€ê²© ë°ì´í„° ì „ì²˜ë¦¬: "ì›" ì œê±° + ìˆ«ìë¡œ ë³€í™˜
        let priceText = productInfo.price.toString().replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
        let price = parseInt(priceText, 10); // ì •ìˆ˜ë¡œ ë³€í™˜

        if (isNaN(price)) {
            console.error("âŒ ê°€ê²© ë³€í™˜ ì˜¤ë¥˜: ", productInfo.price);
            return;
        }

        // âœ… ì¹´í…Œê³ ë¦¬ ìë™ ì„¤ì •
        document.getElementById("category-select").value = productInfo.category;
        document.getElementById("selected-category").innerText = ` (${productInfo.category})`;

        // âœ… ì„±ë³„ ìë™ ì„¤ì •
        document.getElementById("gender-select").value = productInfo.gender;
        document.getElementById("selected-gender").innerText = ` (${productInfo.gender})`;

        // âœ… ê°€ê²©ëŒ€ ìë™ ì„¤ì • (0.5ë°° ~ 1.5ë°°)
        const minPrice = Math.floor(price * 0.5);
        const maxPrice = Math.ceil(price * 1.5);
        document.getElementById("price-min").value = minPrice;
        document.getElementById("price-max").value = maxPrice;
        document.getElementById("selected-price").innerText = ` (${minPrice} ~ ${maxPrice} ì›)`;

        // âœ… ìë™ìœ¼ë¡œ í•´ë‹¹ í•„í„°ë¥¼ ì ìš©í•˜ì—¬ ìœ ì‚¬ ì œí’ˆ ê²€ìƒ‰ ì‹¤í–‰
        fetchProductList();
    } catch (error) {
        console.error("ğŸ”¥ ìë™ í•„í„° ì„¤ì • ì˜¤ë¥˜:", error);
    }
}

function scrollToProductList() {
    const productListElement = document.getElementById("product-results");
    if (!productListElement) {
        console.error("âŒ 'product-results' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    // ì œí’ˆ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
    productListElement.scrollIntoView({
        behavior: "smooth", // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ íš¨ê³¼
        block: "start"      // ìš”ì†Œë¥¼ í™”ë©´ ìƒë‹¨ì— ì •ë ¬
    });
}

async function fetchProductList() {
    const category = document.getElementById("category-select").value || "";
    const gender = document.getElementById("gender-select").value || "";
    let priceMin = document.getElementById("price-min").value.trim();
    let priceMax = document.getElementById("price-max").value.trim();
    const topic = document.getElementById("topic-select").value || "";
    const minReviews = document.getElementById("min-reviews").value || 0;

    // âœ… ë¹ˆ ë¬¸ìì—´("")ì´ APIì— ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ìˆ˜ì •
    priceMin = priceMin === "" ? "0" : parseInt(priceMin, 10);
    priceMax = priceMax === "" ? "99999999" : parseInt(priceMax, 10);

    // ğŸ” ê²€ìƒ‰ ìš”ì²­ URL í™•ì¸
    const requestUrl = `/api/product-search?category=${category}&gender=${gender}&price_min=${priceMin}&price_max=${priceMax}&topic=${topic}&min_reviews=${minReviews}`;
    console.log("ğŸ“¡ ê²€ìƒ‰ ìš”ì²­:", requestUrl);

    try {
        const response = await fetch(requestUrl);
        const responseText = await response.text();
        console.log("ğŸ” ê²€ìƒ‰ ì‘ë‹µ:", responseText);

        if (!response.ok) {
            console.error("ğŸš¨ ê²€ìƒ‰ ìš”ì²­ ì‹¤íŒ¨!");
            return;
        }

        const data = JSON.parse(responseText);
        displayProducts(data.products);
    } catch (error) {
        console.error("ğŸ”¥ ì œí’ˆ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:", error);
    }
}


// ì œí’ˆ ëª©ë¡ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ì—­í• 
function displayProducts(products) {
    const resultsContainer = document.getElementById("product-results");
    resultsContainer.innerHTML = "";
    fetchBrandScore()
    if (!products.length) {
        resultsContainer.innerHTML = "<p>ì¡°ê±´ì— ë§ëŠ” ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
    }

    products.forEach(product => {
        const productDiv = document.createElement("div");
        productDiv.classList.add("product-container");

        let reviewInfo = `${product.review_count}ê°œ`;
        if (product.avg_sentiment) {
            reviewInfo += ` (${product.avg_sentiment.toFixed(1)}ì )`;
        }

        let topicScores = `<span class="sentiment-score">ì „ì²´ í‰ê·  ê°ì„± ì ìˆ˜: ${product.avg_sentiment.toFixed(1)}ì </span>`;
        if (Object.keys(product.filtered_topics).length > 0) {
            topicScores = "";
            Object.entries(product.filtered_topics).forEach(([topic, score]) => {
                topicScores += `<span class="sentiment-score">${topic}: ${score.toFixed(1)}ì </span> `;
            });
        }

        productDiv.innerHTML = `
            <img src="${product.image_url}" class="product-image" style="cursor: pointer;" onclick="openProductDetails('${product.product_id}')" />
            <div class="product-info">
                <p><strong>
                    <span style="cursor: pointer; text-decoration: underline;" onclick="openProductDetails('${product.product_id}')">${product.product_name}</span>
                </strong></p>
                <p>ê°€ê²©: ${product.price}</p>
                <p>ì¹´í…Œê³ ë¦¬: ${product.category}</p>
                <p>ë¸Œëœë“œ: ${product.brand}</p>
                <p>ë¦¬ë·° ìˆ˜: ${reviewInfo}</p>
            </div>
            <div class="score-container">
                ${topicScores}
            </div>
        `;

        resultsContainer.appendChild(productDiv);
    });
}    



// íŠ¹ì • ì œí’ˆì˜ ìƒì„¸ ì •ë³´ë¥¼ í™”ë©´ì— í‘œì‹œ
function displayProductInfo(productData) {
        if (!productData || !productData.product_name) {
            document.getElementById("product-info").style.display = "none";
            return;
        }
    
        console.log("ğŸ“¸ ì„œë²„ì—ì„œ ë°›ì€ productData:", productData);  // API ì‘ë‹µ í™•ì¸
    
        // âœ… ê¸°ë³¸ ì´ë¯¸ì§€ URL
        const defaultImageUrl = "https://rahulindesign.websites.co.in/twenty-nineteen/img/defaults/product-default.png";
    
        // âœ… `image_url`ì´ ì—†ê±°ë‚˜ `undefined`ì´ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
        let imageUrl = productData.image_url && productData.image_url.trim() !== "" 
            ? productData.image_url 
            : defaultImageUrl;
    
        const productImage = document.getElementById("product-image");
        productImage.src = imageUrl;
        productImage.style.display = "block"; // í˜¹ì‹œë¼ë„ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ë³´ì´ê²Œ
    
        // âœ… ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ë³€ê²½
        productImage.onerror = function() {
            console.error("âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ëŒ€ì²´:", imageUrl);
            this.src = defaultImageUrl;
        };
    
        document.getElementById("product-name").innerText = productData.product_name || "ì •ë³´ ì—†ìŒ";
        document.getElementById("product-price").innerText = 
            productData.price ? productData.price.toLocaleString("ko-KR") : "ì •ë³´ ì—†ìŒ";
        document.getElementById("product-gender").innerText = productData.gender || "ì •ë³´ ì—†ìŒ";
        document.getElementById("product-category").innerText = productData.category || "ì •ë³´ ì—†ìŒ";
        document.getElementById("product-brand").innerText = productData.brand || "ì •ë³´ ì—†ìŒ";
        document.getElementById("product-review-info").innerText = 
            productData.review_count 
                ? `${productData.review_count}ê°œ (${productData.avg_rating ? productData.avg_rating.toFixed(1) + "ì " : "ì •ë³´ ì—†ìŒ"})`
                : "ì •ë³´ ì—†ìŒ";
    
        document.getElementById("product-info").style.display = "block";
    }

async function fetchBrandScore() {
        const productId = document.getElementById("product-id").value.trim();
        if (!productId) {
            console.warn("âš ï¸ ì œí’ˆ IDê°€ ì—†ìŠµë‹ˆë‹¤. ë¸Œëœë“œ ì ìˆ˜ ìš”ì²­ì„ ê±´ë„ˆëœë‹ˆë‹¤.");
            return;
        }
    
        console.log(`ğŸ“¡ ë¸Œëœë“œ ì ìˆ˜ ìš”ì²­: /api/brand-analysis-kang/${productId}`);
    
        try {
            const response = await fetch(`/api/brand-analysis-kang/${productId}`);
            if (!response.ok) {
                console.error("ğŸš¨ ë¸Œëœë“œ ì ìˆ˜ ìš”ì²­ ì‹¤íŒ¨! ìƒíƒœ ì½”ë“œ:", response.status);
                return;
            }
    
            const data = await response.json();
            console.log("ğŸ“Š [fetchBrandScore] API ì‘ë‹µ ë°ì´í„°:", data);
    
            if (!data || !data.overall_score) {
                console.warn("âš ï¸ ë¸Œëœë“œ ì ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
    
            // âœ… API ì‘ë‹µ ê°’ìœ¼ë¡œ ìµœì¢… ì—…ë°ì´íŠ¸
            updateBrandGauge(data.overall_score);
    
        } catch (error) {
            console.error("ğŸ”¥ [fetchBrandScore] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:", error);
        }
    }
        
            
    
async function fetchAnalysis() {
    const productId = document.getElementById("product-id").value.trim();
    if (!productId) {
        alert("âŒ ì œí’ˆ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    console.log(`ğŸ“¡ [fetchAnalysis] ìš”ì²­: /api/strength-weakness/${productId}`);

    try {
        const response = await fetch(`/api/strength-weakness/${productId}`);
        
        console.log(`ğŸ“¡ [fetchAnalysis] ì‘ë‹µ ìƒíƒœ ì½”ë“œ: ${response.status}`);
        
        if (!response.ok) {
            console.error("ğŸš¨ [fetchAnalysis] ì„œë²„ ì˜¤ë¥˜ ë°œìƒ! ìƒíƒœ ì½”ë“œ:", response.status);
            alert("âš ï¸ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            return;
        }
        
        const data = await response.json();
        console.log("ğŸ“¡ [fetchAnalysis] ì„œë²„ ì‘ë‹µ ë°ì´í„°:", JSON.stringify(data, null, 2));

        if (!data || Object.keys(data).length === 0) {
            alert("âš ï¸ í•´ë‹¹ ì œí’ˆì˜ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        
        // âœ… ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€
        updateGauge("overall-score-fill", "overall-score-eval", "overall-score-text", data.overall_score);
        displayResults(data);
        displayProductInfo(data.product);
        applyAutoFilters(data);

        // âœ… ìƒˆë¡œìš´ ê¸°ëŠ¥: ë¶„ì„ ìš”ì•½ ì¶”ê°€
        updateCommentBox(data);

        // âœ… ë¦¬ë·° íŠ¸ë Œë“œ ë°ì´í„° ì¶”ê°€ í˜¸ì¶œ (ê¸°ì¡´ ìœ ì§€)
        fetchReviewTrend(productId);

        // âœ… ê´€ë ¨ ë¦¬ë·° ë¶ˆëŸ¬ì˜¤ê¸° (ê¸°ì¡´ ìœ ì§€)
        fetchRelatedReviews(productId);

        // âœ… ì‚¬ì´ì¦ˆ ë¶„ì„ ì¶”ê°€ í˜¸ì¶œ (ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€)
        await fetchSizeAnalysis(productId);

    } catch (error) {
        console.error("ğŸ”¥ [fetchAnalysis] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:", error);
        alert("ğŸš¨ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ! ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    }
}    

function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: "smooth" // ë¶€ë“œëŸ½ê²Œ ì´ë™ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
            });
        }

        function openProductDetails(productId) {
            if (!productId) {
                alert("âŒ ì œí’ˆ IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
        
            // âœ… `index.html`ì—ì„œ í´ë¦­ ì‹œ `strength-weakness.html`ë¡œ ì´ë™ (ê³ ì •ëœ URL ë°˜ì˜)
            window.location.href = `http://15.152.242.221:8000/strength-weakness.html?product_id=${productId}`;
        }
        
        // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ `product_id`ê°€ ìˆìœ¼ë©´ ìë™ ê²€ìƒ‰ ì‹¤í–‰
        document.addEventListener("DOMContentLoaded", function () {
            console.log("ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ê·¸ë˜í”„ í™•ì¸");
        
            // ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ë¦¬ë·° íŠ¸ë Œë“œ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        
            // âœ… í•„í„° ê°’ ë³€ê²½ ì‹œ ìë™ ê²€ìƒ‰ ì‹¤í–‰ (ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰ ë°©ì§€)
            let filterChangeTriggered = false;
        
            function onFilterChange() {
                if (!filterChangeTriggered) return;
                fetchProductList();
            }
        
            document.getElementById("topic-select").addEventListener("change", onFilterChange);
            document.getElementById("category-select").addEventListener("change", onFilterChange);
            document.getElementById("gender-select").addEventListener("change", onFilterChange);
            document.getElementById("price-min").addEventListener("input", onFilterChange);
            document.getElementById("price-max").addEventListener("input", onFilterChange);
            document.getElementById("min-reviews").addEventListener("input", onFilterChange);
        
            // âœ… 0.5ì´ˆ í›„ë¶€í„° í•„í„° ë³€ê²½ ê°ì§€ í™œì„±í™” (ì´ˆê¸° ë¡œë“œ ë°©ì§€)
            setTimeout(() => { filterChangeTriggered = true; }, 500);
        
            // âœ… URLì—ì„œ `product_id`ê°€ ìˆìœ¼ë©´ `strength-weakness.html`ë¡œ ìë™ ì´ë™
            setTimeout(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get("product_id");
                if (productId) {
                    window.location.href = `http://15.152.242.221:8000/strength-weakness.html?product_id=${productId}`;
                }
            }, 1000);
            
            scrollToTop();
        });
        
        
 

function getQueryParam(param) {
    let params = new URLSearchParams(window.location.search);
    return params.get(param);
}
    
    window.onload = function() {
        let productId = getQueryParam("id");
        let productIdElement = document.getElementById("product-id-display");
        
        if (productId && productIdElement) {  // âœ… ìš”ì†Œê°€ ì¡´ì¬í•  ë•Œë§Œ ì‹¤í–‰
            productIdElement.innerText = "ì œí’ˆ ID: " + productId;
        }
    };

    window.onload = function() {
            let productId = getQueryParam("id");
            
            if (productId) {  
                document.getElementById("product-id").value = productId;  
                fetchAnalysis();  // ğŸ”¥ URLì—ì„œ ë°›ì€ IDë¡œ ìë™ ê²€ìƒ‰ ì‹¤í–‰
            }
        };

// í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€ ë° ìš”ì†Œ ìœ„ì¹˜ ì¡°ì • ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
// ìŠ¤í¬ë¡¤ ë° í™”ë©´ í¬ê¸° ë³€ê²½ ëª¨ë‘ ê°ì§€í•˜ëŠ” í•¨ìˆ˜

window.addEventListener('resize', adjustFilterPosition);

function adjustFilterPosition() {
  const filterBox = document.querySelector('.search-box');
  const brandEvaluation = document.querySelector('.product-search-card');
  
  if (window.innerWidth < 2000) {
    // í™”ë©´ì´ ì‘ì„ ë•Œ: ë¸Œëœë“œ ì¢…í•©í‰ê°€ ì•„ë˜ë¡œ í•„í„° ì´ë™
    if (filterBox && brandEvaluation) {
      filterBox.style.position = 'static';
      brandEvaluation.prepend(filterBox); // DOMì—ì„œ ìœ„ì¹˜ ì´ë™
    }
  } else {
    // í™”ë©´ì´ í´ ë•Œ: ì›ë˜ ìœ„ì¹˜ë¡œ ë³µì›
    if (filterBox) {
      filterBox.style.position = 'fixed';
      document.querySelector('.chart-card').appendChild(filterBox);
    }
  }
}

// ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', adjustFilterPosition);

/////////////////////////////////////////////////////////////////////////////
// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ì— ì—°ê²°


// ################################################################################
async function fetchRankings() {  
    try {
        const response = await fetch("/api/rankings");
        if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

        const data = await response.json();
        console.log("ğŸ“¢ API ì‘ë‹µ ë°ì´í„°:", data);

        // `undefined` ë°©ì§€ ì²˜ë¦¬
        const topBrands = data?.top_brands || [];
        const bottomBrands = data?.bottom_brands || [];
        const topProducts = data?.top_products || [];
        const bottomProducts = data?.bottom_products || [];

        console.log("âœ… topBrands:", topBrands);
        console.log("âœ… bottomBrands:", bottomBrands);
        console.log("âœ… topProducts:", topProducts);
        console.log("âœ… bottomProducts:", bottomProducts);

        const elements = {
            topBrands: document.getElementById("top-brands"),
            bottomBrands: document.getElementById("bottom-brands"),
            topProducts: document.getElementById("top-products"),
            bottomProducts: document.getElementById("bottom-products")
        };

        Object.entries(elements).forEach(([key, element]) => {
            if (!element) {
                console.error(`ğŸš¨ ${key} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ.`);
                return;
            }
        });

        // âœ… HTML ì—…ë°ì´íŠ¸ (í´ë¦­ ì´ë²¤íŠ¸ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‰½ê²Œ `data-*` ì†ì„± ì¶”ê°€)
        elements.topBrands.innerHTML = topBrands.length 
            ? topBrands.map((b, i) => 
                `<li class="ranking-item top brand-item" data-brand="${b.brand}">
                    ${i + 1}. ${b.brand} <strong>${b.overall_score}ì </strong>
                </li>`).join("")
            : "<li>ë°ì´í„° ì—†ìŒ</li>";

        elements.bottomBrands.innerHTML = bottomBrands.length 
            ? bottomBrands.map((b, i) => 
                `<li class="ranking-item low brand-item" data-brand="${b.brand}">
                    ${i + 1}. ${b.brand} <strong>${b.overall_score}ì </strong>
                </li>`).join("")
            : "<li>ë°ì´í„° ì—†ìŒ</li>";

        elements.topProducts.innerHTML = topProducts.length 
            ? topProducts.map((p, i) => 
                `<li class="ranking-item top product-item" data-product-id="${p.product_id}">
                    ${i + 1}. ${p.product_name} (${p.brand}) <strong>${p.overall_score}ì </strong>
                </li>`).join("")
            : "<li>ë°ì´í„° ì—†ìŒ</li>";

        elements.bottomProducts.innerHTML = bottomProducts.length 
            ? bottomProducts.map((p, i) => 
                `<li class="ranking-item low product-item" data-product-id="${p.product_id}">
                    ${i + 1}. ${p.product_name} (${p.brand}) <strong>${p.overall_score}ì </strong>
                </li>`).join("")
            : "<li>ë°ì´í„° ì—†ìŒ</li>";

        console.log("âœ… `.ranking-item` ê°œìˆ˜:", document.querySelectorAll('.ranking-item').length);

        // âœ… âœ… âœ… í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ âœ… âœ… âœ…
        addBrandRankingClickEvent();
        addProductRankingClickEvent();
    } catch (error) {
        console.error("ğŸ”¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
    }
}


// âœ… í˜ì´ì§€ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
document.addEventListener("DOMContentLoaded", () => {
    fetchRankings();
});

// âœ… ë¸Œëœë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜
function addBrandRankingClickEvent() {
    console.log("ğŸ“¡ ë¸Œëœë“œ ìˆœìœ„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì¤‘...");

    document.querySelectorAll("#top-brands li, #bottom-brands li").forEach(brandItem => {
        brandItem.addEventListener("click", function () {
            const brandText = this.innerText.trim();
            console.log(`ğŸ“¡ í´ë¦­í•œ ë¸Œëœë“œ í…ìŠ¤íŠ¸: ${brandText}`);

            // âœ… ë¸Œëœë“œëª… ì •í™•íˆ ì¶”ì¶œ (ì •ê·œì‹ ë³´ì™„)
            const brandNameMatch = brandText.match(/^\d+\.\s*([^0-9]+?)\s*\d+(\.\d+)?ì $/);
            let brandName = brandNameMatch ? brandNameMatch[1].trim() : null;

            // âœ… ì •ê·œì‹ì—ì„œ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ì ì¸ ê³µë°± ê¸°ì¤€ ë¶„ë¦¬
            if (!brandName) {
                const splitText = brandText.split(" ");
                if (splitText.length > 1) {
                    brandName = splitText.slice(1, -1).join(" ").trim();
                }
            }

            if (brandName) {
                console.log(`ğŸ“¡ ë¸Œëœë“œ ìˆœìœ„ì—ì„œ ì„ íƒë¨: ${brandName}`);

                const brandInput = document.getElementById("brand-name");
                if (brandInput) {
                    brandInput.value = brandName; // ğŸ” ê²€ìƒ‰ì°½ì— ë¸Œëœë“œ ì…ë ¥

                    // âœ… ê²€ìƒ‰ì°½ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
                    brandInput.scrollIntoView({ behavior: "smooth", block: "center" });

                    fetchBrandAnalysis(); // ğŸ”„ ë¸Œëœë“œ ë¶„ì„ ì‹¤í–‰
                } else {
                    console.error("âŒ 'brand-name' ì…ë ¥ í•„ë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            } else {
                console.error("âŒ ë¸Œëœë“œëª… ì¶”ì¶œ ì‹¤íŒ¨. ì •ê·œì‹ í™•ì¸ í•„ìš”!");
            }
        });
    });

    console.log("âœ… ë¸Œëœë“œ ìˆœìœ„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ!");
}

// âœ… ì œí’ˆ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜
function addProductRankingClickEvent() {
    console.log("ğŸ“¡ ì œí’ˆ ìˆœìœ„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì¤‘...");

    document.querySelectorAll("#top-products li, #bottom-products li").forEach(productItem => {
        productItem.addEventListener("click", function () {
            const productId = this.getAttribute("data-product-id");
            if (productId) {
                console.log(`ğŸ“¡ ì œí’ˆ ìˆœìœ„ì—ì„œ ì„ íƒë¨: ${productId}`);
                redirectToStrengthWeakness(productId);
            } else {
                console.error("âŒ ì œí’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        });
    });

    console.log("âœ… ì œí’ˆ ìˆœìœ„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ!");
}
// âœ… ë¸Œëœë“œ/ì œí’ˆ ìˆœìœ„ ì „í™˜
function showRanking(type) {
    document.getElementById("brand-ranking").classList.add("hidden");
    document.getElementById("product-ranking").classList.add("hidden");

    // âœ… ì„ íƒí•œ ì„¹ì…˜ ë³´ì´ê¸°
    document.getElementById(`${type}-ranking`).classList.remove("hidden");

    // âœ… ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
    document.querySelectorAll(".rank-toggle-btn").forEach(btn => btn.classList.remove("active"));
    document.querySelector(`.rank-toggle-btn[onclick="showRanking('${type}')"]`).classList.add("active");
}
    </script>

</div> 

{% endblock %}
</html>