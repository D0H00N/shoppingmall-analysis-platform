<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="https://cdn-icons-png.freepik.com/512/16866/16866002.png" type="image/png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}대시보드{% endblock %}</title>
    <style>
        @keyframes moveBackground {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: url("https://preview.redd.it/abstract-colorful-wallpaper-7680x2160-v0-9w5i20l6m88d1.jpeg?auto=webp&s=8b7ebdedda1d54af4e665db2935a42b17e0a80e9") no-repeat center center fixed;
            background-size: cover;
            animation: moveBackground 670s linear infinite;
            transform-origin: center top;  /* 🔥 20초 동안 부드럽게 이동 */
        }

        
        /* ✅ 헤더 고정 */
        #header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background-color: #fafafae8;
            color: rgb(58, 58, 58);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
            white-space: nowrap;
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);
        }
        .header-expand {
            position: fixed;  /* ✅ fixed로 변경하여 항상 화면에 고정 */ /* ✅ 항상 최상단에 유지 */
            top: 70px;
            left: 0;
            width: 100%;
            background: rgba(250, 250, 250, 0.95);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            max-height: none; /* ✅ 높이 증가 */
            transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out;
            opacity: 1; /* ✅ 기본적으로 보이게 설정 */
            z-index: 3000; /* ✅ 다른 요소보다 무조건 위에 오도록 설정 */
        }
        
        
        
        .header-content {
            padding: 20px;
            display: none;  /* 기본적으로 숨김 */
            text-align: center;
        }
    
        /* ✅ 확장 시 애니메이션 */
        .expand-active {
            max-height: 10-00px;
            opacity: 1;
        }
        .closing {
            animation: slideUp 0.3s ease-in-out;
        }
        /* ✅ 로고 */
        #header .logo img {
            height: 45px;
        }

        /* ✅ 네비게이션 */
        #header nav {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-grow: 1;
            justify-content: flex-start; /* 🔥 버튼 중앙 정렬 */
            margin-left: 28px; /* 🔥 로고와 간격 확보 */
        }
        
        #header nav .menu {
            display: block; /* 🔥 강제 표시 */
            font-weight: bold;
            cursor: pointer;
            color: black; /* 🔥 글자색 변경 */
            transition: 0.3s;
        }
        #header nav .menu:hover {
            background-color: #ddd;
        }

        /* ✅ 검색창 스타일 */
        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
            justify-content: flex-end;  /* 🔥 기존 center → flex-start */
            margin-right: 85px;
        }

        #header input {
            width: 392px; /* 기존 280px * 1.4 = 392px */
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            background-color: #4d4d4d;
            color: white;
            font-size: 14px;
            outline: none;
        }
        /* ✅ 검색 버튼 */
        .search-btn {
            background: #5a5a5a;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .credit-cost {
            font-size: 12px;
            color: #ccc;
            font-weight: normal;
        }
        .search-btn:hover {
            background: #444;
        }

        /* ✅ 우측 고정 박스 (뒤로가기 & 검색 기록) */
        #side-panel {
            position: fixed;
            right: 8px;
            top: 18%;
            width: 120px; /* 기존 101px에서 약간 넓게 조정 */
            background-color: #fafafae8;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            z-index: 1000;
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);
        }
        .current-mall {
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .mall-name {
            color: #8a4af3; /* 보라색으로 강조 */
        }
        .side-button:hover {
            background-color: #999;
        }
        .side-button {
            background-color: #bbb;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 10px;
        }

        /* ✅ 뒤로가기 버튼 */
        #back-box {
            background-color: #5a5a5a;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 10px;
        }
        #back-box:hover {
            background-color: #999;
        }

        /* ✅ 검색 기록 */
        #search-history {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px; /* 이미지 간 간격 증가 */
        }

        .history-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        /* ✅ 검색 기록 이미지 크기 확대 */
        .search-item {
            width: 100px; /* 기존 88px에서 더 크게 */
            height: 100px;
            border-radius: 10px; /* 더 부드러운 모서리 */
            cursor: pointer;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            object-fit: cover;
            border: 1px solid #ddd; /* 테두리 추가로 깔끔한 느낌 */
        }
        .search-item:hover {
            transform: scale(1.1); /* 호버 시 더 크게 확대 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* 호버 시 그림자 효과 추가 */
        }
        /* ✅ 컨텐츠 */
        #content {
            margin-top: 80px; /* ✅ 헤더 높이(70px)보다 살짝 여유 */
            padding: 20px;
            width: 90%;
            min-height: 100vh;
        }

        /* 슬라이드 효과 기본 설정 */
        .page-transition {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: white;  /* 🔥 배경을 유지해서 확실한 효과 */
            z-index: 9999;
            top: 0;
            left: 0;
            transform: translateX(0);
            opacity: 1;
            transition: transform 1.2s ease-in-out, opacity 1s ease-in-out; /* ✅ 더 부드럽게 */
        }
        
        /* ✅ 왼쪽으로 이동하는 효과 */
        .slide-out-left {
            transform: translateX(-100%);
            opacity: 0;  /* 🔥 점점 사라지는 효과 */
        }
        
        /* ✅ 오른쪽으로 이동하는 효과 */
        .slide-out-right {
            transform: translateX(100%);
            opacity: 0;  /* 🔥 점점 사라지는 효과 */
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(10px); /* 🔥 블러 효과 */
            background: rgba(255, 255, 255, 0.43); /* 반투명 배경 */
            z-index: 10000; /* 🔥 최상단 배치 */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        
        /* ✅ "분석 중..." 텍스트 스타일 */
        .loading-text {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            animation: loadingMove 1.5s infinite alternate ease-in-out;
        }
        
        /* ✅ "분석 중..."이 위아래로 살짝 움직이는 효과 */
        @keyframes loadingMove {
            0% {
                transform: translateY(-5px);
            }
            100% {
                transform: translateY(5px);
            }
        }
        
        /* ✅ 페이지 로드 후 블러 효과 제거 */
        .fade-out {
            opacity: 0;
            pointer-events: none; /* 마우스 클릭 방지 해제 */
        }

        .logo-container {
            display: flex;
            align-items: center;
            text-decoration: none; /* 밑줄 제거 */
            gap: 10px; /* 아이콘과 텍스트 사이 여백 */
        }
        
        .logo-container img {
            height: 40px; /* 아이콘 크기 조정 */
        }
        
        .logo-container span {
            font-size: 20px;
            font-weight: bold;
            color: black; /* 글자색 */
        }
        .footer-credit {
            position: fixed;
            bottom: 5px;
            right: 10px;
            font-size: 15px;
            color: #ffffff;
        }

        .team-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .team-member {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
            width: auto; /* ✅ 내용에 따라 자동 조절 */
            max-width: 350px; /* ✅ 너무 넓어지지 않도록 제한 */
            min-width: 280px; /* ✅ 최소 크기 지정 */
            flex: 1; /* ✅ 모든 박스가 균등한 크기로 조절 */
        }
        
        .team-member img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
        }
        .team-member .info {
            text-align: left;
        }
        
        .team-member .info h4 {
            margin: 0 0 5px;
        }
        
        .team-member .info a {
            text-decoration: none;
            color: #007BFF;
            font-weight: bold;
        }
        
        .team-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center; /* ✅ 가운데 정렬 */
            align-items: stretch; /* ✅ 모든 박스 높이 균일하게 조정 */
            max-width: 800px; /* ✅ 내용이 너무 퍼지지 않도록 */
            margin: 0 auto; /* ✅ 전체 중앙 정렬 */
        }
        
        @media screen and (max-width: 768px) {
            .team-grid {
                grid-template-columns: repeat(2, 1fr); /* ✅ 작은 화면에서도 2x2 유지 */
            }
        }

        .model-grid {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .model-card {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
            width: 40%;
            max-width: 380px;
        }
        
        .model-card img {
            width: 80px;
            height: 80px;
            margin-right: 15px;
        }
        
        .model-card .info {
            text-align: left;
        }
        
        .model-card .info h4 {
            margin: 0 0 5px;
            font-size: 18px;
        }
        
        .model-card .info p {
            margin: 2px 0;
            font-size: 14px;
        }

        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0.5; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* ✅ 창 올라갈 때 애니메이션 */
        @keyframes slideUp {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-10px); opacity: 0.5; }
        }
        /* ✅ 알림 아이콘 컨테이너 */
        .notification-container {
            position: relative;
            margin-left: 10px;  /* 🔥 검색 버튼과 간격 */
            cursor: pointer;
        }

        /* ✅ 알림 아이콘 스타일 */
        .notification-icon {
            font-size: 22px;
            position: relative;
            color: black;
            transition: 0.3s;
        }

        .notification-icon:hover {
            color: red; /* 🔥 알림 아이콘 호버 시 강조 */
        }

        /* ✅ 알림 개수 배지 (빨간색 원) */
        .badge {
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 4px 7px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: -5px;
            right: -10px;
            display: none;
        }

        /* ✅ 알림 리스트 드롭다운 */
        .notification-dropdown {
            display: none;
            position: absolute;
            top: 30px;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            width: 260px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            border-radius: 8px;
        }

        .notification-dropdown ul {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .notification-dropdown ul li {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            cursor: pointer;
        }

        .notification-dropdown ul li:hover {
            background-color: #f5f5f5;
        }

        .notification-dropdown ul li:last-child {
            border-bottom: none;
        }

        .notification-dropdown button {
            width: 100%;
            padding: 8px;
            background: #5a5a5a;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
        }

        .notification-dropdown button:hover {
            background: #444;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 280px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            max-height: 200px; /* 최대 높이를 5개 항목에 맞게 설정 */
            overflow-y: auto;
            display: none;
        }
        
        .search-suggestions div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* 긴 텍스트는 ...으로 표시 */
        }
        
        .search-suggestions div:hover {
            background-color: #f5f5f5;
        }
        
        .search-suggestions div:last-child {
            border-bottom: none;
        }

        #header input {
            width: 392px; /* 기존 280px * 1.4 = 392px */
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            background-color: #4d4d4d;
            color: white;
            font-size: 14px;
            outline: none;
        }
        
        /* 스위치 스타일 */
        .search-switch {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 10px;
        }
        
        .switch-label {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #a676f1;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* 분석 버튼과 00credit 스타일 */
        .search-btn-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .credit-text {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }
        
        /* 로그인/회원가입 버튼 스타일 */
        .auth-btn {
            background: #666; /* 회색 톤으로 변경 */
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-left: 10px;
        }
        
        .auth-btn:hover {
            background: #555; /* 조금 더 어두운 회색 */
        }
    </style>    
</head>
<body>

    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-text">📊 분석 중..</div>
    </div>

    <!-- ✅ 헤더 -->
    <div id="header">
        <div class="logo">
            <a href="http://15.152.242.221:8000/dashboard/index/" class="logo-container">
                <img src="https://cdn-icons-png.freepik.com/512/16866/16866002.png" alt="BossMonitor Logo">
                <span>BossMonitor</span>
            </a>
        </div>
    
        <nav>
            <div class="menu" onclick="toggleSection('performance-content', this)">
                모델 성능 <span class="arrow">▼</span>
            </div>
            <div class="menu" onclick="toggleSection('team-content', this)">
                팀 멤버 <span class="arrow">▼</span>
            </div>
        </nav>
    
        <div class="search-container">
            <!-- 스위치 -->
            <div class="search-switch">
                <span class="switch-label">쇼핑몰</span>
                <label class="switch">
                    <input type="checkbox" id="search-mode-switch">
                    <span class="slider round"></span>
                </label>
                <span class="switch-label">제품</span>
            </div>
    
            <!-- 검색창 -->
            <div style="position: relative;">
                <input type="text" id="header-search-id" placeholder="제품 ID 또는 제품명 입력">
                <div id="search-suggestions" class="search-suggestions"></div>
            </div>
    
            <!-- 분석 버튼 (크레딧 포함) -->
            <button class="search-btn" onclick="searchFromHeader()">
                분석 <span class="credit-cost">💰 100</span>
            </button>
    
            <!-- 로그인/회원가입 버튼 -->
            <button class="auth-btn">로그인/회원가입</button>
        </div>
    
        <div class="footer-credit">
            made by 일조(一助)
        </div>
    </div>
    
    <!-- ✅ 확장 컨텐츠 (헤더 밖에 존재) -->
    <div id="header-expand" class="header-expand">
        <div id="performance-content" class="header-content">
            <h3>📊 모델 성능</h3>
        
            <div class="model-grid">
                <!-- ✅ 토픽 분류 모델 -->
                <div class="model-card">
                    <img src="https://cdn-icons-png.freepik.com/512/2980/2980560.png" alt="BERT" class="model-img">
                    <div class="info">
                        <h4>KLUE-BERT (토픽 분류 모델)</h4>
                        <p><strong>불용어처리 + 키워드 사전을 통한 라벨링 데이터로 파인 튜닝</strong></p>
                        <p><strong>Test Acc:</strong> 0.9594</p>
                        <p><strong>Test F1:</strong> 0.9920</p>
                    </div>
                </div>
        
                <!-- ✅ 감성 분석 모델 -->
                <div class="model-card">
                    <img src="https://cdn-icons-png.freepik.com/512/2980/2980560.png" alt="Sentiment Model" class="model-img">
                    <div class="info">
                        <h4>KoBERT (감성 분석 모델)</h4>
                        <p><strong>Google Cloud NLP + ChatGPT 기반 라벨링 데이터로 파인튜닝</strong></p>
                        <p><strong>Test Acc:</strong> 0.93</p>
                        <p><strong>Test F1:</strong> 0.93</p>
                        <p><strong>부정 정확도:</strong> 97%</p>
                        <p><strong>중립 정확도:</strong> 89% (가장 낮음)</p>
                    </div>
                </div>
            </div>
        </div>
        
    
        <div id="team-content" class="header-content">
            <h3>👥 팀 멤버</h3>
            <p><strong>팀 이름:</strong> 일조(一助) [2025년 1월 23일 ~ 2025년 3월 28일]</p>
        
            <div class="team-grid">
                <div class="team-member">
                    <img src="https://png.pngtree.com/png-vector/20220424/ourmid/pngtree-retro-gentleman-avatar-portrait-profile-picture-icon-avatar-beard-portrait-vector-png-image_27826114.png" alt="이도훈">
                    <div class="info">
                        <h4>이도훈</h4>
                        <p><strong>역할:</strong> 리더, 데이터 분석, 모델 학습, 웹 개발</p>
                        <p><strong>이메일:</strong> datahoons@gmail.com</p>
                        <p><strong>목표:</strong> 데이터 사이언티스트,엔지니어</p>
                        <a href="https://github.com/D0H00N" target="_blank" rel="noopener noreferrer">도훈의 GitHub</a>
                    </div>
                </div>

                <div class="team-member">
                    <img src="https://png.pngtree.com/png-vector/20220424/ourmid/pngtree-retro-gentleman-avatar-portrait-profile-picture-icon-hipster-profile-gentleman-vector-png-image_27826122.png" alt="강대웅">
                    <div class="info">
                        <h4>강대웅</h4>
                        <p><strong>역할:</strong> 개발환경 구축, 모델 학습, 웹 개발</p>
                        <p><strong>이메일:</strong> daewonng12@gmail.com</p>
                        <p><strong>목표:</strong> 데이터 엔지니어</p>
                        <a href="https://github.com/daewoong12" target="_blank" rel="noopener noreferrer">대웅의 GitHub</a>
                    </div>
                </div>
        
                <div class="team-member">
                    <img src="https://static.vecteezy.com/system/resources/previews/019/896/008/non_2x/male-user-avatar-icon-in-flat-design-style-person-signs-illustration-png.png" alt="강민성">
                    <div class="info">
                        <h4>강민성</h4>
                        <p><strong>역할:</strong> 산출물 관리, 데이터 크롤링, 모델 학습, 웹 개발</p>
                        <p><strong>이메일:</strong> kangms3158@gmail.com</p>
                        <p><strong>목표:</strong> 데이터 사이언티스트</p>
                        <a href="https://github.com/mansung1" target="_blank" rel="noopener noreferrer">민성의 GitHub</a>
                    </div>
                </div>
        
                <div class="team-member">
                    <img src="https://cdn1.iconfinder.com/data/icons/avatars-1-5/136/87-512.png" alt="김연주">
                    <div class="info">
                        <h4>김연주</h4>
                        <p><strong>역할:</strong> WBS관리, 데이터 분석, 모델 학습, 웹 개발</p>
                        <p><strong>이메일:</strong> yjj8790@gmail.com</p>
                        <p><strong>목표:</strong> 데이터 사이언티스트</p>
                        <a href="https://github.com/kim-yeonjoo" target="_blank" rel="noopener noreferrer">연주의 GitHub</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <!-- ✅ 우측 고정 패널 (뒤로가기 & 검색 기록) -->
    <div id="side-panel">
        <!-- 현재 분석중인 쇼핑몰 표시 -->
        <div class="current-mall">
            쇼핑몰: <span class="mall-name"> 무신사</span>
        </div>
    
        <div class="side-button" onclick="window.location.href='http://15.152.242.221:8000/dashboard/index/'">
            메인화면
        </div>
        <div class="side-button" onclick="history.back();">뒤로가기</div>
        <div class="history-title">검색 기록</div>
        <div id="search-history"></div>
    </div>

    <!-- ✅ 컨텐츠 -->
    <div id="content">
        {% block content %}
        <h2>페이지를 불러오는 중...</h2>
        {% endblock %}
    </div>


    <script>
        let searchHistory = JSON.parse(localStorage.getItem("searchHistory")) || [];
    
        function searchFromHeader() {
            let productId = document.getElementById("header-search-id").value.trim();
            if (!productId) {
                alert("❌ 제품 ID를 입력하세요.");
                return;
            }
    
            console.log(`🔍 [searchFromHeader] 검색 요청: ${productId}`);
    
            // ✅ 검색 기록 추가 후 저장
            storeSearchedProduct({ product_id: productId });
    
            // ✅ 현재 페이지의 URL을 검색 ID로 변경 후 새로고침
            window.location.href = `/strength-weakness.html?product_id=${productId}`;
        }
    
        function storeSearchedProduct(productData) {
            if (!productData || !productData.product_id) return;
        
            let imageUrl = productData.image_url;
            if (!imageUrl || imageUrl.includes("undefined") || imageUrl.includes("null") || imageUrl === "") {
                console.warn(`🚨 [storeSearchedProduct] 이미지 URL이 없음! 기본값 적용`);
                imageUrl = "https://rahulindesign.websites.co.in/twenty-nineteen/img/defaults/product-default.png";
            }
        
            console.log(`🖼️ [storeSearchedProduct] 저장된 이미지 URL: ${imageUrl}`);
        
            let productInfo = {
                id: productData.product_id,
                name: productData.product_name || "알 수 없음",
                img: imageUrl
            };
        
            // 중복 제거 후 검색 기록 추가
            searchHistory = searchHistory.filter(item => item.id !== productData.product_id);
            searchHistory.unshift(productInfo);
            if (searchHistory.length > 6) searchHistory.pop(); // 최대 7개로 변경
        
            localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
            console.log(`📌 [storeSearchedProduct] 저장된 검색 기록:`, searchHistory);
        
            updateSearchHistory();
        }
    
        function updateSearchHistory() { 
            let historyBox = document.getElementById("search-history");
        
            console.log(`📌 [updateSearchHistory] 현재 검색 기록:`, searchHistory);
        
            historyBox.innerHTML = searchHistory.map((item, index) => {
                console.log(`🖼️ [updateSearchHistory] 이미지 URL 적용: ${item.img}`);
        
                return `
                    <img src="${item.img}" class="search-item fade-in" 
                        onerror="handleImageError(this, '${item.id}')"
                        onclick="searchByHistory('${item.id}')"
                        id="search-item-${index}">
                `;
            }).join("");
        
            console.log(`📌 [updateSearchHistory] 업데이트 완료`);
        }

        function removeSearchItem(index) {
            let item = document.getElementById(`search-item-${index}`);
            if (item) {
                item.classList.add("fade-out");
                setTimeout(() => {
                    searchHistory.splice(index, 1);
                    localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
                    updateSearchHistory();
                }, 500); // 애니메이션 지속 시간 후 삭제
            }
        }
    
        function handleImageError(imgElement, productId) {
            console.warn(`🚨 [handleImageError] 이미지 로드 실패, 기본 이미지로 변경 → 제품 ID: ${productId}`);
            imgElement.src = "https://rahulindesign.websites.co.in/twenty-nineteen/img/defaults/product-default.png";
        }
    
        function searchByHistory(productId) {
            // 스위치 상태와 관계없이 제품 검색 로직 실행
            document.getElementById("header-search-id").value = productId;
            
            // 제품 ID를 기반으로 상세 페이지로 바로 이동
            console.log(`🔍 [searchByHistory] 검색 기록에서 제품 클릭: ${productId}`);
            storeSearchedProduct({ product_id: productId });
            window.location.href = `/strength-weakness.html?product_id=${productId}`;
        }
    
        async function fetchAnalysis() {
            const productId = document.getElementById("product-id").value.trim();
            if (!productId) {
                alert("❌ 제품 ID를 입력하세요.");
                return;
            }
    
            console.log(`📡 [fetchAnalysis] 요청: /api/strength-weakness/${productId}`);
    
            try {
                const response = await fetch(`/api/strength-weakness/${productId}`);
    
                console.log(`📡 [fetchAnalysis] 응답 상태 코드: ${response.status}`);
    
                if (!response.ok) {
                    console.error("🚨 [fetchAnalysis] 서버 오류 발생! 상태 코드:", response.status);
                    alert("⚠️ 서버에서 데이터를 불러오지 못했습니다. 다시 시도해주세요.");
                    return;
                }
    
                const data = await response.json();
                console.log("📡 [fetchAnalysis] API 응답 데이터:", JSON.stringify(data, null, 2));
    
                if (!data || Object.keys(data).length === 0) {
                    alert("⚠️ 해당 제품의 분석 데이터가 없습니다.");
                    return;
                }
    
                console.log("📡 [fetchAnalysis] API 응답 데이터 (product):", data.product);
    
                // ✅ **이미지 URL이 사라지는 버그 수정**
                let fixedProductData = {
                    product_id: data.product.product_id || productId,  // 제품 ID
                    product_name: data.product.product_name || "알 수 없음",  // 제품명
                    image_url: data.product.image_url || "",  // **이미지 URL 그대로 유지**
                };
    
                storeSearchedProduct(fixedProductData);  // ✅ 강제 적용!
    
                // ✅ 기존 기능 유지
                updateGauge("overall-score-fill", "overall-score-eval", "overall-score-text", data.overall_score);
                displayResults(data);
                displayProductInfo(data.product);
                applyAutoFilters(data);
    
                // ✅ 새로운 기능: 분석 요약 추가
                updateCommentBox(data);
    
                // ✅ 리뷰 트렌드 데이터 추가 호출 (기존 유지)
                fetchReviewTrend(productId);
    
                // ✅ 관련 리뷰 불러오기 (기존 유지)
                fetchRelatedReviews(productId);
    
                // ✅ 사이즈 분석 추가 호출 (새로운 기능 추가)
                await fetchSizeAnalysis(productId);
    
            } catch (error) {
                console.error("🔥 [fetchAnalysis] 네트워크 오류:", error);
                alert("🚨 네트워크 오류 발생! 인터넷 연결을 확인하거나 다시 시도해주세요.");
            }
        }
    
        window.onload = function () {
            updateSearchHistory();
            let productId = getQueryParam("id");
        
            if (productId) {
                document.getElementById("product-id").value = productId;
        
                // ✅ 이미 가져온 데이터가 있으면 캐시된 데이터를 활용
                if (sessionStorage.getItem(`product_${productId}`)) {
                    console.log("✅ 캐시된 데이터 사용");
                    displayResults(JSON.parse(sessionStorage.getItem(`product_${productId}`)));
                } else {
                    fetchAnalysis();  // 🚀 서버 요청 (필요한 경우에만)
                }
            }
        };
        

        let currentActive = null;

        
        
        document.addEventListener("DOMContentLoaded", function () {
            const switchInput = document.getElementById("search-mode-switch");
            const searchInput = document.getElementById("header-search-id");
            const creditCost = document.querySelector(".credit-cost");
            const currentPage = window.location.pathname;
        
            function updateSearchMode() {
                if (switchInput.checked) {
                    searchInput.placeholder = "제품 ID 또는 제품명 입력";
                    creditCost.innerHTML = "💰 100";
                } else {
                    searchInput.placeholder = "쇼핑몰의 주소를 입력";
                    creditCost.innerHTML = "💰 500";
                }
            }
        
            if (currentPage.includes("index.html")) {
                switchInput.checked = false;
            } else if (currentPage.includes("strength-weakness.html")) {
                switchInput.checked = true;
            }
        
            updateSearchMode();
            switchInput.addEventListener("change", updateSearchMode);
        
            updateSearchHistory();
            let productId = getQueryParam("id");
        
            if (productId) {
                document.getElementById("header-search-id").value = productId;
                if (sessionStorage.getItem(`product_${productId}`)) {
                    console.log("✅ 캐시된 데이터 사용");
                    displayResults(JSON.parse(sessionStorage.getItem(`product_${productId}`)));
                } else {
                    fetchAnalysis();
                }
            }
        });
        
        function transitionToPage(url, direction) {
            let transitionDiv = document.createElement("div");
            transitionDiv.classList.add("page-transition");
        
            if (direction === "right") {
                transitionDiv.classList.add("slide-out-right"); // 👉 오른쪽으로 이동
            } else {
                transitionDiv.classList.add("slide-out-left"); // 👉 왼쪽으로 이동
            }
        
            document.body.appendChild(transitionDiv);
        
            setTimeout(() => {
                window.location.href = url;
            }, 2500);  // 🔥 1.2초 후 페이지 이동 (이전보다 느리게)
        }
        
        // ✅ 메인 페이지 → 강약점 페이지 (오른쪽 이동)
        function goToStrengthWeakness(productId) {
            transitionToPage(`/strength-weakness.html?product_id=${productId}`, "right");
        }
        
        // ✅ 강약점 페이지 → 메인 페이지 (왼쪽 이동)
        function goToMain() {
            transitionToPage(`/index.html`, "left");
        }

        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(() => {
                document.getElementById("loading-overlay").classList.add("fade-out");
            }, 2000); // ⏳ 1.2초 후 로딩 화면 제거 (페이지 로딩 시간에 따라 조절 가능)
        });
        
        
        function toggleSection(contentId, button) {
            let expandBox = document.getElementById("header-expand");
            let contentBox = document.getElementById(contentId);
            let arrow = button.querySelector(".arrow");
        
            if (currentActive === contentId) {
                // 🔥 창을 닫을 때 애니메이션 적용
                expandBox.classList.add("closing"); 
                arrow.textContent = "▼"; // 아이콘 변경
                setTimeout(() => {
                    expandBox.classList.remove("expand-active", "closing"); // 닫기
                    contentBox.style.display = "none";
                }, 300);
                currentActive = null;
            } else {
                document.querySelectorAll(".header-content").forEach(el => el.style.display = "none");
                document.querySelectorAll(".arrow").forEach(el => el.textContent = "▼");
        
                contentBox.style.display = "block";
                arrow.textContent = "▲"; // 아이콘 변경
                setTimeout(() => {
                    expandBox.classList.add("expand-active");
                }, 50);
        
                currentActive = contentId;
            }
        }
        

        document.addEventListener("click", function(event) {
            let expandBox = document.getElementById("header-expand");
            let header = document.getElementById("header");
        
            if (currentActive && !expandBox.contains(event.target) && !header.contains(event.target)) {
                expandBox.classList.add("closing"); 
                
                // 🔥 모든 메뉴 화살표 ▼로 변경
                document.querySelectorAll(".arrow").forEach(el => el.textContent = "▼");
        
                setTimeout(() => {
                    expandBox.classList.remove("expand-active", "closing");
                    document.querySelectorAll(".header-content").forEach(el => el.style.display = "none");
                }, 300);
                currentActive = null;
            }
        });
        async function fetchSuggestions(query) {
            const suggestionsBox = document.getElementById("search-suggestions");
            suggestionsBox.innerHTML = ""; // 기존 추천 목록 초기화
            suggestionsBox.style.display = "none"; // 기본적으로 숨김
        
            if (!query || query.length < 2) return; // 2글자 미만이면 추천 안 함
        
            try {
                const response = await fetch(`/api/suggest-products/${encodeURIComponent(query)}`);
                const suggestions = await response.json();
        
                if (suggestions.length > 0) {
                    // 최대 5개로 제한
                    const limitedSuggestions = suggestions.slice(0, 5);
                    suggestionsBox.style.display = "block"; // 추천 목록 표시
                    limitedSuggestions.forEach(item => {
                        const suggestionItem = document.createElement("div");
                        // 상품명이 20자 이상이면 자르고 "..." 추가
                        const displayName = item.product_name.length > 20 
                            ? item.product_name.substring(0, 20) + "..." 
                            : item.product_name;
                        suggestionItem.textContent = displayName;
                        suggestionItem.onclick = () => {
                            document.getElementById("header-search-id").value = item.product_name; // 실제 값은 전체 상품명 사용
                            suggestionsBox.style.display = "none"; // 선택 시 추천 목록 숨김
                            searchFromHeader(); // 검색 실행
                        };
                        suggestionsBox.appendChild(suggestionItem);
                    });
                }
            } catch (error) {
                console.error("🔥 [fetchSuggestions] 추천 목록 가져오기 실패:", error);
            }
        }
        
        // 검색창 입력 시 추천 목록 업데이트
        document.getElementById("header-search-id").addEventListener("input", function () {
            const query = this.value.trim();
            fetchSuggestions(query);
        });
        
        // 추천 목록 외부 클릭 시 숨김
        document.addEventListener("click", function (event) {
            const suggestionsBox = document.getElementById("search-suggestions");
            const searchInput = document.getElementById("header-search-id");
            if (!searchInput.contains(event.target) && !suggestionsBox.contains(event.target)) {
                suggestionsBox.style.display = "none";
            }
        });

        async function searchFromHeader() {
            const input = document.getElementById("header-search-id").value.trim();
            const switchInput = document.getElementById("search-mode-switch");
            const searchMode = switchInput.checked ? "product" : "mall";
        
            if (!input) {
                alert("❌ 검색어를 입력하세요.");
                return;
            }
        
            console.log(`🔍 [searchFromHeader] 검색 요청: ${input}, 모드: ${searchMode}`);
        
            if (searchMode === "product") {
                if (/^\d+$/.test(input)) {
                    storeSearchedProduct({ product_id: input });
                    window.location.href = `/strength-weakness.html?product_id=${input}`;
                    return;
                }
        
                try {
                    const response = await fetch(`/api/get-product-id/${encodeURIComponent(input)}`);
                    if (!response.ok) {
                        alert("⚠️ 해당 제품이 존재하지 않습니다.");
                        return;
                    }
        
                    const data = await response.json();
                    const productId = data.product_id;
        
                    storeSearchedProduct({ product_id: productId });
                    window.location.href = `/strength-weakness.html?product_id=${productId}`;
                } catch (error) {
                    console.error("🔥 [searchFromHeader] 네트워크 오류:", error);
                    alert("🚨 서버 오류 발생! 다시 시도해주세요.");
                }
            } else {
                try {
                    const response = await fetch(`/api/search-mall/${encodeURIComponent(input)}`);
                    if (!response.ok) {
                        alert("⚠️ 해당 쇼핑몰이 존재하지 않습니다.");
                        return;
                    }
        
                    const data = await response.json();
                    console.log(`📡 [searchFromHeader] 쇼핑몰 검색 결과:`, data);
                    window.location.href = `/mall-search.html?mall_name=${encodeURIComponent(input)}`;
                } catch (error) {
                    console.error("🔥 [searchFromHeader] 쇼핑몰 검색 네트워크 오류:", error);
                    alert("🚨 서버 오류 발생! 다시 시도해주세요.");
                }
            }
        }
        // ##############################################################################
    //     // ✅ 전역 변수 중복 선언 방지
    // if (typeof window.socket === "undefined") {
    //     window.socket = null;
    // }

    // if (typeof window.lastReceivedReviewId === "undefined") {
    //     window.lastReceivedReviewId = null;
    // }

    // function connectWebSocket() {
    //     if (window.socket && window.socket.readyState !== WebSocket.CLOSED) {
    //         console.log("⚠️ WebSocket이 이미 실행 중입니다. 중복 실행 방지");
    //         return;
    //     }

    //     console.log("📡 WebSocket 연결 시도...");
    //     window.socket = new WebSocket(`ws://${window.location.host}/ws`);

    //     window.socket.onopen = () => {
    //         console.log("✅ WebSocket 연결 성공!");
    //     };

    //     window.socket.onmessage = (event) => {
    //         try {
    //             console.log("📩 WebSocket 메시지 수신:", event.data);
    //             const data = JSON.parse(event.data);

    //             if (data.alert && data.review) {
    //                 if (window.lastReceivedReviewId === data.review.review_id) {
    //                     console.warn(`⚠️ 중복된 알림 무시: ${data.review.review_id}`);
    //                     return;
    //                 }
    //                 window.lastReceivedReviewId = data.review.review_id;
    //                 showNotification(data.alert, data.review);
    //             }
    //         } catch (error) {
    //             console.error("🚨 WebSocket 메시지 처리 오류:", error);
    //         }
    //     };

    //     window.socket.onclose = () => {
    //         console.warn("⚠️ WebSocket 연결 종료됨. 5초 후 재연결 시도...");
    //         setTimeout(connectWebSocket, 5000);
    //     };

    //     window.socket.onerror = (error) => {
    //         console.error("🚨 WebSocket 오류 발생:", error);
    //         window.socket.close();
    //     };
    // }

    // function showNotification(message, review) {
    //     const notificationContainer = document.getElementById("notification-items");
    //     const notificationItem = document.createElement("li");

    //     notificationItem.innerHTML = `
    //         <strong>${message}</strong> <br>
    //         <span style="font-size:14px; color:gray;">📢 ${review.category} - ⭐ ${review.rating}</span> <br>
    //         <span>${review.sentence}</span>
    //     `;

    //     notificationContainer.prepend(notificationItem);
    //     updateNotificationBadge();
    // }

    // function updateNotificationBadge() {
    //     const count = document.querySelectorAll("#notification-items li").length;
    //     document.getElementById("notification-count").innerText = count > 0 ? count : "";
    // }

    // function toggleNotificationList() {
    //     const notificationDropdown = document.getElementById("notification-list");
    //     notificationDropdown.style.display = notificationDropdown.style.display === "block" ? "none" : "block";
    // }

    // function clearNotifications() {
    //     document.getElementById("notification-items").innerHTML = "";
    //     updateNotificationBadge();
    // }

    // document.addEventListener("DOMContentLoaded", () => {
    //     connectWebSocket();
    // });
        
        


    </script>
    
    
    

</body>
</html>
